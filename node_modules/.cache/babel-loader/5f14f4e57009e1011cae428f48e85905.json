{"ast":null,"code":"/**\r\n * mux.js\r\n *\r\n * Copyright (c) Brightcove\r\n * Licensed Apache-2.0 https://github.com/videojs/mux.js/blob/master/LICENSE\r\n *\r\n * Utilities to detect basic properties and metadata about Aac data.\r\n */\n'use strict';\n\nvar ADTS_SAMPLING_FREQUENCIES = [96000, 88200, 64000, 48000, 44100, 32000, 24000, 22050, 16000, 12000, 11025, 8000, 7350];\n\nvar parseId3TagSize = function parseId3TagSize(header, byteIndex) {\n  var returnSize = header[byteIndex + 6] << 21 | header[byteIndex + 7] << 14 | header[byteIndex + 8] << 7 | header[byteIndex + 9],\n      flags = header[byteIndex + 5],\n      footerPresent = (flags & 16) >> 4; // if we get a negative returnSize clamp it to 0\n\n  returnSize = returnSize >= 0 ? returnSize : 0;\n\n  if (footerPresent) {\n    return returnSize + 20;\n  }\n\n  return returnSize + 10;\n};\n\nvar getId3Offset = function getId3Offset(data, offset) {\n  if (data.length - offset < 10 || data[offset] !== 'I'.charCodeAt(0) || data[offset + 1] !== 'D'.charCodeAt(0) || data[offset + 2] !== '3'.charCodeAt(0)) {\n    return offset;\n  }\n\n  offset += parseId3TagSize(data, offset);\n  return getId3Offset(data, offset);\n}; // TODO: use vhs-utils\n\n\nvar isLikelyAacData = function isLikelyAacData(data) {\n  var offset = getId3Offset(data, 0);\n  return data.length >= offset + 2 && (data[offset] & 0xFF) === 0xFF && (data[offset + 1] & 0xF0) === 0xF0 && // verify that the 2 layer bits are 0, aka this\n  // is not mp3 data but aac data.\n  (data[offset + 1] & 0x16) === 0x10;\n};\n\nvar parseSyncSafeInteger = function parseSyncSafeInteger(data) {\n  return data[0] << 21 | data[1] << 14 | data[2] << 7 | data[3];\n}; // return a percent-encoded representation of the specified byte range\n// @see http://en.wikipedia.org/wiki/Percent-encoding\n\n\nvar percentEncode = function percentEncode(bytes, start, end) {\n  var i,\n      result = '';\n\n  for (i = start; i < end; i++) {\n    result += '%' + ('00' + bytes[i].toString(16)).slice(-2);\n  }\n\n  return result;\n}; // return the string representation of the specified byte range,\n// interpreted as ISO-8859-1.\n\n\nvar parseIso88591 = function parseIso88591(bytes, start, end) {\n  return unescape(percentEncode(bytes, start, end)); // jshint ignore:line\n};\n\nvar parseAdtsSize = function parseAdtsSize(header, byteIndex) {\n  var lowThree = (header[byteIndex + 5] & 0xE0) >> 5,\n      middle = header[byteIndex + 4] << 3,\n      highTwo = header[byteIndex + 3] & 0x3 << 11;\n  return highTwo | middle | lowThree;\n};\n\nvar parseType = function parseType(header, byteIndex) {\n  if (header[byteIndex] === 'I'.charCodeAt(0) && header[byteIndex + 1] === 'D'.charCodeAt(0) && header[byteIndex + 2] === '3'.charCodeAt(0)) {\n    return 'timed-metadata';\n  } else if (header[byteIndex] & 0xff === 0xff && (header[byteIndex + 1] & 0xf0) === 0xf0) {\n    return 'audio';\n  }\n\n  return null;\n};\n\nvar parseSampleRate = function parseSampleRate(packet) {\n  var i = 0;\n\n  while (i + 5 < packet.length) {\n    if (packet[i] !== 0xFF || (packet[i + 1] & 0xF6) !== 0xF0) {\n      // If a valid header was not found,  jump one forward and attempt to\n      // find a valid ADTS header starting at the next byte\n      i++;\n      continue;\n    }\n\n    return ADTS_SAMPLING_FREQUENCIES[(packet[i + 2] & 0x3c) >>> 2];\n  }\n\n  return null;\n};\n\nvar parseAacTimestamp = function parseAacTimestamp(packet) {\n  var frameStart, frameSize, frame, frameHeader; // find the start of the first frame and the end of the tag\n\n  frameStart = 10;\n\n  if (packet[5] & 0x40) {\n    // advance the frame start past the extended header\n    frameStart += 4; // header size field\n\n    frameStart += parseSyncSafeInteger(packet.subarray(10, 14));\n  } // parse one or more ID3 frames\n  // http://id3.org/id3v2.3.0#ID3v2_frame_overview\n\n\n  do {\n    // determine the number of bytes in this frame\n    frameSize = parseSyncSafeInteger(packet.subarray(frameStart + 4, frameStart + 8));\n\n    if (frameSize < 1) {\n      return null;\n    }\n\n    frameHeader = String.fromCharCode(packet[frameStart], packet[frameStart + 1], packet[frameStart + 2], packet[frameStart + 3]);\n\n    if (frameHeader === 'PRIV') {\n      frame = packet.subarray(frameStart + 10, frameStart + frameSize + 10);\n\n      for (var i = 0; i < frame.byteLength; i++) {\n        if (frame[i] === 0) {\n          var owner = parseIso88591(frame, 0, i);\n\n          if (owner === 'com.apple.streaming.transportStreamTimestamp') {\n            var d = frame.subarray(i + 1);\n            var size = (d[3] & 0x01) << 30 | d[4] << 22 | d[5] << 14 | d[6] << 6 | d[7] >>> 2;\n            size *= 4;\n            size += d[7] & 0x03;\n            return size;\n          }\n\n          break;\n        }\n      }\n    }\n\n    frameStart += 10; // advance past the frame header\n\n    frameStart += frameSize; // advance past the frame body\n  } while (frameStart < packet.byteLength);\n\n  return null;\n};\n\nmodule.exports = {\n  isLikelyAacData: isLikelyAacData,\n  parseId3TagSize: parseId3TagSize,\n  parseAdtsSize: parseAdtsSize,\n  parseType: parseType,\n  parseSampleRate: parseSampleRate,\n  parseAacTimestamp: parseAacTimestamp\n};","map":{"version":3,"sources":["C:/Users/franc/Documents/GitHub/but-project/node_modules/mux.js/lib/aac/utils.js"],"names":["ADTS_SAMPLING_FREQUENCIES","parseId3TagSize","header","byteIndex","returnSize","flags","footerPresent","getId3Offset","data","offset","length","charCodeAt","isLikelyAacData","parseSyncSafeInteger","percentEncode","bytes","start","end","i","result","toString","slice","parseIso88591","unescape","parseAdtsSize","lowThree","middle","highTwo","parseType","parseSampleRate","packet","parseAacTimestamp","frameStart","frameSize","frame","frameHeader","subarray","String","fromCharCode","byteLength","owner","d","size","module","exports"],"mappings":"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","sourcesContent":["/**\r\n * mux.js\r\n *\r\n * Copyright (c) Brightcove\r\n * Licensed Apache-2.0 https://github.com/videojs/mux.js/blob/master/LICENSE\r\n *\r\n * Utilities to detect basic properties and metadata about Aac data.\r\n */\r\n'use strict';\r\n\r\nvar ADTS_SAMPLING_FREQUENCIES = [\r\n  96000,\r\n  88200,\r\n  64000,\r\n  48000,\r\n  44100,\r\n  32000,\r\n  24000,\r\n  22050,\r\n  16000,\r\n  12000,\r\n  11025,\r\n  8000,\r\n  7350\r\n];\r\n\r\nvar parseId3TagSize = function(header, byteIndex) {\r\n  var\r\n    returnSize = (header[byteIndex + 6] << 21) |\r\n                 (header[byteIndex + 7] << 14) |\r\n                 (header[byteIndex + 8] << 7) |\r\n                 (header[byteIndex + 9]),\r\n    flags = header[byteIndex + 5],\r\n    footerPresent = (flags & 16) >> 4;\r\n\r\n  // if we get a negative returnSize clamp it to 0\r\n  returnSize = returnSize >= 0 ? returnSize : 0;\r\n\r\n  if (footerPresent) {\r\n    return returnSize + 20;\r\n  }\r\n  return returnSize + 10;\r\n};\r\n\r\nvar getId3Offset = function(data, offset) {\r\n  if (data.length - offset < 10 ||\r\n      data[offset] !== 'I'.charCodeAt(0) ||\r\n      data[offset + 1] !== 'D'.charCodeAt(0) ||\r\n      data[offset + 2] !== '3'.charCodeAt(0)) {\r\n    return offset;\r\n  }\r\n\r\n  offset += parseId3TagSize(data, offset);\r\n\r\n  return getId3Offset(data, offset);\r\n};\r\n\r\n\r\n// TODO: use vhs-utils\r\nvar isLikelyAacData = function(data) {\r\n  var offset = getId3Offset(data, 0);\r\n\r\n  return data.length >= offset + 2 &&\r\n    (data[offset] & 0xFF) === 0xFF &&\r\n    (data[offset + 1] & 0xF0) === 0xF0 &&\r\n    // verify that the 2 layer bits are 0, aka this\r\n    // is not mp3 data but aac data.\r\n    (data[offset + 1] & 0x16) === 0x10;\r\n};\r\n\r\nvar parseSyncSafeInteger = function(data) {\r\n  return (data[0] << 21) |\r\n          (data[1] << 14) |\r\n          (data[2] << 7) |\r\n          (data[3]);\r\n};\r\n\r\n// return a percent-encoded representation of the specified byte range\r\n// @see http://en.wikipedia.org/wiki/Percent-encoding\r\nvar percentEncode = function(bytes, start, end) {\r\n  var i, result = '';\r\n  for (i = start; i < end; i++) {\r\n    result += '%' + ('00' + bytes[i].toString(16)).slice(-2);\r\n  }\r\n  return result;\r\n};\r\n\r\n// return the string representation of the specified byte range,\r\n// interpreted as ISO-8859-1.\r\nvar parseIso88591 = function(bytes, start, end) {\r\n  return unescape(percentEncode(bytes, start, end)); // jshint ignore:line\r\n};\r\n\r\nvar parseAdtsSize = function(header, byteIndex) {\r\n  var\r\n    lowThree = (header[byteIndex + 5] & 0xE0) >> 5,\r\n    middle = header[byteIndex + 4] << 3,\r\n    highTwo = header[byteIndex + 3] & 0x3 << 11;\r\n\r\n  return (highTwo | middle) | lowThree;\r\n};\r\n\r\nvar parseType = function(header, byteIndex) {\r\n  if ((header[byteIndex] === 'I'.charCodeAt(0)) &&\r\n      (header[byteIndex + 1] === 'D'.charCodeAt(0)) &&\r\n      (header[byteIndex + 2] === '3'.charCodeAt(0))) {\r\n    return 'timed-metadata';\r\n  } else if ((header[byteIndex] & 0xff === 0xff) &&\r\n             ((header[byteIndex + 1] & 0xf0) === 0xf0)) {\r\n    return 'audio';\r\n  }\r\n  return null;\r\n};\r\n\r\nvar parseSampleRate = function(packet) {\r\n  var i = 0;\r\n\r\n  while (i + 5 < packet.length) {\r\n    if (packet[i] !== 0xFF || (packet[i + 1] & 0xF6) !== 0xF0) {\r\n      // If a valid header was not found,  jump one forward and attempt to\r\n      // find a valid ADTS header starting at the next byte\r\n      i++;\r\n      continue;\r\n    }\r\n    return ADTS_SAMPLING_FREQUENCIES[(packet[i + 2] & 0x3c) >>> 2];\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nvar parseAacTimestamp = function(packet) {\r\n  var frameStart, frameSize, frame, frameHeader;\r\n\r\n  // find the start of the first frame and the end of the tag\r\n  frameStart = 10;\r\n  if (packet[5] & 0x40) {\r\n    // advance the frame start past the extended header\r\n    frameStart += 4; // header size field\r\n    frameStart += parseSyncSafeInteger(packet.subarray(10, 14));\r\n  }\r\n\r\n  // parse one or more ID3 frames\r\n  // http://id3.org/id3v2.3.0#ID3v2_frame_overview\r\n  do {\r\n    // determine the number of bytes in this frame\r\n    frameSize = parseSyncSafeInteger(packet.subarray(frameStart + 4, frameStart + 8));\r\n    if (frameSize < 1) {\r\n      return null;\r\n    }\r\n    frameHeader = String.fromCharCode(packet[frameStart],\r\n                                      packet[frameStart + 1],\r\n                                      packet[frameStart + 2],\r\n                                      packet[frameStart + 3]);\r\n\r\n    if (frameHeader === 'PRIV') {\r\n      frame = packet.subarray(frameStart + 10, frameStart + frameSize + 10);\r\n\r\n      for (var i = 0; i < frame.byteLength; i++) {\r\n        if (frame[i] === 0) {\r\n          var owner = parseIso88591(frame, 0, i);\r\n          if (owner === 'com.apple.streaming.transportStreamTimestamp') {\r\n            var d = frame.subarray(i + 1);\r\n            var size = ((d[3] & 0x01)  << 30) |\r\n                       (d[4]  << 22) |\r\n                       (d[5] << 14) |\r\n                       (d[6] << 6) |\r\n                       (d[7] >>> 2);\r\n            size *= 4;\r\n            size += d[7] & 0x03;\r\n\r\n            return size;\r\n          }\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    frameStart += 10; // advance past the frame header\r\n    frameStart += frameSize; // advance past the frame body\r\n  } while (frameStart < packet.byteLength);\r\n  return null;\r\n};\r\n\r\nmodule.exports = {\r\n  isLikelyAacData: isLikelyAacData,\r\n  parseId3TagSize: parseId3TagSize,\r\n  parseAdtsSize: parseAdtsSize,\r\n  parseType: parseType,\r\n  parseSampleRate: parseSampleRate,\r\n  parseAacTimestamp: parseAacTimestamp\r\n};\r\n"]},"metadata":{},"sourceType":"script"}