{"ast":null,"code":"/*\r\n * Pannellum - An HTML5 based Panorama Viewer\r\n * Copyright (c) 2011-2018 Matthew Petroff\r\n * \r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n * \r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n * \r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\nwindow.pannellum = function (window, document, undefined) {\n  /**\r\n  * Creates a new panorama viewer.\r\n  * @constructor\r\n  * @param {HTMLElement|string} container - The container (div) element for the\r\n  *      viewer, or its ID.\r\n  * @param {Object} initialConfig - Inital configuration for viewer.\r\n  */\n  function Viewer(container, initialConfig) {\n    var _this = this; // Declare variables\n\n\n    var config,\n        renderer,\n        preview,\n        isUserInteracting = false,\n        latestInteraction = Date.now(),\n        onPointerDownPointerX = 0,\n        onPointerDownPointerY = 0,\n        onPointerDownPointerDist = -1,\n        onPointerDownYaw = 0,\n        onPointerDownPitch = 0,\n        keysDown = new Array(10),\n        fullscreenActive = false,\n        loaded,\n        error = false,\n        isTimedOut = false,\n        listenersAdded = false,\n        panoImage,\n        prevTime,\n        speed = {\n      'yaw': 0,\n      'pitch': 0,\n      'hfov': 0\n    },\n        animating = false,\n        orientation = false,\n        orientationYawOffset = 0,\n        autoRotateStart,\n        autoRotateSpeed = 0,\n        origHfov,\n        origPitch,\n        animatedMove = {},\n        externalEventListeners = {},\n        specifiedPhotoSphereExcludes = [],\n        update = false,\n        // Should we update when still to render dynamic content\n    hotspotsCreated = false;\n    var defaultConfig = {\n      hfov: 100,\n      minHfov: 50,\n      maxHfov: 120,\n      pitch: 0,\n      minPitch: undefined,\n      maxPitch: undefined,\n      yaw: 0,\n      minYaw: -180,\n      maxYaw: 180,\n      roll: 0,\n      haov: 360,\n      vaov: 180,\n      vOffset: 0,\n      autoRotate: false,\n      autoRotateInactivityDelay: -1,\n      autoRotateStopDelay: undefined,\n      type: 'equirectangular',\n      northOffset: 0,\n      showFullscreenCtrl: true,\n      dynamic: false,\n      doubleClickZoom: true,\n      keyboardZoom: true,\n      mouseZoom: true,\n      showZoomCtrl: true,\n      autoLoad: false,\n      showControls: true,\n      orientationOnByDefault: false,\n      hotSpotDebug: false,\n      backgroundColor: [0, 0, 0],\n      avoidShowingBackground: false,\n      animationTimingFunction: timingFunction,\n      draggable: true,\n      disableKeyboardCtrl: false,\n      crossOrigin: 'anonymous',\n      touchPanSpeedCoeffFactor: 1,\n      capturedKeyNumbers: [16, 17, 27, 37, 38, 39, 40, 61, 65, 68, 83, 87, 107, 109, 173, 187, 189]\n    }; // Translatable / configurable strings\n    // Some strings contain '%s', which is a placeholder for inserted values\n    // When setting strings in external configuration, `\\n` should be used instead of `<br>` to insert line breaks\n\n    defaultConfig.strings = {\n      // Labels\n      loadButtonLabel: 'Click to<br>Load<br>Panorama',\n      loadingLabel: 'Loading...',\n      bylineLabel: 'by %s',\n      // One substitution: author\n      // Errors\n      noPanoramaError: 'No panorama image was specified.',\n      fileAccessError: 'The file %s could not be accessed.',\n      // One substitution: file URL\n      malformedURLError: 'There is something wrong with the panorama URL.',\n      iOS8WebGLError: \"Due to iOS 8's broken WebGL implementation, only \" + \"progressive encoded JPEGs work for your device (this \" + \"panorama uses standard encoding).\",\n      genericWebGLError: 'Your browser does not have the necessary WebGL support to display this panorama.',\n      textureSizeError: 'This panorama is too big for your device! It\\'s ' + '%spx wide, but your device only supports images up to ' + '%spx wide. Try another device.' + ' (If you\\'re the author, try scaling down the image.)',\n      // Two substitutions: image width, max image width\n      unknownError: 'Unknown error. Check developer console.'\n    }; // Initialize container\n\n    container = typeof container === 'string' ? document.getElementById(container) : container;\n    container.classList.add('pnlm-container');\n    container.tabIndex = 0; // Create container for ui\n\n    var uiContainer = document.createElement('div');\n    uiContainer.className = 'pnlm-ui';\n    container.appendChild(uiContainer); // Create container for renderer\n\n    var renderContainer = document.createElement('div');\n    renderContainer.className = 'pnlm-render-container';\n    container.appendChild(renderContainer);\n    var dragFix = document.createElement('div');\n    dragFix.className = 'pnlm-dragfix';\n    uiContainer.appendChild(dragFix); // Display about information on right click\n\n    var aboutMsg = document.createElement('span');\n    aboutMsg.className = 'pnlm-about-msg';\n    aboutMsg.innerHTML = '<a href=\"https://pannellum.org/\" target=\"_blank\">Pannellum</a>';\n    uiContainer.appendChild(aboutMsg);\n    dragFix.addEventListener('contextmenu', aboutMessage); // Create info display\n\n    var infoDisplay = {}; // Hot spot debug indicator\n\n    var hotSpotDebugIndicator = document.createElement('div');\n    hotSpotDebugIndicator.className = 'pnlm-sprite pnlm-hot-spot-debug-indicator';\n    uiContainer.appendChild(hotSpotDebugIndicator); // Panorama info\n\n    infoDisplay.container = document.createElement('div');\n    infoDisplay.container.className = 'pnlm-panorama-info';\n    infoDisplay.title = document.createElement('div');\n    infoDisplay.title.className = 'pnlm-title-box';\n    infoDisplay.container.appendChild(infoDisplay.title);\n    infoDisplay.author = document.createElement('div');\n    infoDisplay.author.className = 'pnlm-author-box';\n    infoDisplay.container.appendChild(infoDisplay.author);\n    uiContainer.appendChild(infoDisplay.container); // Load box\n\n    infoDisplay.load = {};\n    infoDisplay.load.box = document.createElement('div');\n    infoDisplay.load.box.className = 'pnlm-load-box';\n    infoDisplay.load.boxp = document.createElement('p');\n    infoDisplay.load.box.appendChild(infoDisplay.load.boxp);\n    infoDisplay.load.lbox = document.createElement('div');\n    infoDisplay.load.lbox.className = 'pnlm-lbox';\n    infoDisplay.load.lbox.innerHTML = '<div class=\"pnlm-loading\"></div>';\n    infoDisplay.load.box.appendChild(infoDisplay.load.lbox);\n    infoDisplay.load.lbar = document.createElement('div');\n    infoDisplay.load.lbar.className = 'pnlm-lbar';\n    infoDisplay.load.lbarFill = document.createElement('div');\n    infoDisplay.load.lbarFill.className = 'pnlm-lbar-fill';\n    infoDisplay.load.lbar.appendChild(infoDisplay.load.lbarFill);\n    infoDisplay.load.box.appendChild(infoDisplay.load.lbar);\n    infoDisplay.load.msg = document.createElement('p');\n    infoDisplay.load.msg.className = 'pnlm-lmsg';\n    infoDisplay.load.box.appendChild(infoDisplay.load.msg);\n    uiContainer.appendChild(infoDisplay.load.box); // Error message\n\n    infoDisplay.errorMsg = document.createElement('div');\n    infoDisplay.errorMsg.className = 'pnlm-error-msg pnlm-info-box';\n    uiContainer.appendChild(infoDisplay.errorMsg); // Create controls\n\n    var controls = {};\n    controls.container = document.createElement('div');\n    controls.container.className = 'pnlm-controls-container';\n    uiContainer.appendChild(controls.container); // Load button\n\n    controls.load = document.createElement('div');\n    controls.load.className = 'pnlm-load-button';\n    controls.load.addEventListener('click', function () {\n      processOptions();\n      load();\n    });\n    uiContainer.appendChild(controls.load); // Zoom controls\n\n    controls.zoom = document.createElement('div');\n    controls.zoom.className = 'pnlm-zoom-controls pnlm-controls';\n    controls.zoomIn = document.createElement('div');\n    controls.zoomIn.className = 'pnlm-zoom-in pnlm-sprite pnlm-control';\n    controls.zoomIn.addEventListener('click', zoomIn);\n    controls.zoom.appendChild(controls.zoomIn);\n    controls.zoomOut = document.createElement('div');\n    controls.zoomOut.className = 'pnlm-zoom-out pnlm-sprite pnlm-control';\n    controls.zoomOut.addEventListener('click', zoomOut);\n    controls.zoom.appendChild(controls.zoomOut);\n    controls.container.appendChild(controls.zoom); // Fullscreen toggle\n\n    controls.fullscreen = document.createElement('div');\n    controls.fullscreen.addEventListener('click', toggleFullscreen);\n    controls.fullscreen.className = 'pnlm-fullscreen-toggle-button pnlm-sprite pnlm-fullscreen-toggle-button-inactive pnlm-controls pnlm-control';\n\n    if (document.fullscreenEnabled || document.mozFullScreenEnabled || document.webkitFullscreenEnabled || document.msFullscreenEnabled) {\n      controls.container.appendChild(controls.fullscreen);\n    } // Device orientation toggle\n\n\n    controls.orientation = document.createElement('div');\n    controls.orientation.addEventListener('click', function (e) {\n      if (orientation) {\n        stopOrientation();\n      } else {\n        startOrientation();\n      }\n    });\n    controls.orientation.addEventListener('mousedown', function (e) {\n      e.stopPropagation();\n    });\n    controls.orientation.addEventListener('touchstart', function (e) {\n      e.stopPropagation();\n    });\n    controls.orientation.addEventListener('pointerdown', function (e) {\n      e.stopPropagation();\n    });\n    controls.orientation.className = 'pnlm-orientation-button pnlm-orientation-button-inactive pnlm-sprite pnlm-controls pnlm-control';\n    var orientationSupport,\n        startOrientationIfSupported = false;\n\n    function deviceOrientationTest(e) {\n      window.removeEventListener('deviceorientation', deviceOrientationTest);\n\n      if (e && e.alpha !== null && e.beta !== null && e.gamma !== null) {\n        controls.container.appendChild(controls.orientation);\n        orientationSupport = true;\n\n        if (startOrientationIfSupported) {\n          startOrientation();\n        }\n      } else {\n        orientationSupport = false;\n      }\n    }\n\n    if (window.DeviceOrientationEvent) {\n      window.addEventListener('deviceorientation', deviceOrientationTest);\n    } else {\n      orientationSupport = false;\n    } // Compass\n\n\n    var compass = document.createElement('div');\n    compass.className = 'pnlm-compass pnlm-controls pnlm-control';\n    uiContainer.appendChild(compass); // Load and process configuration\n\n    if (initialConfig.firstScene) {\n      // Activate first scene if specified in URL\n      mergeConfig(initialConfig.firstScene);\n    } else if (initialConfig.default && initialConfig.default.firstScene) {\n      // Activate first scene if specified in file\n      mergeConfig(initialConfig.default.firstScene);\n    } else {\n      mergeConfig(null);\n    }\n\n    processOptions(true);\n    /**\r\n    * Initializes viewer.\r\n    * @private\r\n    */\n\n    function init() {\n      // Display an error for IE 9 as it doesn't work but also doesn't otherwise\n      // show an error (older versions don't work at all)\n      // Based on: http://stackoverflow.com/a/10965203\n      var div = document.createElement(\"div\");\n      div.innerHTML = \"<!--[if lte IE 9]><i></i><![endif]-->\";\n\n      if (div.getElementsByTagName(\"i\").length == 1) {\n        anError();\n        return;\n      }\n\n      origHfov = config.hfov;\n      origPitch = config.pitch;\n      var i, p;\n\n      if (config.type == 'cubemap') {\n        panoImage = [];\n\n        for (i = 0; i < 6; i++) {\n          panoImage.push(new Image());\n          panoImage[i].crossOrigin = config.crossOrigin;\n        }\n\n        infoDisplay.load.lbox.style.display = 'block';\n        infoDisplay.load.lbar.style.display = 'none';\n      } else if (config.type == 'multires') {\n        var c = JSON.parse(JSON.stringify(config.multiRes)); // Deep copy\n        // Avoid \"undefined\" in path, check (optional) multiRes.basePath, too\n        // Use only multiRes.basePath if it's an absolute URL\n\n        if (config.basePath && config.multiRes.basePath && !/^(?:[a-z]+:)?\\/\\//i.test(config.multiRes.basePath)) {\n          c.basePath = config.basePath + config.multiRes.basePath;\n        } else if (config.multiRes.basePath) {\n          c.basePath = config.multiRes.basePath;\n        } else if (config.basePath) {\n          c.basePath = config.basePath;\n        }\n\n        panoImage = c;\n      } else {\n        if (config.dynamic === true) {\n          panoImage = config.panorama;\n        } else {\n          if (config.panorama === undefined) {\n            anError(config.strings.noPanoramaError);\n            return;\n          }\n\n          panoImage = new Image();\n        }\n      } // Configure image loading\n\n\n      if (config.type == 'cubemap') {\n        // Quick loading counter for synchronous loading\n        var itemsToLoad = 6;\n\n        var onLoad = function onLoad() {\n          itemsToLoad--;\n\n          if (itemsToLoad === 0) {\n            onImageLoad();\n          }\n        };\n\n        var onError = function onError(e) {\n          var a = document.createElement('a');\n          a.href = e.target.src;\n          a.textContent = a.href;\n          anError(config.strings.fileAccessError.replace('%s', a.outerHTML));\n        };\n\n        for (i = 0; i < panoImage.length; i++) {\n          p = config.cubeMap[i];\n\n          if (p == \"null\") {\n            // support partial cubemap image with explicitly empty faces\n            console.log('Will use background instead of missing cubemap face ' + i);\n            onLoad();\n          } else {\n            if (config.basePath && !absoluteURL(p)) {\n              p = config.basePath + p;\n            }\n\n            panoImage[i].onload = onLoad;\n            panoImage[i].onerror = onError;\n            panoImage[i].src = sanitizeURL(p);\n          }\n        }\n      } else if (config.type == 'multires') {\n        onImageLoad();\n      } else {\n        p = '';\n\n        if (config.basePath) {\n          p = config.basePath;\n        }\n\n        if (config.dynamic !== true) {\n          // Still image\n          p = absoluteURL(config.panorama) ? config.panorama : p + config.panorama;\n\n          panoImage.onload = function () {\n            window.URL.revokeObjectURL(this.src); // Clean up\n\n            onImageLoad();\n          };\n\n          var xhr = new XMLHttpRequest();\n\n          xhr.onloadend = function () {\n            if (xhr.status != 200) {\n              // Display error if image can't be loaded\n              var a = document.createElement('a');\n              a.href = p;\n              a.textContent = a.href;\n              anError(config.strings.fileAccessError.replace('%s', a.outerHTML));\n            }\n\n            var img = this.response;\n            parseGPanoXMP(img);\n            infoDisplay.load.msg.innerHTML = '';\n          };\n\n          xhr.onprogress = function (e) {\n            if (e.lengthComputable) {\n              // Display progress\n              var percent = e.loaded / e.total * 100;\n              infoDisplay.load.lbarFill.style.width = percent + '%';\n              var unit, numerator, denominator;\n\n              if (e.total > 1e6) {\n                unit = 'MB';\n                numerator = (e.loaded / 1e6).toFixed(2);\n                denominator = (e.total / 1e6).toFixed(2);\n              } else if (e.total > 1e3) {\n                unit = 'kB';\n                numerator = (e.loaded / 1e3).toFixed(1);\n                denominator = (e.total / 1e3).toFixed(1);\n              } else {\n                unit = 'B';\n                numerator = e.loaded;\n                denominator = e.total;\n              }\n\n              infoDisplay.load.msg.innerHTML = numerator + ' / ' + denominator + ' ' + unit;\n            } else {\n              // Display loading spinner\n              infoDisplay.load.lbox.style.display = 'block';\n              infoDisplay.load.lbar.style.display = 'none';\n            }\n          };\n\n          try {\n            xhr.open('GET', p, true);\n          } catch (e) {\n            // Malformed URL\n            anError(config.strings.malformedURLError);\n          }\n\n          xhr.responseType = 'blob';\n          xhr.setRequestHeader('Accept', 'image/*,*/*;q=0.9');\n          xhr.withCredentials = config.crossOrigin === 'use-credentials';\n          xhr.send();\n        }\n      }\n\n      if (config.draggable) {\n        uiContainer.classList.add('pnlm-grab');\n      }\n\n      uiContainer.classList.remove('pnlm-grabbing');\n    }\n    /**\r\n    * Test if URL is absolute or relative.\r\n    * @private\r\n    * @param {string} url - URL to test\r\n    * @returns {boolean} True if absolute, else false\r\n    */\n\n\n    function absoluteURL(url) {\n      // From http://stackoverflow.com/a/19709846\n      return new RegExp('^(?:[a-z]+:)?//', 'i').test(url) || url[0] == '/' || url.slice(0, 5) == 'blob:';\n    }\n\n    ;\n    /**\r\n    * Create renderer and initialize event listeners once image is loaded.\r\n    * @private\r\n    */\n\n    function onImageLoad() {\n      if (!renderer) {\n        renderer = new libpannellum.renderer(renderContainer);\n      } // Only add event listeners once\n\n\n      if (!listenersAdded) {\n        listenersAdded = true;\n        dragFix.addEventListener('mousedown', onDocumentMouseDown, false);\n        document.addEventListener('mousemove', onDocumentMouseMove, false);\n        document.addEventListener('mouseup', onDocumentMouseUp, false);\n\n        if (config.mouseZoom) {\n          uiContainer.addEventListener('mousewheel', onDocumentMouseWheel, false);\n          uiContainer.addEventListener('DOMMouseScroll', onDocumentMouseWheel, false);\n        }\n\n        if (config.doubleClickZoom) {\n          dragFix.addEventListener('dblclick', onDocumentDoubleClick, false);\n        }\n\n        uiContainer.addEventListener('mozfullscreenchange', onFullScreenChange, false);\n        uiContainer.addEventListener('webkitfullscreenchange', onFullScreenChange, false);\n        uiContainer.addEventListener('msfullscreenchange', onFullScreenChange, false);\n        uiContainer.addEventListener('fullscreenchange', onFullScreenChange, false);\n        window.addEventListener('resize', onDocumentResize, false);\n        window.addEventListener('orientationchange', onDocumentResize, false);\n\n        if (!config.disableKeyboardCtrl) {\n          container.addEventListener('keydown', onDocumentKeyPress, false);\n          container.addEventListener('keyup', onDocumentKeyUp, false);\n          container.addEventListener('blur', clearKeys, false);\n        }\n\n        document.addEventListener('mouseleave', onDocumentMouseUp, false);\n\n        if (document.documentElement.style.pointerAction === '' && document.documentElement.style.touchAction === '') {\n          dragFix.addEventListener('pointerdown', onDocumentPointerDown, false);\n          dragFix.addEventListener('pointermove', onDocumentPointerMove, false);\n          dragFix.addEventListener('pointerup', onDocumentPointerUp, false);\n          dragFix.addEventListener('pointerleave', onDocumentPointerUp, false);\n        } else {\n          dragFix.addEventListener('touchstart', onDocumentTouchStart, false);\n          dragFix.addEventListener('touchmove', onDocumentTouchMove, false);\n          dragFix.addEventListener('touchend', onDocumentTouchEnd, false);\n        } // Deal with MS pointer events\n\n\n        if (window.navigator.pointerEnabled) {\n          container.style.touchAction = 'none';\n        }\n      }\n\n      renderInit();\n      setHfov(config.hfov); // possibly adapt hfov after configuration and canvas is complete; prevents empty space on top or bottom by zomming out too much\n\n      setTimeout(function () {\n        isTimedOut = true;\n      }, 500);\n    }\n    /**\r\n    * Parses Google Photo Sphere XMP Metadata.\r\n    * https://developers.google.com/photo-sphere/metadata/\r\n    * @private\r\n    * @param {Image} image - Image to read XMP metadata from.\r\n    */\n\n\n    function parseGPanoXMP(image) {\n      var reader = new FileReader();\n      reader.addEventListener('loadend', function () {\n        var img = reader.result; // This awful browser specific test exists because iOS 8 does not work\n        // with non-progressive encoded JPEGs.\n\n        if (navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)) {\n          var flagIndex = img.indexOf('\\xff\\xc2');\n\n          if (flagIndex < 0 || flagIndex > 65536) {\n            anError(config.strings.iOS8WebGLError);\n          }\n        }\n\n        var start = img.indexOf('<x:xmpmeta');\n\n        if (start > -1 && config.ignoreGPanoXMP !== true) {\n          var xmpData = img.substring(start, img.indexOf('</x:xmpmeta>') + 12); // Extract the requested tag from the XMP data\n\n          var getTag = function getTag(tag) {\n            var result;\n\n            if (xmpData.indexOf(tag + '=\"') >= 0) {\n              result = xmpData.substring(xmpData.indexOf(tag + '=\"') + tag.length + 2);\n              result = result.substring(0, result.indexOf('\"'));\n            } else if (xmpData.indexOf(tag + '>') >= 0) {\n              result = xmpData.substring(xmpData.indexOf(tag + '>') + tag.length + 1);\n              result = result.substring(0, result.indexOf('<'));\n            }\n\n            if (result !== undefined) {\n              return Number(result);\n            }\n\n            return null;\n          }; // Relevant XMP data\n\n\n          var xmp = {\n            fullWidth: getTag('GPano:FullPanoWidthPixels'),\n            croppedWidth: getTag('GPano:CroppedAreaImageWidthPixels'),\n            fullHeight: getTag('GPano:FullPanoHeightPixels'),\n            croppedHeight: getTag('GPano:CroppedAreaImageHeightPixels'),\n            topPixels: getTag('GPano:CroppedAreaTopPixels'),\n            heading: getTag('GPano:PoseHeadingDegrees'),\n            horizonPitch: getTag('GPano:PosePitchDegrees'),\n            horizonRoll: getTag('GPano:PoseRollDegrees')\n          };\n\n          if (xmp.fullWidth !== null && xmp.croppedWidth !== null && xmp.fullHeight !== null && xmp.croppedHeight !== null && xmp.topPixels !== null) {\n            // Set up viewer using GPano XMP data\n            if (specifiedPhotoSphereExcludes.indexOf('haov') < 0) {\n              config.haov = xmp.croppedWidth / xmp.fullWidth * 360;\n            }\n\n            if (specifiedPhotoSphereExcludes.indexOf('vaov') < 0) {\n              config.vaov = xmp.croppedHeight / xmp.fullHeight * 180;\n            }\n\n            if (specifiedPhotoSphereExcludes.indexOf('vOffset') < 0) {\n              config.vOffset = ((xmp.topPixels + xmp.croppedHeight / 2) / xmp.fullHeight - 0.5) * -180;\n            }\n\n            if (xmp.heading !== null && specifiedPhotoSphereExcludes.indexOf('northOffset') < 0) {\n              // TODO: make sure this works correctly for partial panoramas\n              config.northOffset = xmp.heading;\n\n              if (config.compass !== false) {\n                config.compass = true;\n              }\n            }\n\n            if (xmp.horizonPitch !== null && xmp.horizonRoll !== null) {\n              if (specifiedPhotoSphereExcludes.indexOf('horizonPitch') < 0) {\n                config.horizonPitch = xmp.horizonPitch;\n              }\n\n              if (specifiedPhotoSphereExcludes.indexOf('horizonRoll') < 0) {\n                config.horizonRoll = xmp.horizonRoll;\n              }\n            } // TODO: add support for initial view settings\n\n          }\n        } // Load panorama\n\n\n        panoImage.src = window.URL.createObjectURL(image);\n      });\n\n      if (reader.readAsBinaryString !== undefined) {\n        reader.readAsBinaryString(image);\n      } else {\n        reader.readAsText(image);\n      }\n    }\n    /**\r\n    * Displays an error message.\r\n    * @private\r\n    * @param {string} errorMsg - Error message to display. If not specified, a\r\n    *      generic WebGL error is displayed.\r\n    */\n\n\n    function anError(errorMsg) {\n      if (errorMsg === undefined) {\n        errorMsg = config.strings.genericWebGLError;\n      }\n\n      infoDisplay.errorMsg.innerHTML = '<p>' + errorMsg + '</p>';\n      controls.load.style.display = 'none';\n      infoDisplay.load.box.style.display = 'none';\n      infoDisplay.errorMsg.style.display = 'table';\n      error = true;\n      renderContainer.style.display = 'none';\n      fireEvent('error', errorMsg);\n    }\n    /**\r\n    * Hides error message display.\r\n    * @private\r\n    */\n\n\n    function clearError() {\n      if (error) {\n        infoDisplay.load.box.style.display = 'none';\n        infoDisplay.errorMsg.style.display = 'none';\n        error = false;\n        fireEvent('errorcleared');\n      }\n    }\n    /**\r\n    * Displays about message.\r\n    * @private\r\n    * @param {MouseEvent} event - Right click location\r\n    */\n\n\n    function aboutMessage(event) {\n      var pos = mousePosition(event);\n      aboutMsg.style.left = pos.x + 'px';\n      aboutMsg.style.top = pos.y + 'px';\n      clearTimeout(aboutMessage.t1);\n      clearTimeout(aboutMessage.t2);\n      aboutMsg.style.display = 'block';\n      aboutMsg.style.opacity = 1;\n      aboutMessage.t1 = setTimeout(function () {\n        aboutMsg.style.opacity = 0;\n      }, 2000);\n      aboutMessage.t2 = setTimeout(function () {\n        aboutMsg.style.display = 'none';\n      }, 2500);\n      event.preventDefault();\n    }\n    /**\r\n    * Calculate mouse position relative to top left of viewer container.\r\n    * @private\r\n    * @param {MouseEvent} event - Mouse event to use in calculation\r\n    * @returns {Object} Calculated X and Y coordinates\r\n    */\n\n\n    function mousePosition(event) {\n      var bounds = container.getBoundingClientRect();\n      var pos = {};\n      pos.x = event.clientX - bounds.left;\n      pos.y = event.clientY - bounds.top;\n      return pos;\n    }\n    /**\r\n    * Event handler for mouse clicks. Initializes panning. Prints center and click\r\n    * location coordinates when hot spot debugging is enabled.\r\n    * @private\r\n    * @param {MouseEvent} event - Document mouse down event.\r\n    */\n\n\n    function onDocumentMouseDown(event) {\n      // Override default action\n      event.preventDefault(); // But not all of it\n\n      container.focus(); // Only do something if the panorama is loaded\n\n      if (!loaded || !config.draggable) {\n        return;\n      } // Calculate mouse position relative to top left of viewer container\n\n\n      var pos = mousePosition(event); // Log pitch / yaw of mouse click when debugging / placing hot spots\n\n      if (config.hotSpotDebug) {\n        var coords = mouseEventToCoords(event);\n        console.log('Pitch: ' + coords[0] + ', Yaw: ' + coords[1] + ', Center Pitch: ' + config.pitch + ', Center Yaw: ' + config.yaw + ', HFOV: ' + config.hfov);\n      } // Turn off auto-rotation if enabled\n\n\n      stopAnimation();\n      stopOrientation();\n      config.roll = 0;\n      speed.hfov = 0;\n      isUserInteracting = true;\n      latestInteraction = Date.now();\n      onPointerDownPointerX = pos.x;\n      onPointerDownPointerY = pos.y;\n      onPointerDownYaw = config.yaw;\n      onPointerDownPitch = config.pitch;\n      uiContainer.classList.add('pnlm-grabbing');\n      uiContainer.classList.remove('pnlm-grab');\n      fireEvent('mousedown', event);\n      animateInit();\n    }\n    /**\r\n    * Event handler for double clicks. Zooms in at clicked location\r\n    * @private\r\n    * @param {MouseEvent} event - Document mouse down event.\r\n    */\n\n\n    function onDocumentDoubleClick(event) {\n      if (config.minHfov === config.hfov) {\n        _this.setHfov(origHfov, 1000);\n      } else {\n        var coords = mouseEventToCoords(event);\n\n        _this.lookAt(coords[0], coords[1], config.minHfov, 1000);\n      }\n    }\n    /**\r\n    * Calculate panorama pitch and yaw from location of mouse event.\r\n    * @private\r\n    * @param {MouseEvent} event - Document mouse down event.\r\n    * @returns {number[]} [pitch, yaw]\r\n    */\n\n\n    function mouseEventToCoords(event) {\n      var pos = mousePosition(event);\n      var canvas = renderer.getCanvas();\n      var canvasWidth = canvas.clientWidth,\n          canvasHeight = canvas.clientHeight;\n      var x = pos.x / canvasWidth * 2 - 1;\n      var y = (1 - pos.y / canvasHeight * 2) * canvasHeight / canvasWidth;\n      var focal = 1 / Math.tan(config.hfov * Math.PI / 360);\n      var s = Math.sin(config.pitch * Math.PI / 180);\n      var c = Math.cos(config.pitch * Math.PI / 180);\n      var a = focal * c - y * s;\n      var root = Math.sqrt(x * x + a * a);\n      var pitch = Math.atan((y * c + focal * s) / root) * 180 / Math.PI;\n      var yaw = Math.atan2(x / root, a / root) * 180 / Math.PI + config.yaw;\n\n      if (yaw < -180) {\n        yaw += 360;\n      }\n\n      if (yaw > 180) {\n        yaw -= 360;\n      }\n\n      return [pitch, yaw];\n    }\n    /**\r\n    * Event handler for mouse moves. Pans center of view.\r\n    * @private\r\n    * @param {MouseEvent} event - Document mouse move event.\r\n    */\n\n\n    function onDocumentMouseMove(event) {\n      if (isUserInteracting && loaded) {\n        latestInteraction = Date.now();\n        var canvas = renderer.getCanvas();\n        var canvasWidth = canvas.clientWidth,\n            canvasHeight = canvas.clientHeight;\n        var pos = mousePosition(event); //TODO: This still isn't quite right\n\n        var yaw = (Math.atan(onPointerDownPointerX / canvasWidth * 2 - 1) - Math.atan(pos.x / canvasWidth * 2 - 1)) * 180 / Math.PI * config.hfov / 90 + onPointerDownYaw;\n        speed.yaw = (yaw - config.yaw) % 360 * 0.2;\n        config.yaw = yaw;\n        var vfov = 2 * Math.atan(Math.tan(config.hfov / 360 * Math.PI) * canvasHeight / canvasWidth) * 180 / Math.PI;\n        var pitch = (Math.atan(pos.y / canvasHeight * 2 - 1) - Math.atan(onPointerDownPointerY / canvasHeight * 2 - 1)) * 180 / Math.PI * vfov / 90 + onPointerDownPitch;\n        speed.pitch = (pitch - config.pitch) * 0.2;\n        config.pitch = pitch;\n      }\n    }\n    /**\r\n    * Event handler for mouse up events. Stops panning.\r\n    * @private\r\n    */\n\n\n    function onDocumentMouseUp(event) {\n      if (!isUserInteracting) {\n        return;\n      }\n\n      isUserInteracting = false;\n\n      if (Date.now() - latestInteraction > 15) {\n        // Prevents jump when user rapidly moves mouse, stops, and then\n        // releases the mouse button\n        speed.pitch = speed.yaw = 0;\n      }\n\n      uiContainer.classList.add('pnlm-grab');\n      uiContainer.classList.remove('pnlm-grabbing');\n      latestInteraction = Date.now();\n      fireEvent('mouseup', event);\n    }\n    /**\r\n    * Event handler for touches. Initializes panning if one touch or zooming if\r\n    * two touches.\r\n    * @private\r\n    * @param {TouchEvent} event - Document touch start event.\r\n    */\n\n\n    function onDocumentTouchStart(event) {\n      // Only do something if the panorama is loaded\n      if (!loaded || !config.draggable) {\n        return;\n      } // Turn off auto-rotation if enabled\n\n\n      stopAnimation();\n      stopOrientation();\n      config.roll = 0;\n      speed.hfov = 0; // Calculate touch position relative to top left of viewer container\n\n      var pos0 = mousePosition(event.targetTouches[0]);\n      onPointerDownPointerX = pos0.x;\n      onPointerDownPointerY = pos0.y;\n\n      if (event.targetTouches.length == 2) {\n        // Down pointer is the center of the two fingers\n        var pos1 = mousePosition(event.targetTouches[1]);\n        onPointerDownPointerX += (pos1.x - pos0.x) * 0.5;\n        onPointerDownPointerY += (pos1.y - pos0.y) * 0.5;\n        onPointerDownPointerDist = Math.sqrt((pos0.x - pos1.x) * (pos0.x - pos1.x) + (pos0.y - pos1.y) * (pos0.y - pos1.y));\n      }\n\n      isUserInteracting = true;\n      latestInteraction = Date.now();\n      onPointerDownYaw = config.yaw;\n      onPointerDownPitch = config.pitch;\n      fireEvent('touchstart', event);\n      animateInit();\n    }\n    /**\r\n    * Event handler for touch movements. Pans center of view if one touch or\r\n    * adjusts zoom if two touches.\r\n    * @private\r\n    * @param {TouchEvent} event - Document touch move event.\r\n    */\n\n\n    function onDocumentTouchMove(event) {\n      if (!config.draggable) {\n        return;\n      } // Override default action\n\n\n      event.preventDefault();\n\n      if (loaded) {\n        latestInteraction = Date.now();\n      }\n\n      if (isUserInteracting && loaded) {\n        var pos0 = mousePosition(event.targetTouches[0]);\n        var clientX = pos0.x;\n        var clientY = pos0.y;\n\n        if (event.targetTouches.length == 2 && onPointerDownPointerDist != -1) {\n          var pos1 = mousePosition(event.targetTouches[1]);\n          clientX += (pos1.x - pos0.x) * 0.5;\n          clientY += (pos1.y - pos0.y) * 0.5;\n          var clientDist = Math.sqrt((pos0.x - pos1.x) * (pos0.x - pos1.x) + (pos0.y - pos1.y) * (pos0.y - pos1.y));\n          setHfov(config.hfov + (onPointerDownPointerDist - clientDist) * 0.1);\n          onPointerDownPointerDist = clientDist;\n        } // The smaller the config.hfov value (the more zoomed-in the user is), the faster\n        // yaw/pitch are perceived to change on one-finger touchmove (panning) events and vice versa.\n        // To improve usability at both small and large zoom levels (config.hfov values)\n        // we introduce a dynamic pan speed coefficient.\n        //\n        // Currently this seems to *roughly* keep initial drag/pan start position close to\n        // the user's finger while panning regardless of zoom level / config.hfov value.\n\n\n        var touchmovePanSpeedCoeff = config.hfov / 360 * config.touchPanSpeedCoeffFactor;\n        var yaw = (onPointerDownPointerX - clientX) * touchmovePanSpeedCoeff + onPointerDownYaw;\n        speed.yaw = (yaw - config.yaw) % 360 * 0.2;\n        config.yaw = yaw;\n        var pitch = (clientY - onPointerDownPointerY) * touchmovePanSpeedCoeff + onPointerDownPitch;\n        speed.pitch = (pitch - config.pitch) * 0.2;\n        config.pitch = pitch;\n      }\n    }\n    /**\r\n    * Event handler for end of touches. Stops panning and/or zooming.\r\n    * @private\r\n    */\n\n\n    function onDocumentTouchEnd() {\n      isUserInteracting = false;\n\n      if (Date.now() - latestInteraction > 150) {\n        speed.pitch = speed.yaw = 0;\n      }\n\n      onPointerDownPointerDist = -1;\n      latestInteraction = Date.now();\n      fireEvent('touchend', event);\n    }\n\n    var pointerIDs = [],\n        pointerCoordinates = [];\n    /**\r\n    * Event handler for touch starts in IE / Edge.\r\n    * @private\r\n    * @param {PointerEvent} event - Document pointer down event.\r\n    */\n\n    function onDocumentPointerDown(event) {\n      if (event.pointerType == 'touch') {\n        pointerIDs.push(event.pointerId);\n        pointerCoordinates.push({\n          clientX: event.clientX,\n          clientY: event.clientY\n        });\n        event.targetTouches = pointerCoordinates;\n        onDocumentTouchStart(event);\n        event.preventDefault();\n      }\n    }\n    /**\r\n    * Event handler for touch moves in IE / Edge.\r\n    * @private\r\n    * @param {PointerEvent} event - Document pointer move event.\r\n    */\n\n\n    function onDocumentPointerMove(event) {\n      if (event.pointerType == 'touch') {\n        for (var i = 0; i < pointerIDs.length; i++) {\n          if (event.pointerId == pointerIDs[i]) {\n            pointerCoordinates[i].clientX = event.clientX;\n            pointerCoordinates[i].clientY = event.clientY;\n            event.targetTouches = pointerCoordinates;\n            onDocumentTouchMove(event);\n            event.preventDefault();\n            return;\n          }\n        }\n      }\n    }\n    /**\r\n    * Event handler for touch ends in IE / Edge.\r\n    * @private\r\n    * @param {PointerEvent} event - Document pointer up event.\r\n    */\n\n\n    function onDocumentPointerUp(event) {\n      if (event.pointerType == 'touch') {\n        var defined = false;\n\n        for (var i = 0; i < pointerIDs.length; i++) {\n          if (event.pointerId == pointerIDs[i]) {\n            pointerIDs[i] = undefined;\n          }\n\n          if (pointerIDs[i]) {\n            defined = true;\n          }\n        }\n\n        if (!defined) {\n          pointerIDs = [];\n          pointerCoordinates = [];\n          onDocumentTouchEnd();\n        }\n\n        event.preventDefault();\n      }\n    }\n    /**\r\n    * Event handler for mouse wheel. Changes zoom.\r\n    * @private\r\n    * @param {WheelEvent} event - Document mouse wheel event.\r\n    */\n\n\n    function onDocumentMouseWheel(event) {\n      // Only do something if the panorama is loaded and mouse wheel zoom is enabled\n      if (!loaded || config.mouseZoom == 'fullscreenonly' && !fullscreenActive) {\n        return;\n      }\n\n      event.preventDefault(); // Turn off auto-rotation if enabled\n\n      stopAnimation();\n      latestInteraction = Date.now();\n\n      if (event.wheelDeltaY) {\n        // WebKit\n        setHfov(config.hfov - event.wheelDeltaY * 0.05);\n        speed.hfov = event.wheelDelta < 0 ? 1 : -1;\n      } else if (event.wheelDelta) {\n        // Opera / Explorer 9\n        setHfov(config.hfov - event.wheelDelta * 0.05);\n        speed.hfov = event.wheelDelta < 0 ? 1 : -1;\n      } else if (event.detail) {\n        // Firefox\n        setHfov(config.hfov + event.detail * 1.5);\n        speed.hfov = event.detail > 0 ? 1 : -1;\n      }\n\n      animateInit();\n    }\n    /**\r\n    * Event handler for key presses. Updates list of currently pressed keys.\r\n    * @private\r\n    * @param {KeyboardEvent} event - Document key press event.\r\n    */\n\n\n    function onDocumentKeyPress(event) {\n      // Turn off auto-rotation if enabled\n      stopAnimation();\n      latestInteraction = Date.now();\n      stopOrientation();\n      config.roll = 0; // Record key pressed\n\n      var keynumber = event.which || event.keycode; // Override default action for keys that are used\n\n      if (config.capturedKeyNumbers.indexOf(keynumber) < 0) {\n        return;\n      }\n\n      event.preventDefault(); // If escape key is pressed\n\n      if (keynumber == 27) {\n        // If in fullscreen mode\n        if (fullscreenActive) {\n          toggleFullscreen();\n        }\n      } else {\n        // Change key\n        changeKey(keynumber, true);\n      }\n    }\n    /**\r\n    * Clears list of currently pressed keys.\r\n    * @private\r\n    */\n\n\n    function clearKeys() {\n      for (var i = 0; i < 10; i++) {\n        keysDown[i] = false;\n      }\n    }\n    /**\r\n    * Event handler for key releases. Updates list of currently pressed keys.\r\n    * @private\r\n    * @param {KeyboardEvent} event - Document key up event.\r\n    */\n\n\n    function onDocumentKeyUp(event) {\n      // Record key pressed\n      var keynumber = event.which || event.keycode; // Override default action for keys that are used\n\n      if (config.capturedKeyNumbers.indexOf(keynumber) < 0) {\n        return;\n      }\n\n      event.preventDefault(); // Change key\n\n      changeKey(keynumber, false);\n    }\n    /**\r\n    * Updates list of currently pressed keys.\r\n    * @private\r\n    * @param {number} keynumber - Key number.\r\n    * @param {boolean} value - Whether or not key is pressed.\r\n    */\n\n\n    function changeKey(keynumber, value) {\n      var keyChanged = false;\n\n      switch (keynumber) {\n        // If minus key is released\n        case 109:\n        case 189:\n        case 17:\n        case 173:\n          if (keysDown[0] != value) {\n            keyChanged = true;\n          }\n\n          keysDown[0] = value;\n          break;\n        // If plus key is released\n\n        case 107:\n        case 187:\n        case 16:\n        case 61:\n          if (keysDown[1] != value) {\n            keyChanged = true;\n          }\n\n          keysDown[1] = value;\n          break;\n        // If up arrow is released\n\n        case 38:\n          if (keysDown[2] != value) {\n            keyChanged = true;\n          }\n\n          keysDown[2] = value;\n          break;\n        // If \"w\" is released\n\n        case 87:\n          if (keysDown[6] != value) {\n            keyChanged = true;\n          }\n\n          keysDown[6] = value;\n          break;\n        // If down arrow is released\n\n        case 40:\n          if (keysDown[3] != value) {\n            keyChanged = true;\n          }\n\n          keysDown[3] = value;\n          break;\n        // If \"s\" is released\n\n        case 83:\n          if (keysDown[7] != value) {\n            keyChanged = true;\n          }\n\n          keysDown[7] = value;\n          break;\n        // If left arrow is released\n\n        case 37:\n          if (keysDown[4] != value) {\n            keyChanged = true;\n          }\n\n          keysDown[4] = value;\n          break;\n        // If \"a\" is released\n\n        case 65:\n          if (keysDown[8] != value) {\n            keyChanged = true;\n          }\n\n          keysDown[8] = value;\n          break;\n        // If right arrow is released\n\n        case 39:\n          if (keysDown[5] != value) {\n            keyChanged = true;\n          }\n\n          keysDown[5] = value;\n          break;\n        // If \"d\" is released\n\n        case 68:\n          if (keysDown[9] != value) {\n            keyChanged = true;\n          }\n\n          keysDown[9] = value;\n      }\n\n      if (keyChanged && value) {\n        if (typeof performance !== 'undefined' && performance.now()) {\n          prevTime = performance.now();\n        } else {\n          prevTime = Date.now();\n        }\n\n        animateInit();\n      }\n    }\n    /**\r\n    * Pans and/or zooms panorama based on currently pressed keys. Also handles\r\n    * panorama \"inertia\" and auto rotation.\r\n    * @private\r\n    */\n\n\n    function keyRepeat() {\n      // Only do something if the panorama is loaded\n      if (!loaded) {\n        return;\n      }\n\n      var isKeyDown = false;\n      var prevPitch = config.pitch;\n      var prevYaw = config.yaw;\n      var prevZoom = config.hfov;\n      var newTime;\n\n      if (typeof performance !== 'undefined' && performance.now()) {\n        newTime = performance.now();\n      } else {\n        newTime = Date.now();\n      }\n\n      if (prevTime === undefined) {\n        prevTime = newTime;\n      }\n\n      var diff = (newTime - prevTime) * config.hfov / 1700;\n      diff = Math.min(diff, 1.0); // If minus key is down\n\n      if (keysDown[0] && config.keyboardZoom === true) {\n        setHfov(config.hfov + (speed.hfov * 0.8 + 0.5) * diff);\n        isKeyDown = true;\n      } // If plus key is down\n\n\n      if (keysDown[1] && config.keyboardZoom === true) {\n        setHfov(config.hfov + (speed.hfov * 0.8 - 0.2) * diff);\n        isKeyDown = true;\n      } // If up arrow or \"w\" is down\n\n\n      if (keysDown[2] || keysDown[6]) {\n        // Pan up\n        config.pitch += (speed.pitch * 0.8 + 0.2) * diff;\n        isKeyDown = true;\n      } // If down arrow or \"s\" is down\n\n\n      if (keysDown[3] || keysDown[7]) {\n        // Pan down\n        config.pitch += (speed.pitch * 0.8 - 0.2) * diff;\n        isKeyDown = true;\n      } // If left arrow or \"a\" is down\n\n\n      if (keysDown[4] || keysDown[8]) {\n        // Pan left\n        config.yaw += (speed.yaw * 0.8 - 0.2) * diff;\n        isKeyDown = true;\n      } // If right arrow or \"d\" is down\n\n\n      if (keysDown[5] || keysDown[9]) {\n        // Pan right\n        config.yaw += (speed.yaw * 0.8 + 0.2) * diff;\n        isKeyDown = true;\n      }\n\n      if (isKeyDown) {\n        latestInteraction = Date.now();\n      } // If auto-rotate\n\n\n      var inactivityInterval = Date.now() - latestInteraction;\n\n      if (config.autoRotate) {\n        // Pan\n        if (newTime - prevTime > 0.001) {\n          var timeDiff = (newTime - prevTime) / 1000;\n          var yawDiff = (speed.yaw / timeDiff * diff - config.autoRotate * 0.2) * timeDiff;\n          yawDiff = (-config.autoRotate > 0 ? 1 : -1) * Math.min(Math.abs(config.autoRotate * timeDiff), Math.abs(yawDiff));\n          config.yaw += yawDiff;\n        } // Deal with stopping auto rotation after a set delay\n\n\n        if (config.autoRotateStopDelay) {\n          config.autoRotateStopDelay -= newTime - prevTime;\n\n          if (config.autoRotateStopDelay <= 0) {\n            config.autoRotateStopDelay = false;\n            autoRotateSpeed = config.autoRotate;\n            config.autoRotate = 0;\n          }\n        }\n      } // Animated moves\n\n\n      if (animatedMove.pitch) {\n        animateMove('pitch');\n        prevPitch = config.pitch;\n      }\n\n      if (animatedMove.yaw) {\n        animateMove('yaw');\n        prevYaw = config.yaw;\n      }\n\n      if (animatedMove.hfov) {\n        animateMove('hfov');\n        prevZoom = config.hfov;\n      } // \"Inertia\"\n\n\n      if (diff > 0 && !config.autoRotate) {\n        // \"Friction\"\n        var friction = 0.85; // Yaw\n\n        if (!keysDown[4] && !keysDown[5] && !keysDown[8] && !keysDown[9] && !animatedMove.yaw) {\n          config.yaw += speed.yaw * diff * friction;\n        } // Pitch\n\n\n        if (!keysDown[2] && !keysDown[3] && !keysDown[6] && !keysDown[7] && !animatedMove.pitch) {\n          config.pitch += speed.pitch * diff * friction;\n        } // Zoom\n\n\n        if (!keysDown[0] && !keysDown[1] && !animatedMove.hfov) {\n          setHfov(config.hfov + speed.hfov * diff * friction);\n        }\n      }\n\n      prevTime = newTime;\n\n      if (diff > 0) {\n        speed.yaw = speed.yaw * 0.8 + (config.yaw - prevYaw) / diff * 0.2;\n        speed.pitch = speed.pitch * 0.8 + (config.pitch - prevPitch) / diff * 0.2;\n        speed.hfov = speed.hfov * 0.8 + (config.hfov - prevZoom) / diff * 0.2; // Limit speed\n\n        var maxSpeed = config.autoRotate ? Math.abs(config.autoRotate) : 5;\n        speed.yaw = Math.min(maxSpeed, Math.max(speed.yaw, -maxSpeed));\n        speed.pitch = Math.min(maxSpeed, Math.max(speed.pitch, -maxSpeed));\n        speed.hfov = Math.min(maxSpeed, Math.max(speed.hfov, -maxSpeed));\n      } // Stop movement if opposite controls are pressed\n\n\n      if (keysDown[0] && keysDown[1]) {\n        speed.hfov = 0;\n      }\n\n      if ((keysDown[2] || keysDown[6]) && (keysDown[3] || keysDown[7])) {\n        speed.pitch = 0;\n      }\n\n      if ((keysDown[4] || keysDown[8]) && (keysDown[5] || keysDown[9])) {\n        speed.yaw = 0;\n      }\n    }\n    /**\r\n    * Animates moves.\r\n    * @param {string} axis - Axis to animate\r\n    * @private\r\n    */\n\n\n    function animateMove(axis) {\n      var t = animatedMove[axis];\n      var normTime = Math.min(1, Math.max((Date.now() - t.startTime) / 1000 / (t.duration / 1000), 0));\n      var result = t.startPosition + config.animationTimingFunction(normTime) * (t.endPosition - t.startPosition);\n\n      if (t.endPosition > t.startPosition && result >= t.endPosition || t.endPosition < t.startPosition && result <= t.endPosition || t.endPosition === t.startPosition) {\n        result = t.endPosition;\n        speed[axis] = 0;\n        var callback = animatedMove[axis].callback,\n            callbackArgs = animatedMove[axis].callbackArgs;\n        delete animatedMove[axis];\n\n        if (typeof callback === 'function') {\n          callback(callbackArgs);\n        }\n      }\n\n      config[axis] = result;\n    }\n    /**\r\n    * @param {number} t - Normalized time in animation\r\n    * @return {number} Position in animation\r\n    * @private\r\n    */\n\n\n    function timingFunction(t) {\n      // easeInOutQuad from https://gist.github.com/gre/1650294\n      return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n    }\n    /**\r\n    * Event handler for document resizes. Updates viewer size and rerenders view.\r\n    * @private\r\n    */\n\n\n    function onDocumentResize() {\n      // Resize panorama renderer (moved to onFullScreenChange)\n      //renderer.resize();\n      //animateInit();\n      // Kludge to deal with WebKit regression: https://bugs.webkit.org/show_bug.cgi?id=93525\n      onFullScreenChange();\n    }\n    /**\r\n    * Initializes animation.\r\n    * @private\r\n    */\n\n\n    function animateInit() {\n      if (animating) {\n        return;\n      }\n\n      animating = true;\n      animate();\n    }\n    /**\r\n    * Animates view, using requestAnimationFrame to trigger rendering.\r\n    * @private\r\n    */\n\n\n    function animate() {\n      render();\n\n      if (autoRotateStart) {\n        clearTimeout(autoRotateStart);\n      }\n\n      if (isUserInteracting || orientation === true) {\n        requestAnimationFrame(animate);\n      } else if (keysDown[0] || keysDown[1] || keysDown[2] || keysDown[3] || keysDown[4] || keysDown[5] || keysDown[6] || keysDown[7] || keysDown[8] || keysDown[9] || config.autoRotate || animatedMove.pitch || animatedMove.yaw || animatedMove.hfov || Math.abs(speed.yaw) > 0.01 || Math.abs(speed.pitch) > 0.01 || Math.abs(speed.hfov) > 0.01) {\n        keyRepeat();\n\n        if (config.autoRotateInactivityDelay >= 0 && autoRotateSpeed && Date.now() - latestInteraction > config.autoRotateInactivityDelay && !config.autoRotate) {\n          config.autoRotate = autoRotateSpeed;\n\n          _this.lookAt(origPitch, undefined, origHfov, 3000);\n        }\n\n        requestAnimationFrame(animate);\n      } else if (renderer && (renderer.isLoading() || config.dynamic === true && update)) {\n        requestAnimationFrame(animate);\n      } else {\n        animating = false;\n        prevTime = undefined;\n        var autoRotateStartTime = config.autoRotateInactivityDelay - (Date.now() - latestInteraction);\n\n        if (autoRotateStartTime > 0) {\n          autoRotateStart = setTimeout(function () {\n            config.autoRotate = autoRotateSpeed;\n\n            _this.lookAt(origPitch, undefined, origHfov, 3000);\n\n            animateInit();\n          }, autoRotateStartTime);\n        } else if (config.autoRotateInactivityDelay >= 0 && autoRotateSpeed) {\n          config.autoRotate = autoRotateSpeed;\n\n          _this.lookAt(origPitch, undefined, origHfov, 3000);\n\n          animateInit();\n        }\n      }\n    }\n    /**\r\n    * Renders panorama view.\r\n    * @private\r\n    */\n\n\n    function render() {\n      var tmpyaw;\n\n      if (loaded) {\n        if (config.yaw > 180) {\n          config.yaw -= 360;\n        } else if (config.yaw < -180) {\n          config.yaw += 360;\n        } // Keep a tmp value of yaw for autoRotate comparison later\n\n\n        tmpyaw = config.yaw; // Optionally avoid showing background (empty space) on left or right by adapting min/max yaw\n\n        var hoffcut = 0,\n            voffcut = 0;\n\n        if (config.avoidShowingBackground) {\n          var canvas = renderer.getCanvas(),\n              hfov2 = config.hfov / 2,\n              vfov2 = Math.atan2(Math.tan(hfov2 / 180 * Math.PI), canvas.width / canvas.height) * 180 / Math.PI,\n              transposed = config.vaov > config.haov;\n\n          if (transposed) {\n            voffcut = vfov2 * (1 - Math.min(Math.cos((config.pitch - hfov2) / 180 * Math.PI), Math.cos((config.pitch + hfov2) / 180 * Math.PI)));\n          } else {\n            hoffcut = hfov2 * (1 - Math.min(Math.cos((config.pitch - vfov2) / 180 * Math.PI), Math.cos((config.pitch + vfov2) / 180 * Math.PI)));\n          }\n        } // Ensure the yaw is within min and max allowed\n\n\n        var yawRange = config.maxYaw - config.minYaw,\n            minYaw = -180,\n            maxYaw = 180;\n\n        if (yawRange < 360) {\n          minYaw = config.minYaw + config.hfov / 2 + hoffcut;\n          maxYaw = config.maxYaw - config.hfov / 2 - hoffcut;\n\n          if (yawRange < config.hfov) {\n            // Lock yaw to average of min and max yaw when both can be seen at once\n            minYaw = maxYaw = (minYaw + maxYaw) / 2;\n          }\n\n          config.yaw = Math.max(minYaw, Math.min(maxYaw, config.yaw));\n        } // Check if we autoRotate in a limited by min and max yaw\n        // If so reverse direction\n\n\n        if (config.autoRotate !== false && tmpyaw != config.yaw && prevTime !== undefined) {\n          // this condition prevents changing the direction initially\n          config.autoRotate *= -1;\n        } // Ensure the calculated pitch is within min and max allowed\n\n\n        var canvas = renderer.getCanvas();\n        var vfov = 2 * Math.atan(Math.tan(config.hfov / 180 * Math.PI * 0.5) / (canvas.width / canvas.height)) / Math.PI * 180;\n        var minPitch = config.minPitch + vfov / 2,\n            maxPitch = config.maxPitch - vfov / 2;\n        var pitchRange = config.maxPitch - config.minPitch;\n\n        if (pitchRange < vfov) {\n          // Lock pitch to average of min and max pitch when both can be seen at once\n          minPitch = maxPitch = (minPitch + maxPitch) / 2;\n        }\n\n        if (isNaN(minPitch)) {\n          minPitch = -90;\n        }\n\n        if (isNaN(maxPitch)) {\n          maxPitch = 90;\n        }\n\n        config.pitch = Math.max(minPitch, Math.min(maxPitch, config.pitch));\n        renderer.render(config.pitch * Math.PI / 180, config.yaw * Math.PI / 180, config.hfov * Math.PI / 180, {\n          roll: config.roll * Math.PI / 180\n        });\n        renderHotSpots(); // Update compass\n\n        if (config.compass) {\n          compass.style.transform = 'rotate(' + (-config.yaw - config.northOffset) + 'deg)';\n          compass.style.webkitTransform = 'rotate(' + (-config.yaw - config.northOffset) + 'deg)';\n        }\n\n        if (config.onRender) {\n          config.onRender();\n        }\n      }\n    }\n    /**\r\n    * Creates a new quaternion.\r\n    * @private\r\n    * @constructor\r\n    * @param {Number} w - W value\r\n    * @param {Number} x - X value\r\n    * @param {Number} y - Y value\r\n    * @param {Number} z - Z value\r\n    */\n\n\n    function Quaternion(w, x, y, z) {\n      this.w = w;\n      this.x = x;\n      this.y = y;\n      this.z = z;\n    }\n    /**\r\n    * Multiplies quaternions.\r\n    * @private\r\n    * @param {Quaternion} q - Quaternion to multiply\r\n    * @returns {Quaternion} Result of multiplication\r\n    */\n\n\n    Quaternion.prototype.multiply = function (q) {\n      return new Quaternion(this.w * q.w - this.x * q.x - this.y * q.y - this.z * q.z, this.x * q.w + this.w * q.x + this.y * q.z - this.z * q.y, this.y * q.w + this.w * q.y + this.z * q.x - this.x * q.z, this.z * q.w + this.w * q.z + this.x * q.y - this.y * q.x);\n    };\n    /**\r\n    * Converts quaternion to Euler angles.\r\n    * @private\r\n    * @returns {Number[]} [phi angle, theta angle, psi angle]\r\n    */\n\n\n    Quaternion.prototype.toEulerAngles = function () {\n      var phi = Math.atan2(2 * (this.w * this.x + this.y * this.z), 1 - 2 * (this.x * this.x + this.y * this.y)),\n          theta = Math.asin(2 * (this.w * this.y - this.z * this.x)),\n          psi = Math.atan2(2 * (this.w * this.z + this.x * this.y), 1 - 2 * (this.y * this.y + this.z * this.z));\n      return [phi, theta, psi];\n    };\n    /**\r\n    * Converts device orientation API Tait-Bryan angles to a quaternion.\r\n    * @private\r\n    * @param {Number} alpha - Alpha angle (in degrees)\r\n    * @param {Number} beta - Beta angle (in degrees)\r\n    * @param {Number} gamma - Gamma angle (in degrees)\r\n    * @returns {Quaternion} Orientation quaternion\r\n    */\n\n\n    function taitBryanToQuaternion(alpha, beta, gamma) {\n      var r = [beta ? beta * Math.PI / 180 / 2 : 0, gamma ? gamma * Math.PI / 180 / 2 : 0, alpha ? alpha * Math.PI / 180 / 2 : 0];\n      var c = [Math.cos(r[0]), Math.cos(r[1]), Math.cos(r[2])],\n          s = [Math.sin(r[0]), Math.sin(r[1]), Math.sin(r[2])];\n      return new Quaternion(c[0] * c[1] * c[2] - s[0] * s[1] * s[2], s[0] * c[1] * c[2] - c[0] * s[1] * s[2], c[0] * s[1] * c[2] + s[0] * c[1] * s[2], c[0] * c[1] * s[2] + s[0] * s[1] * c[2]);\n    }\n    /**\r\n    * Computes current device orientation quaternion from device orientation API\r\n    * Tait-Bryan angles.\r\n    * @private\r\n    * @param {Number} alpha - Alpha angle (in degrees)\r\n    * @param {Number} beta - Beta angle (in degrees)\r\n    * @param {Number} gamma - Gamma angle (in degrees)\r\n    * @returns {Quaternion} Orientation quaternion\r\n    */\n\n\n    function computeQuaternion(alpha, beta, gamma) {\n      // Convert Tait-Bryan angles to quaternion\n      var quaternion = taitBryanToQuaternion(alpha, beta, gamma); // Apply world transform\n\n      quaternion = quaternion.multiply(new Quaternion(Math.sqrt(0.5), -Math.sqrt(0.5), 0, 0)); // Apply screen transform\n\n      var angle = window.orientation ? -window.orientation * Math.PI / 180 / 2 : 0;\n      return quaternion.multiply(new Quaternion(Math.cos(angle), 0, -Math.sin(angle), 0));\n    }\n    /**\r\n    * Event handler for device orientation API. Controls pointing.\r\n    * @private\r\n    * @param {DeviceOrientationEvent} event - Device orientation event.\r\n    */\n\n\n    function orientationListener(e) {\n      var q = computeQuaternion(e.alpha, e.beta, e.gamma).toEulerAngles();\n\n      if (typeof orientation === 'number' && orientation < 10) {\n        // This kludge is necessary because iOS sometimes provides a few stale\n        // device orientation events when the listener is removed and then\n        // readded. Thus, we skip the first 10 events to prevent this from\n        // causing problems.\n        orientation += 1;\n      } else if (orientation === 10) {\n        // Record starting yaw to prevent jumping\n        orientationYawOffset = q[2] / Math.PI * 180 + config.yaw;\n        orientation = true;\n        requestAnimationFrame(animate);\n      } else {\n        config.pitch = q[0] / Math.PI * 180;\n        config.roll = -q[1] / Math.PI * 180;\n        config.yaw = -q[2] / Math.PI * 180 + orientationYawOffset;\n      }\n    }\n    /**\r\n    * Initializes renderer.\r\n    * @private\r\n    */\n\n\n    function renderInit() {\n      try {\n        var params = {};\n\n        if (config.horizonPitch !== undefined) {\n          params.horizonPitch = config.horizonPitch * Math.PI / 180;\n        }\n\n        if (config.horizonRoll !== undefined) {\n          params.horizonRoll = config.horizonRoll * Math.PI / 180;\n        }\n\n        if (config.backgroundColor !== undefined) {\n          params.backgroundColor = config.backgroundColor;\n        }\n\n        renderer.init(panoImage, config.type, config.dynamic, config.haov * Math.PI / 180, config.vaov * Math.PI / 180, config.vOffset * Math.PI / 180, renderInitCallback, params);\n\n        if (config.dynamic !== true) {\n          // Allow image to be garbage collected\n          panoImage = undefined;\n        }\n      } catch (event) {\n        // Panorama not loaded\n        // Display error if there is a bad texture\n        if (event.type == 'webgl error' || event.type == 'no webgl') {\n          anError();\n        } else if (event.type == 'webgl size error') {\n          anError(config.strings.textureSizeError.replace('%s', event.width).replace('%s', event.maxWidth));\n        } else {\n          anError(config.strings.unknownError);\n          throw event;\n        }\n      }\n    }\n    /**\r\n    * Triggered when render initialization finishes. Handles fading between\r\n    * scenes as well as showing the compass and hotspots and hiding the loading\r\n    * display.\r\n    * @private\r\n    */\n\n\n    function renderInitCallback() {\n      // Fade if specified\n      if (config.sceneFadeDuration && renderer.fadeImg !== undefined) {\n        renderer.fadeImg.style.opacity = 0; // Remove image\n\n        var fadeImg = renderer.fadeImg;\n        delete renderer.fadeImg;\n        setTimeout(function () {\n          renderContainer.removeChild(fadeImg);\n          fireEvent('scenechangefadedone');\n        }, config.sceneFadeDuration);\n      } // Show compass if applicable\n\n\n      if (config.compass) {\n        compass.style.display = 'inline';\n      } else {\n        compass.style.display = 'none';\n      } // Show hotspots\n\n\n      createHotSpots(); // Hide loading display\n\n      infoDisplay.load.box.style.display = 'none';\n\n      if (preview !== undefined) {\n        renderContainer.removeChild(preview);\n        preview = undefined;\n      }\n\n      loaded = true;\n      fireEvent('load');\n      animateInit();\n    }\n    /**\r\n    * Creates hot spot element for the current scene.\r\n    * @private\r\n    * @param {Object} hs - The configuration for the hotspot\r\n    */\n\n\n    function createHotSpot(hs) {\n      // Make sure hot spot pitch and yaw are numbers\n      hs.pitch = Number(hs.pitch) || 0;\n      hs.yaw = Number(hs.yaw) || 0;\n      var div = document.createElement('div');\n      div.className = 'pnlm-hotspot-base';\n\n      if (hs.cssClass) {\n        div.className += ' ' + hs.cssClass;\n      } else {\n        div.className += ' pnlm-hotspot pnlm-sprite pnlm-' + escapeHTML(hs.type);\n      }\n\n      var span = document.createElement('span');\n\n      if (hs.text) {\n        span.innerHTML = escapeHTML(hs.text);\n      }\n\n      var a;\n\n      if (hs.video) {\n        var video = document.createElement('video'),\n            p = hs.video;\n\n        if (config.basePath && !absoluteURL(p)) {\n          p = config.basePath + p;\n        }\n\n        video.src = sanitizeURL(p);\n        video.controls = true;\n        video.style.width = hs.width + 'px';\n        renderContainer.appendChild(div);\n        span.appendChild(video);\n      } else if (hs.image) {\n        var p = hs.image;\n\n        if (config.basePath && !absoluteURL(p)) {\n          p = config.basePath + p;\n        }\n\n        a = document.createElement('a');\n        a.href = sanitizeURL(hs.URL ? hs.URL : p);\n        a.target = '_blank';\n        span.appendChild(a);\n        var image = document.createElement('img');\n        image.src = sanitizeURL(p);\n        image.style.width = hs.width + 'px';\n        image.style.paddingTop = '5px';\n        renderContainer.appendChild(div);\n        a.appendChild(image);\n        span.style.maxWidth = 'initial';\n      } else if (hs.URL) {\n        a = document.createElement('a');\n        a.href = sanitizeURL(hs.URL);\n        a.target = '_blank';\n        renderContainer.appendChild(a);\n        div.className += ' pnlm-pointer';\n        span.className += ' pnlm-pointer';\n        a.appendChild(div);\n      } else {\n        if (hs.sceneId) {\n          div.onclick = div.ontouchend = function () {\n            if (!div.clicked) {\n              div.clicked = true;\n              loadScene(hs.sceneId, hs.targetPitch, hs.targetYaw, hs.targetHfov);\n            }\n\n            return false;\n          };\n\n          div.className += ' pnlm-pointer';\n          span.className += ' pnlm-pointer';\n        }\n\n        renderContainer.appendChild(div);\n      }\n\n      if (hs.createTooltipFunc) {\n        hs.createTooltipFunc(div, hs.createTooltipArgs);\n      } else if (hs.text || hs.video || hs.image) {\n        div.classList.add('pnlm-tooltip');\n        div.appendChild(span);\n        span.style.width = span.scrollWidth - 20 + 'px';\n        span.style.marginLeft = -(span.scrollWidth - div.offsetWidth) / 2 + 'px';\n        span.style.marginTop = -span.scrollHeight - 12 + 'px';\n      }\n\n      if (hs.clickHandlerFunc) {\n        div.addEventListener('click', function (e) {\n          hs.clickHandlerFunc(e, hs.clickHandlerArgs);\n        }, 'false');\n        div.className += ' pnlm-pointer';\n        span.className += ' pnlm-pointer';\n      }\n\n      hs.div = div;\n    }\n\n    ;\n    /**\r\n    * Creates hot spot elements for the current scene.\r\n    * @private\r\n    */\n\n    function createHotSpots() {\n      if (hotspotsCreated) {\n        return;\n      }\n\n      if (!config.hotSpots) {\n        config.hotSpots = [];\n      } else {\n        // Sort by pitch so tooltip is never obscured by another hot spot\n        config.hotSpots = config.hotSpots.sort(function (a, b) {\n          return a.pitch < b.pitch;\n        });\n        config.hotSpots.forEach(createHotSpot);\n      }\n\n      hotspotsCreated = true;\n      renderHotSpots();\n    }\n    /**\r\n    * Destroys currently created hot spot elements.\r\n    * @private\r\n    */\n\n\n    function destroyHotSpots() {\n      var hs = config.hotSpots;\n      hotspotsCreated = false;\n      delete config.hotSpots;\n\n      if (hs) {\n        for (var i = 0; i < hs.length; i++) {\n          var current = hs[i].div;\n\n          while (current.parentNode != renderContainer) {\n            current = current.parentNode;\n          }\n\n          renderContainer.removeChild(current);\n          delete hs[i].div;\n        }\n      }\n    }\n    /**\r\n    * Renders hot spot, updating its position and visibility.\r\n    * @private\r\n    */\n\n\n    function renderHotSpot(hs) {\n      var hsPitchSin = Math.sin(hs.pitch * Math.PI / 180),\n          hsPitchCos = Math.cos(hs.pitch * Math.PI / 180),\n          configPitchSin = Math.sin(config.pitch * Math.PI / 180),\n          configPitchCos = Math.cos(config.pitch * Math.PI / 180),\n          yawCos = Math.cos((-hs.yaw + config.yaw) * Math.PI / 180);\n      var z = hsPitchSin * configPitchSin + hsPitchCos * yawCos * configPitchCos;\n\n      if (hs.yaw <= 90 && hs.yaw > -90 && z <= 0 || (hs.yaw > 90 || hs.yaw <= -90) && z <= 0) {\n        hs.div.style.visibility = 'hidden';\n      } else {\n        var yawSin = Math.sin((-hs.yaw + config.yaw) * Math.PI / 180),\n            hfovTan = Math.tan(config.hfov * Math.PI / 360);\n        hs.div.style.visibility = 'visible'; // Subpixel rendering doesn't work in Firefox\n        // https://bugzilla.mozilla.org/show_bug.cgi?id=739176\n\n        var canvas = renderer.getCanvas(),\n            canvasWidth = canvas.clientWidth,\n            canvasHeight = canvas.clientHeight;\n        var coord = [-canvasWidth / hfovTan * yawSin * hsPitchCos / z / 2, -canvasWidth / hfovTan * (hsPitchSin * configPitchCos - hsPitchCos * yawCos * configPitchSin) / z / 2]; // Apply roll\n\n        var rollSin = Math.sin(config.roll * Math.PI / 180),\n            rollCos = Math.cos(config.roll * Math.PI / 180);\n        coord = [coord[0] * rollCos - coord[1] * rollSin, coord[0] * rollSin + coord[1] * rollCos]; // Apply transform\n\n        coord[0] += (canvasWidth - hs.div.offsetWidth) / 2;\n        coord[1] += (canvasHeight - hs.div.offsetHeight) / 2;\n        var transform = 'translate(' + coord[0] + 'px, ' + coord[1] + 'px) translateZ(9999px) rotate(' + config.roll + 'deg)';\n        hs.div.style.webkitTransform = transform;\n        hs.div.style.MozTransform = transform;\n        hs.div.style.transform = transform;\n      }\n    }\n    /**\r\n    * Renders hot spots, updating their positions and visibility.\r\n    * @private\r\n    */\n\n\n    function renderHotSpots() {\n      config.hotSpots.forEach(renderHotSpot);\n    }\n    /**\r\n    * Merges a scene configuration into the current configuration.\r\n    * @private\r\n    * @param {string} sceneId - Identifier of scene configuration to merge in.\r\n    */\n\n\n    function mergeConfig(sceneId) {\n      config = {};\n      var k, s;\n      var photoSphereExcludes = ['haov', 'vaov', 'vOffset', 'northOffset', 'horizonPitch', 'horizonRoll'];\n      specifiedPhotoSphereExcludes = []; // Merge default config\n\n      for (k in defaultConfig) {\n        if (defaultConfig.hasOwnProperty(k)) {\n          config[k] = defaultConfig[k];\n        }\n      } // Merge default scene config\n\n\n      for (k in initialConfig.default) {\n        if (initialConfig.default.hasOwnProperty(k)) {\n          if (k == 'strings') {\n            for (s in initialConfig.default.strings) {\n              if (initialConfig.default.strings.hasOwnProperty(s)) {\n                config.strings[s] = escapeHTML(initialConfig.default.strings[s]);\n              }\n            }\n          } else {\n            config[k] = initialConfig.default[k];\n\n            if (photoSphereExcludes.indexOf(k) >= 0) {\n              specifiedPhotoSphereExcludes.push(k);\n            }\n          }\n        }\n      } // Merge current scene config\n\n\n      if (sceneId !== null && sceneId !== '' && initialConfig.scenes && initialConfig.scenes[sceneId]) {\n        var scene = initialConfig.scenes[sceneId];\n\n        for (k in scene) {\n          if (scene.hasOwnProperty(k)) {\n            if (k == 'strings') {\n              for (s in scene.strings) {\n                if (scene.strings.hasOwnProperty(s)) {\n                  config.strings[s] = escapeHTML(scene.strings[s]);\n                }\n              }\n            } else {\n              config[k] = scene[k];\n\n              if (photoSphereExcludes.indexOf(k) >= 0) {\n                specifiedPhotoSphereExcludes.push(k);\n              }\n            }\n          }\n        }\n\n        config.scene = sceneId;\n      } // Merge initial config\n\n\n      for (k in initialConfig) {\n        if (initialConfig.hasOwnProperty(k)) {\n          if (k == 'strings') {\n            for (s in initialConfig.strings) {\n              if (initialConfig.strings.hasOwnProperty(s)) {\n                config.strings[s] = escapeHTML(initialConfig.strings[s]);\n              }\n            }\n          } else {\n            config[k] = initialConfig[k];\n\n            if (photoSphereExcludes.indexOf(k) >= 0) {\n              specifiedPhotoSphereExcludes.push(k);\n            }\n          }\n        }\n      }\n    }\n    /**\r\n    * Processes configuration options.\r\n    * @param {boolean} [isPreview] - Whether or not the preview is being displayed\r\n    * @private\r\n    */\n\n\n    function processOptions(isPreview) {\n      isPreview = isPreview ? isPreview : false; // Process preview first so it always loads before the browser hits its\n      // maximum number of connections to a server as can happen with cubic\n      // panoramas\n\n      if (isPreview && 'preview' in config) {\n        var p = config.preview;\n\n        if (config.basePath && !absoluteURL(p)) {\n          p = config.basePath + p;\n        }\n\n        preview = document.createElement('div');\n        preview.className = 'pnlm-preview-img';\n        preview.style.backgroundImage = \"url('\" + sanitizeURLForCss(p) + \"')\";\n        renderContainer.appendChild(preview);\n      } // Handle different preview values\n\n\n      var title = config.title,\n          author = config.author;\n\n      if (isPreview) {\n        if ('previewTitle' in config) {\n          config.title = config.previewTitle;\n        }\n\n        if ('previewAuthor' in config) {\n          config.author = config.previewAuthor;\n        }\n      } // Reset title / author display\n\n\n      if (!config.hasOwnProperty('title')) {\n        infoDisplay.title.innerHTML = '';\n      }\n\n      if (!config.hasOwnProperty('author')) {\n        infoDisplay.author.innerHTML = '';\n      }\n\n      if (!config.hasOwnProperty('title') && !config.hasOwnProperty('author')) {\n        infoDisplay.container.style.display = 'none';\n      } // Fill in load button label and loading box text\n\n\n      controls.load.innerHTML = '<p>' + config.strings.loadButtonLabel + '</p>';\n      infoDisplay.load.boxp.innerHTML = config.strings.loadingLabel; // Process other options\n\n      for (var key in config) {\n        if (config.hasOwnProperty(key)) {\n          switch (key) {\n            case 'title':\n              infoDisplay.title.innerHTML = escapeHTML(config[key]);\n              infoDisplay.container.style.display = 'inline';\n              break;\n\n            case 'author':\n              infoDisplay.author.innerHTML = config.strings.bylineLabel.replace('%s', escapeHTML(config[key]));\n              infoDisplay.container.style.display = 'inline';\n              break;\n\n            case 'fallback':\n              var link = document.createElement('a');\n              link.href = sanitizeURL(config[key]);\n              link.target = '_blank';\n              link.textContent = 'Click here to view this panorama in an alternative viewer.';\n              var message = document.createElement('p');\n              message.textContent = 'Your browser does not support WebGL.';\n              message.appendChild(document.createElement('br'));\n              message.appendChild(link);\n              infoDisplay.errorMsg.innerHTML = ''; // Removes all children nodes\n\n              infoDisplay.errorMsg.appendChild(message);\n              break;\n\n            case 'hfov':\n              setHfov(Number(config[key]));\n              break;\n\n            case 'autoLoad':\n              if (config[key] === true && renderer === undefined) {\n                // Show loading box\n                infoDisplay.load.box.style.display = 'inline'; // Hide load button\n\n                controls.load.style.display = 'none'; // Initialize\n\n                init();\n              }\n\n              break;\n\n            case 'showZoomCtrl':\n              if (config[key] && config.showControls != false) {\n                // Show zoom controls\n                controls.zoom.style.display = 'block';\n              } else {\n                // Hide zoom controls\n                controls.zoom.style.display = 'none';\n              }\n\n              break;\n\n            case 'showFullscreenCtrl':\n              if (config[key] && config.showControls != false && ('fullscreen' in document || 'mozFullScreen' in document || 'webkitIsFullScreen' in document || 'msFullscreenElement' in document)) {\n                // Show fullscreen control\n                controls.fullscreen.style.display = 'block';\n              } else {\n                // Hide fullscreen control\n                controls.fullscreen.style.display = 'none';\n              }\n\n              break;\n\n            case 'hotSpotDebug':\n              if (config[key]) {\n                hotSpotDebugIndicator.style.display = 'block';\n              } else {\n                hotSpotDebugIndicator.style.display = 'none';\n              }\n\n              break;\n\n            case 'showControls':\n              if (!config[key]) {\n                controls.orientation.style.display = 'none';\n                controls.zoom.style.display = 'none';\n                controls.fullscreen.style.display = 'none';\n              }\n\n              break;\n\n            case 'orientationOnByDefault':\n              if (config[key]) {\n                if (orientationSupport === undefined) {\n                  startOrientationIfSupported = true;\n                } else if (orientationSupport === true) {\n                  startOrientation();\n                }\n              }\n\n              break;\n          }\n        }\n      }\n\n      if (isPreview) {\n        // Restore original values if changed for preview\n        if (title) {\n          config.title = title;\n        } else {\n          delete config.title;\n        }\n\n        if (author) {\n          config.author = author;\n        } else {\n          delete config.author;\n        }\n      }\n    }\n    /**\r\n    * Toggles fullscreen mode.\r\n    * @private\r\n    */\n\n\n    function toggleFullscreen() {\n      if (loaded && !error) {\n        if (!fullscreenActive) {\n          try {\n            if (container.requestFullscreen) {\n              container.requestFullscreen();\n            } else if (container.mozRequestFullScreen) {\n              container.mozRequestFullScreen();\n            } else if (container.msRequestFullscreen) {\n              container.msRequestFullscreen();\n            } else {\n              container.webkitRequestFullScreen();\n            }\n          } catch (event) {// Fullscreen doesn't work\n          }\n        } else {\n          if (document.exitFullscreen) {\n            document.exitFullscreen();\n          } else if (document.mozCancelFullScreen) {\n            document.mozCancelFullScreen();\n          } else if (document.webkitCancelFullScreen) {\n            document.webkitCancelFullScreen();\n          } else if (document.msExitFullscreen) {\n            document.msExitFullscreen();\n          }\n        }\n      }\n    }\n    /**\r\n    * Event handler for fullscreen changes.\r\n    * @private\r\n    */\n\n\n    function onFullScreenChange() {\n      var isFullScreen = window.innerWidth == screen.width && window.innerHeight == screen.height;\n\n      if (document.fullscreen || document.mozFullScreen || document.webkitIsFullScreen || document.msFullscreenElement || isFullScreen) {\n        controls.fullscreen.classList.add('pnlm-fullscreen-toggle-button-active');\n        fullscreenActive = true;\n      } else {\n        controls.fullscreen.classList.remove('pnlm-fullscreen-toggle-button-active');\n        fullscreenActive = false;\n      } // Resize renderer (deal with browser quirks and fixes #155)\n\n\n      renderer.resize();\n      setHfov(config.hfov);\n      animateInit();\n    }\n    /**\r\n    * Increases panorama zoom. For use with zoom button.\r\n    * @private\r\n    */\n\n\n    function zoomIn() {\n      if (loaded) {\n        setHfov(config.hfov - 5);\n        animateInit();\n      }\n    }\n    /**\r\n    * Decreases panorama zoom. For use with zoom button.\r\n    * @private\r\n    */\n\n\n    function zoomOut() {\n      if (loaded) {\n        setHfov(config.hfov + 5);\n        animateInit();\n      }\n    }\n    /**\r\n    * Clamps horzontal field of view to viewer's limits.\r\n    * @private\r\n    * @param {number} hfov - Input horizontal field of view (in degrees)\r\n    * @return {number} - Clamped horizontal field of view (in degrees)\r\n    */\n\n\n    function constrainHfov(hfov) {\n      // Keep field of view within bounds\n      var minHfov = config.minHfov;\n\n      if (config.type == 'multires' && renderer) {\n        minHfov = Math.min(minHfov, renderer.getCanvas().width / (config.multiRes.cubeResolution / 90 * 0.9));\n      }\n\n      if (minHfov > config.maxHfov) {\n        // Don't change view if bounds don't make sense\n        console.log('HFOV bounds do not make sense (minHfov > maxHfov).');\n        return config.hfov;\n      }\n\n      var newHfov = config.hfov;\n\n      if (hfov < minHfov) {\n        newHfov = minHfov;\n      } else if (hfov > config.maxHfov) {\n        newHfov = config.maxHfov;\n      } else {\n        newHfov = hfov;\n      } // Optionally avoid showing background (empty space) on top or bottom by adapting newHfov\n\n\n      if (config.avoidShowingBackground && renderer) {\n        var canvas = renderer.getCanvas();\n        newHfov = Math.min(newHfov, Math.atan(Math.tan((config.maxPitch - config.minPitch) / 360 * Math.PI) / canvas.height * canvas.width) * 360 / Math.PI);\n      }\n\n      return newHfov;\n    }\n    /**\r\n    * Sets viewer's horizontal field of view.\r\n    * @private\r\n    * @param {number} hfov - Desired horizontal field of view in degrees.\r\n    */\n\n\n    function setHfov(hfov) {\n      config.hfov = constrainHfov(hfov);\n    }\n    /**\r\n    * Stops auto rotation and animated moves.\r\n    * @private\r\n    */\n\n\n    function stopAnimation() {\n      animatedMove = {};\n      autoRotateSpeed = config.autoRotate ? config.autoRotate : autoRotateSpeed;\n      config.autoRotate = false;\n    }\n    /**\r\n    * Loads panorama.\r\n    * @private\r\n    */\n\n\n    function load() {\n      // Since WebGL error handling is very general, first we clear any error box\n      // since it is a new scene and the error from previous maybe because of lacking\n      // memory etc and not because of a lack of WebGL support etc\n      clearError();\n      loaded = false;\n      controls.load.style.display = 'none';\n      infoDisplay.load.box.style.display = 'inline';\n      init();\n    }\n    /**\r\n    * Loads scene.\r\n    * @private\r\n    * @param {string} sceneId - Identifier of scene configuration to merge in.\r\n    * @param {number} targetPitch - Pitch viewer should be centered on once scene loads.\r\n    * @param {number} targetYaw - Yaw viewer should be centered on once scene loads.\r\n    * @param {number} targetHfov - HFOV viewer should use once scene loads.\r\n    * @param {boolean} [fadeDone] - If `true`, fade setup is skipped.\r\n    */\n\n\n    function loadScene(sceneId, targetPitch, targetYaw, targetHfov, fadeDone) {\n      loaded = false;\n      animatedMove = {}; // Set up fade if specified\n\n      var fadeImg, workingPitch, workingYaw, workingHfov;\n\n      if (config.sceneFadeDuration && !fadeDone) {\n        var data = renderer.render(config.pitch * Math.PI / 180, config.yaw * Math.PI / 180, config.hfov * Math.PI / 180, {\n          returnImage: true\n        });\n\n        if (data !== undefined) {\n          fadeImg = new Image();\n          fadeImg.className = 'pnlm-fade-img';\n          fadeImg.style.transition = 'opacity ' + config.sceneFadeDuration / 1000 + 's';\n          fadeImg.style.width = '100%';\n          fadeImg.style.height = '100%';\n\n          fadeImg.onload = function () {\n            loadScene(sceneId, targetPitch, targetYaw, targetHfov, true);\n          };\n\n          fadeImg.src = data;\n          renderContainer.appendChild(fadeImg);\n          renderer.fadeImg = fadeImg;\n          return;\n        }\n      } // Set new pointing\n\n\n      if (targetPitch === 'same') {\n        workingPitch = config.pitch;\n      } else {\n        workingPitch = targetPitch;\n      }\n\n      if (targetYaw === 'same') {\n        workingYaw = config.yaw;\n      } else if (targetYaw === 'sameAzimuth') {\n        workingYaw = config.yaw + (config.northOffset || 0) - (initialConfig.scenes[sceneId].northOffset || 0);\n      } else {\n        workingYaw = targetYaw;\n      }\n\n      if (targetHfov === 'same') {\n        workingHfov = config.hfov;\n      } else {\n        workingHfov = targetHfov;\n      } // Destroy hot spots from previous scene\n\n\n      destroyHotSpots(); // Create the new config for the scene\n\n      mergeConfig(sceneId); // Stop motion\n\n      speed.yaw = speed.pitch = speed.hfov = 0; // Reload scene\n\n      processOptions();\n\n      if (workingPitch !== undefined) {\n        config.pitch = workingPitch;\n      }\n\n      if (workingYaw !== undefined) {\n        config.yaw = workingYaw;\n      }\n\n      if (workingHfov !== undefined) {\n        config.hfov = workingHfov;\n      }\n\n      fireEvent('scenechange', sceneId);\n      load();\n    }\n    /**\r\n    * Stop using device orientation.\r\n    * @private\r\n    */\n\n\n    function stopOrientation() {\n      window.removeEventListener('deviceorientation', orientationListener);\n      controls.orientation.classList.remove('pnlm-orientation-button-active');\n      orientation = false;\n    }\n    /**\r\n    * Start using device orientation.\r\n    * @private\r\n    */\n\n\n    function startOrientation() {\n      orientation = 1;\n      window.addEventListener('deviceorientation', orientationListener);\n      controls.orientation.classList.add('pnlm-orientation-button-active');\n    }\n    /**\r\n    * Escapes HTML string (to mitigate possible DOM XSS attacks).\r\n    * @private\r\n    * @param {string} s - String to escape\r\n    * @returns {string} Escaped string\r\n    */\n\n\n    function escapeHTML(s) {\n      if (!initialConfig.escapeHTML) {\n        return String(s).split('\\n').join('<br>');\n      }\n\n      return String(s).split(/&/g).join('&amp;').split('\"').join('&quot;').split(\"'\").join('&#39;').split('<').join('&lt;').split('>').join('&gt;').split('/').join('&#x2f;').split('\\n').join('<br>'); // Allow line breaks\n    }\n    /**\r\n    * Removes possibility of XSS attacks with URLs.\r\n    * The URL cannot be of protocol 'javascript'.\r\n    * @private\r\n    * @param {string} url - URL to sanitize\r\n    * @returns {string} Sanitized URL\r\n    */\n\n\n    function sanitizeURL(url) {\n      if (url.trim().toLowerCase().indexOf('javascript:') === 0) {\n        return 'about:blank';\n      }\n\n      return url;\n    }\n    /**\r\n    * Removes possibility of XSS atacks with URLs for CSS.\r\n    * The URL will be sanitized with `sanitizeURL()` and single quotes\r\n    * and double quotes escaped.\r\n    * @private\r\n    * @param {string} url - URL to sanitize\r\n    * @returns {string} Sanitized URL\r\n    */\n\n\n    function sanitizeURLForCss(url) {\n      return sanitizeURL(url).replace(/\"/g, '%22').replace(/'/g, '%27');\n    }\n    /**\r\n    * Checks whether or not a panorama is loaded.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {boolean} `true` if a panorama is loaded, else `false`\r\n    */\n\n\n    this.isLoaded = function () {\n      return Boolean(loaded);\n    };\n    /**\r\n    * Returns the pitch of the center of the view.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number} Pitch in degrees\r\n    */\n\n\n    this.getPitch = function () {\n      return config.pitch;\n    };\n    /**\r\n    * Sets the pitch of the center of the view.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} pitch - Pitch in degrees\r\n    * @param {boolean|number} [animated=1000] - Animation duration in milliseconds or false for no animation\r\n    * @param {function} [callback] - Function to call when animation finishes\r\n    * @param {object} [callbackArgs] - Arguments to pass to callback function\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.setPitch = function (pitch, animated, callback, callbackArgs) {\n      animated = animated == undefined ? 1000 : Number(animated);\n\n      if (animated) {\n        animatedMove.pitch = {\n          'startTime': Date.now(),\n          'startPosition': config.pitch,\n          'endPosition': pitch,\n          'duration': animated,\n          'callback': callback,\n          'callbackArgs': callbackArgs\n        };\n      } else {\n        config.pitch = pitch;\n      }\n\n      animateInit();\n      return this;\n    };\n    /**\r\n    * Returns the minimum and maximum allowed pitches (in degrees).\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number[]} [minimum pitch, maximum pitch]\r\n    */\n\n\n    this.getPitchBounds = function () {\n      return [config.minPitch, config.maxPitch];\n    };\n    /**\r\n    * Set the minimum and maximum allowed pitches (in degrees).\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number[]} bounds - [minimum pitch, maximum pitch]\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.setPitchBounds = function (bounds) {\n      config.minPitch = Math.max(-90, Math.min(bounds[0], 90));\n      config.maxPitch = Math.max(-90, Math.min(bounds[1], 90));\n      return this;\n    };\n    /**\r\n    * Returns the yaw of the center of the view.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number} Yaw in degrees\r\n    */\n\n\n    this.getYaw = function () {\n      return config.yaw;\n    };\n    /**\r\n    * Sets the yaw of the center of the view.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} yaw - Yaw in degrees [-180, 180]\r\n    * @param {boolean|number} [animated=1000] - Animation duration in milliseconds or false for no animation\r\n    * @param {function} [callback] - Function to call when animation finishes\r\n    * @param {object} [callbackArgs] - Arguments to pass to callback function\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.setYaw = function (yaw, animated, callback, callbackArgs) {\n      animated = animated == undefined ? 1000 : Number(animated);\n      yaw = (yaw + 180) % 360 - 180; // Keep in bounds\n\n      if (animated) {\n        // Animate in shortest direction\n        if (config.yaw - yaw > 180) {\n          yaw += 360;\n        } else if (yaw - config.yaw > 180) {\n          yaw -= 360;\n        }\n\n        animatedMove.yaw = {\n          'startTime': Date.now(),\n          'startPosition': config.yaw,\n          'endPosition': yaw,\n          'duration': animated,\n          'callback': callback,\n          'callbackArgs': callbackArgs\n        };\n      } else {\n        config.yaw = yaw;\n      }\n\n      animateInit();\n      return this;\n    };\n    /**\r\n    * Returns the minimum and maximum allowed pitches (in degrees).\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number[]} [yaw pitch, maximum yaw]\r\n    */\n\n\n    this.getYawBounds = function () {\n      return [config.minYaw, config.maxYaw];\n    };\n    /**\r\n    * Set the minimum and maximum allowed yaws (in degrees [-180, 180]).\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number[]} bounds - [minimum yaw, maximum yaw]\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.setYawBounds = function (bounds) {\n      config.minYaw = Math.max(-180, Math.min(bounds[0], 180));\n      config.maxYaw = Math.max(-180, Math.min(bounds[1], 180));\n      return this;\n    };\n    /**\r\n    * Returns the horizontal field of view.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number} Horizontal field of view in degrees\r\n    */\n\n\n    this.getHfov = function () {\n      return config.hfov;\n    };\n    /**\r\n    * Sets the horizontal field of view.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} hfov - Horizontal field of view in degrees\r\n    * @param {boolean|number} [animated=1000] - Animation duration in milliseconds or false for no animation\r\n    * @param {function} [callback] - Function to call when animation finishes\r\n    * @param {object} [callbackArgs] - Arguments to pass to callback function\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.setHfov = function (hfov, animated, callback, callbackArgs) {\n      animated = animated == undefined ? 1000 : Number(animated);\n\n      if (animated) {\n        animatedMove.hfov = {\n          'startTime': Date.now(),\n          'startPosition': config.hfov,\n          'endPosition': constrainHfov(hfov),\n          'duration': animated,\n          'callback': callback,\n          'callbackArgs': callbackArgs\n        };\n      } else {\n        setHfov(hfov);\n      }\n\n      animateInit();\n      return this;\n    };\n    /**\r\n    * Returns the minimum and maximum allowed horizontal fields of view\r\n    * (in degrees).\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number[]} [minimum hfov, maximum hfov]\r\n    */\n\n\n    this.getHfovBounds = function () {\n      return [config.minHfov, config.maxHfov];\n    };\n    /**\r\n    * Set the minimum and maximum allowed horizontal fields of view (in degrees).\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number[]} bounds - [minimum hfov, maximum hfov]\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.setHfovBounds = function (bounds) {\n      config.minHfov = Math.max(0, bounds[0]);\n      config.maxHfov = Math.max(0, bounds[1]);\n      return this;\n    };\n    /**\r\n    * Set a new view. Any parameters not specified remain the same.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} [pitch] - Target pitch\r\n    * @param {number} [yaw] - Target yaw\r\n    * @param {number} [hfov] - Target hfov\r\n    * @param {boolean|number} [animated=1000] - Animation duration in milliseconds or false for no animation\r\n    * @param {function} [callback] - Function to call when animation finishes\r\n    * @param {object} [callbackArgs] - Arguments to pass to callback function\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.lookAt = function (pitch, yaw, hfov, animated, callback, callbackArgs) {\n      animated = animated == undefined ? 1000 : Number(animated);\n\n      if (pitch !== undefined) {\n        this.setPitch(pitch, animated, callback, callbackArgs);\n        callback = undefined;\n      }\n\n      if (yaw !== undefined) {\n        this.setYaw(yaw, animated, callback, callbackArgs);\n        callback = undefined;\n      }\n\n      if (hfov !== undefined) {\n        this.setHfov(hfov, animated, callback, callbackArgs);\n      }\n\n      return this;\n    };\n    /**\r\n    * Returns the panorama's north offset.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number} North offset in degrees\r\n    */\n\n\n    this.getNorthOffset = function () {\n      return config.northOffset;\n    };\n    /**\r\n    * Sets the panorama's north offset.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} heading - North offset in degrees\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.setNorthOffset = function (heading) {\n      config.northOffset = Math.min(360, Math.max(0, heading));\n      animateInit();\n      return this;\n    };\n    /**\r\n    * Returns the panorama's horizon roll.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number} Horizon roll in degrees\r\n    */\n\n\n    this.getHorizonRoll = function () {\n      return config.horizonRoll;\n    };\n    /**\r\n    * Sets the panorama's horizon roll.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} roll - Horizon roll in degrees [-90, 90]\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.setHorizonRoll = function (roll) {\n      config.horizonRoll = Math.min(90, Math.max(-90, roll));\n      renderer.setPose(config.horizonPitch * Math.PI / 180, config.horizonRoll * Math.PI / 180);\n      animateInit();\n      return this;\n    };\n    /**\r\n    * Returns the panorama's horizon pitch.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number} Horizon pitch in degrees\r\n    */\n\n\n    this.getHorizonPitch = function () {\n      return config.horizonPitch;\n    };\n    /**\r\n    * Sets the panorama's horizon pitch.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} pitch - Horizon pitch in degrees [-90, 90]\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.setHorizonPitch = function (pitch) {\n      config.horizonPitch = Math.min(90, Math.max(-90, pitch));\n      renderer.setPose(config.horizonPitch * Math.PI / 180, config.horizonRoll * Math.PI / 180);\n      animateInit();\n      return this;\n    };\n    /**\r\n    * Start auto rotation.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} [speed] - Auto rotation speed / direction. If not specified, previous value is used.\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.startAutoRotate = function (speed) {\n      speed = speed || autoRotateSpeed || 1;\n      config.autoRotate = speed;\n\n      _this.lookAt(origPitch, undefined, origHfov, 3000);\n\n      animateInit();\n      return this;\n    };\n    /**\r\n    * Stop auto rotation.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.stopAutoRotate = function () {\n      autoRotateSpeed = config.autoRotate ? config.autoRotate : autoRotateSpeed;\n      config.autoRotate = false;\n      config.autoRotateInactivityDelay = -1;\n      return this;\n    };\n    /**\r\n    * Returns the panorama renderer.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {Renderer}\r\n    */\n\n\n    this.getRenderer = function () {\n      return renderer;\n    };\n    /**\r\n    * Sets update flag for dynamic content.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {boolean} bool - Whether or not viewer should update even when still\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.setUpdate = function (bool) {\n      update = bool === true;\n\n      if (renderer === undefined) {\n        onImageLoad();\n      } else {\n        animateInit();\n      }\n\n      return this;\n    };\n    /**\r\n    * Calculate panorama pitch and yaw from location of mouse event.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {MouseEvent} event - Document mouse down event.\r\n    * @returns {number[]} [pitch, yaw]\r\n    */\n\n\n    this.mouseEventToCoords = function (event) {\n      return mouseEventToCoords(event);\n    };\n    /**\r\n    * Change scene being viewed.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {string} sceneId - Identifier of scene to switch to.\r\n    * @param {number} [pitch] - Pitch to use with new scene\r\n    * @param {number} [yaw] - Yaw to use with new scene\r\n    * @param {number} [hfov] - HFOV to use with new scene\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.loadScene = function (sceneId, pitch, yaw, hfov) {\n      if (loaded !== false) {\n        loadScene(sceneId, pitch, yaw, hfov);\n      }\n\n      return this;\n    };\n    /**\r\n    * Get ID of current scene.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {string} ID of current scene\r\n    */\n\n\n    this.getScene = function () {\n      return config.scene;\n    };\n    /**\r\n    * Add a new scene.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {string} sceneId - The ID of the new scene\r\n    * @param {string} config - The configuration of the new scene\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.addScene = function (sceneId, config) {\n      initialConfig.scenes[sceneId] = config;\n      return this;\n    };\n    /**\r\n    * Remove a scene.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {string} sceneId - The ID of the scene\r\n    * @returns {boolean} False if the scene is the current scene or if the scene doesn't exists, else true\r\n    */\n\n\n    this.removeScene = function (sceneId) {\n      if (config.scene === sceneId || !initialConfig.scenes.hasOwnProperty(sceneId)) {\n        return false;\n      }\n\n      delete initialConfig.scenes[sceneId];\n      return true;\n    };\n    /**\r\n    * Toggle fullscreen.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.toggleFullscreen = function () {\n      toggleFullscreen();\n      return this;\n    };\n    /**\r\n    * Get configuration of current scene.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {Object} Configuration of current scene\r\n    */\n\n\n    this.getConfig = function () {\n      return config;\n    };\n    /**\r\n    * Get viewer's container element.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {HTMLElement} Container `div` element\r\n    */\n\n\n    this.getContainer = function () {\n      return container;\n    };\n    /**\r\n    * Add a new hot spot.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {Object} hs - The configuration for the hot spot\r\n    * @param {string} [sceneId] - Adds hot spot to specified scene if provided, else to current scene\r\n    * @returns {Viewer} `this`\r\n    * @throws Throws an error if the scene ID is provided but invalid\r\n    */\n\n\n    this.addHotSpot = function (hs, sceneId) {\n      if (sceneId === undefined && config.scene === undefined) {\n        // Not a tour\n        config.hotSpots.push(hs);\n      } else {\n        // Tour\n        var id = sceneId !== undefined ? sceneId : config.scene;\n\n        if (initialConfig.scenes.hasOwnProperty(id)) {\n          if (!initialConfig.scenes[id].hasOwnProperty('hotSpots')) {\n            initialConfig.scenes[id].hotSpots = []; // Create hot spots array if needed\n\n            if (id == config.scene) {\n              config.hotSpots = initialConfig.scenes[id].hotSpots;\n            } // Link to current config\n\n          }\n\n          initialConfig.scenes[id].hotSpots.push(hs); // Add hot spot to config\n        } else {\n          throw 'Invalid scene ID!';\n        }\n      }\n\n      if (sceneId === undefined || config.scene == sceneId) {\n        // Add to current scene\n        createHotSpot(hs);\n\n        if (loaded) {\n          renderHotSpot(hs);\n        }\n      }\n\n      return this;\n    };\n    /**\r\n    * Remove a hot spot.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {string} hotSpotId - The ID of the hot spot\r\n    * @param {string} [sceneId] - Removes hot spot from specified scene if provided, else from current scene\r\n    * @returns {boolean} True if deletion is successful, else false\r\n    */\n\n\n    this.removeHotSpot = function (hotSpotId, sceneId) {\n      if (sceneId === undefined || config.scene == sceneId) {\n        if (!config.hotSpots) {\n          return false;\n        }\n\n        for (var i = 0; i < config.hotSpots.length; i++) {\n          if (config.hotSpots[i].hasOwnProperty('id') && config.hotSpots[i].id === hotSpotId) {\n            // Delete hot spot DOM elements\n            var current = config.hotSpots[i].div;\n\n            while (current.parentNode != renderContainer) {\n              current = current.parentNode;\n            }\n\n            renderContainer.removeChild(current);\n            delete config.hotSpots[i].div; // Remove hot spot from configuration\n\n            config.hotSpots.splice(i, 1);\n            return true;\n          }\n        }\n      } else {\n        if (initialConfig.scenes.hasOwnProperty(sceneId)) {\n          if (!initialConfig.scenes[sceneId].hasOwnProperty('hotSpots')) {\n            return false;\n          }\n\n          for (var i = 0; i < initialConfig.scenes[sceneId].hotSpots.length; i++) {\n            if (initialConfig.scenes[sceneId].hotSpots[i].hasOwnProperty('id') && initialConfig.scenes[sceneId].hotSpots[i].id === hotSpotId) {\n              // Remove hot spot from configuration\n              initialConfig.scenes[sceneId].hotSpots.splice(i, 1);\n              return true;\n            }\n          }\n        } else {\n          return false;\n        }\n      }\n    };\n    /**\r\n    * This method should be called if the viewer's container is resized.\r\n    * @memberof Viewer\r\n    * @instance\r\n    */\n\n\n    this.resize = function () {\n      if (renderer) {\n        onDocumentResize();\n      }\n    };\n    /**\r\n    * Check if a panorama is loaded.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {boolean} True if a panorama is loaded, else false\r\n    */\n\n\n    this.isLoaded = function () {\n      return loaded;\n    };\n    /**\r\n    * Check if device orientation control is supported.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {boolean} True if supported, else false\r\n    */\n\n\n    this.isOrientationSupported = function () {\n      return orientationSupport || false;\n    };\n    /**\r\n    * Stop using device orientation.\r\n    * @memberof Viewer\r\n    * @instance\r\n    */\n\n\n    this.stopOrientation = function () {\n      stopOrientation();\n    };\n    /**\r\n    * Start using device orientation (does nothing if not supported).\r\n    * @memberof Viewer\r\n    * @instance\r\n    */\n\n\n    this.startOrientation = function () {\n      if (orientationSupport) {\n        startOrientation();\n      }\n    };\n    /**\r\n    * Check if device orientation control is currently activated.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {boolean} True if active, else false\r\n    */\n\n\n    this.isOrientationActive = function () {\n      return Boolean(orientation);\n    };\n    /**\r\n    * Subscribe listener to specified event.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {string} type - Type of event to subscribe to.\r\n    * @param {Function} listener - Listener function to subscribe to event.\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.on = function (type, listener) {\n      externalEventListeners[type] = externalEventListeners[type] || [];\n      externalEventListeners[type].push(listener);\n      return this;\n    };\n    /**\r\n    * Remove an event listener (or listeners).\r\n    * @memberof Viewer\r\n    * @param {string} [type] - Type of event to remove listeners from. If not specified, all listeners are removed.\r\n    * @param {Function} [listener] - Listener function to remove. If not specified, all listeners of specified type are removed.\r\n    * @returns {Viewer} `this`\r\n    */\n\n\n    this.off = function (type, listener) {\n      if (!type) {\n        // Remove all listeners if type isn't specified\n        externalEventListeners = {};\n        return this;\n      }\n\n      if (listener) {\n        var i = externalEventListeners[type].indexOf(listener);\n\n        if (i >= 0) {\n          // Remove listener if found\n          externalEventListeners[type].splice(i, 1);\n        }\n\n        if (externalEventListeners[type].length == 0) {\n          // Remove category if empty\n          delete externalEventListeners[type];\n        }\n      } else {\n        // Remove category of listeners if listener isn't specified\n        delete externalEventListeners[type];\n      }\n\n      return this;\n    };\n    /**\r\n    * Fire listeners attached to specified event.\r\n    * @private\r\n    * @param {string} [type] - Type of event to fire listeners for.\r\n    */\n\n\n    function fireEvent(type) {\n      if (type in externalEventListeners) {\n        // Reverse iteration is useful, if event listener is removed inside its definition\n        for (var i = externalEventListeners[type].length; i > 0; i--) {\n          externalEventListeners[type][externalEventListeners[type].length - i].apply(null, [].slice.call(arguments, 1));\n        }\n      }\n    }\n    /**\r\n    * Destructor.\r\n    * @instance\r\n    * @memberof Viewer\r\n    */\n\n\n    this.destroy = function () {\n      if (renderer) {\n        renderer.destroy();\n      }\n\n      ;\n\n      if (listenersAdded) {\n        dragFix.removeEventListener('mousedown', onDocumentMouseDown, false);\n        dragFix.removeEventListener('dblclick', onDocumentDoubleClick, false);\n        document.removeEventListener('mousemove', onDocumentMouseMove, false);\n        document.removeEventListener('mouseup', onDocumentMouseUp, false);\n        container.removeEventListener('mousewheel', onDocumentMouseWheel, false);\n        container.removeEventListener('DOMMouseScroll', onDocumentMouseWheel, false);\n        container.removeEventListener('mozfullscreenchange', onFullScreenChange, false);\n        container.removeEventListener('webkitfullscreenchange', onFullScreenChange, false);\n        container.removeEventListener('msfullscreenchange', onFullScreenChange, false);\n        container.removeEventListener('fullscreenchange', onFullScreenChange, false);\n        window.removeEventListener('resize', onDocumentResize, false);\n        window.removeEventListener('orientationchange', onDocumentResize, false);\n        container.removeEventListener('keydown', onDocumentKeyPress, false);\n        container.removeEventListener('keyup', onDocumentKeyUp, false);\n        container.removeEventListener('blur', clearKeys, false);\n        document.removeEventListener('mouseleave', onDocumentMouseUp, false);\n        dragFix.removeEventListener('touchstart', onDocumentTouchStart, false);\n        dragFix.removeEventListener('touchmove', onDocumentTouchMove, false);\n        dragFix.removeEventListener('touchend', onDocumentTouchEnd, false);\n        dragFix.removeEventListener('pointerdown', onDocumentPointerDown, false);\n        dragFix.removeEventListener('pointermove', onDocumentPointerMove, false);\n        dragFix.removeEventListener('pointerup', onDocumentPointerUp, false);\n        dragFix.removeEventListener('pointerleave', onDocumentPointerUp, false);\n      }\n\n      container.innerHTML = '';\n      container.classList.remove('pnlm-container');\n      uiContainer.classList.remove('pnlm-grab');\n      uiContainer.classList.remove('pnlm-grabbing');\n    };\n  }\n\n  return {\n    viewer: function viewer(container, config) {\n      return new Viewer(container, config);\n    }\n  };\n}(window, document);","map":{"version":3,"sources":["C:/Users/rodet/Documents/GitHub/but-project/node_modules/pannellum-react/es/pannellum/js/pannellum.js"],"names":["window","pannellum","document","undefined","Viewer","container","initialConfig","_this","config","renderer","preview","isUserInteracting","latestInteraction","Date","now","onPointerDownPointerX","onPointerDownPointerY","onPointerDownPointerDist","onPointerDownYaw","onPointerDownPitch","keysDown","Array","fullscreenActive","loaded","error","isTimedOut","listenersAdded","panoImage","prevTime","speed","animating","orientation","orientationYawOffset","autoRotateStart","autoRotateSpeed","origHfov","origPitch","animatedMove","externalEventListeners","specifiedPhotoSphereExcludes","update","hotspotsCreated","defaultConfig","hfov","minHfov","maxHfov","pitch","minPitch","maxPitch","yaw","minYaw","maxYaw","roll","haov","vaov","vOffset","autoRotate","autoRotateInactivityDelay","autoRotateStopDelay","type","northOffset","showFullscreenCtrl","dynamic","doubleClickZoom","keyboardZoom","mouseZoom","showZoomCtrl","autoLoad","showControls","orientationOnByDefault","hotSpotDebug","backgroundColor","avoidShowingBackground","animationTimingFunction","timingFunction","draggable","disableKeyboardCtrl","crossOrigin","touchPanSpeedCoeffFactor","capturedKeyNumbers","strings","loadButtonLabel","loadingLabel","bylineLabel","noPanoramaError","fileAccessError","malformedURLError","iOS8WebGLError","genericWebGLError","textureSizeError","unknownError","getElementById","classList","add","tabIndex","uiContainer","createElement","className","appendChild","renderContainer","dragFix","aboutMsg","innerHTML","addEventListener","aboutMessage","infoDisplay","hotSpotDebugIndicator","title","author","load","box","boxp","lbox","lbar","lbarFill","msg","errorMsg","controls","processOptions","zoom","zoomIn","zoomOut","fullscreen","toggleFullscreen","fullscreenEnabled","mozFullScreenEnabled","webkitFullscreenEnabled","msFullscreenEnabled","e","stopOrientation","startOrientation","stopPropagation","orientationSupport","startOrientationIfSupported","deviceOrientationTest","removeEventListener","alpha","beta","gamma","DeviceOrientationEvent","compass","firstScene","mergeConfig","default","init","div","getElementsByTagName","length","anError","i","p","push","Image","style","display","c","JSON","parse","stringify","multiRes","basePath","test","panorama","itemsToLoad","onLoad","onImageLoad","onError","a","href","target","src","textContent","replace","outerHTML","cubeMap","console","log","absoluteURL","onload","onerror","sanitizeURL","URL","revokeObjectURL","xhr","XMLHttpRequest","onloadend","status","img","response","parseGPanoXMP","onprogress","lengthComputable","percent","total","width","unit","numerator","denominator","toFixed","open","responseType","setRequestHeader","withCredentials","send","remove","url","RegExp","slice","libpannellum","onDocumentMouseDown","onDocumentMouseMove","onDocumentMouseUp","onDocumentMouseWheel","onDocumentDoubleClick","onFullScreenChange","onDocumentResize","onDocumentKeyPress","onDocumentKeyUp","clearKeys","documentElement","pointerAction","touchAction","onDocumentPointerDown","onDocumentPointerMove","onDocumentPointerUp","onDocumentTouchStart","onDocumentTouchMove","onDocumentTouchEnd","navigator","pointerEnabled","renderInit","setHfov","setTimeout","image","reader","FileReader","result","userAgent","toLowerCase","match","flagIndex","indexOf","start","ignoreGPanoXMP","xmpData","substring","getTag","tag","Number","xmp","fullWidth","croppedWidth","fullHeight","croppedHeight","topPixels","heading","horizonPitch","horizonRoll","createObjectURL","readAsBinaryString","readAsText","fireEvent","clearError","event","pos","mousePosition","left","x","top","y","clearTimeout","t1","t2","opacity","preventDefault","bounds","getBoundingClientRect","clientX","clientY","focus","coords","mouseEventToCoords","stopAnimation","animateInit","lookAt","canvas","getCanvas","canvasWidth","clientWidth","canvasHeight","clientHeight","focal","Math","tan","PI","s","sin","cos","root","sqrt","atan","atan2","vfov","pos0","targetTouches","pos1","clientDist","touchmovePanSpeedCoeff","pointerIDs","pointerCoordinates","pointerType","pointerId","defined","wheelDeltaY","wheelDelta","detail","keynumber","which","keycode","changeKey","value","keyChanged","performance","keyRepeat","isKeyDown","prevPitch","prevYaw","prevZoom","newTime","diff","min","inactivityInterval","timeDiff","yawDiff","abs","animateMove","friction","maxSpeed","max","axis","t","normTime","startTime","duration","startPosition","endPosition","callback","callbackArgs","animate","render","requestAnimationFrame","isLoading","autoRotateStartTime","tmpyaw","hoffcut","voffcut","hfov2","vfov2","height","transposed","yawRange","pitchRange","isNaN","renderHotSpots","transform","webkitTransform","onRender","Quaternion","w","z","prototype","multiply","q","toEulerAngles","phi","theta","asin","psi","taitBryanToQuaternion","r","computeQuaternion","quaternion","angle","orientationListener","params","renderInitCallback","maxWidth","sceneFadeDuration","fadeImg","removeChild","createHotSpots","createHotSpot","hs","cssClass","escapeHTML","span","text","video","paddingTop","sceneId","onclick","ontouchend","clicked","loadScene","targetPitch","targetYaw","targetHfov","createTooltipFunc","createTooltipArgs","scrollWidth","marginLeft","offsetWidth","marginTop","scrollHeight","clickHandlerFunc","clickHandlerArgs","hotSpots","sort","b","forEach","destroyHotSpots","current","parentNode","renderHotSpot","hsPitchSin","hsPitchCos","configPitchSin","configPitchCos","yawCos","visibility","yawSin","hfovTan","coord","rollSin","rollCos","offsetHeight","MozTransform","k","photoSphereExcludes","hasOwnProperty","scenes","scene","isPreview","backgroundImage","sanitizeURLForCss","previewTitle","previewAuthor","key","link","message","requestFullscreen","mozRequestFullScreen","msRequestFullscreen","webkitRequestFullScreen","exitFullscreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen","isFullScreen","innerWidth","screen","innerHeight","mozFullScreen","webkitIsFullScreen","msFullscreenElement","resize","constrainHfov","cubeResolution","newHfov","fadeDone","workingPitch","workingYaw","workingHfov","data","returnImage","transition","String","split","join","trim","isLoaded","Boolean","getPitch","setPitch","animated","getPitchBounds","setPitchBounds","getYaw","setYaw","getYawBounds","setYawBounds","getHfov","getHfovBounds","setHfovBounds","getNorthOffset","setNorthOffset","getHorizonRoll","setHorizonRoll","setPose","getHorizonPitch","setHorizonPitch","startAutoRotate","stopAutoRotate","getRenderer","setUpdate","bool","getScene","addScene","removeScene","getConfig","getContainer","addHotSpot","id","removeHotSpot","hotSpotId","splice","isOrientationSupported","isOrientationActive","on","listener","off","apply","call","arguments","destroy","viewer"],"mappings":"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","sourcesContent":["/*\r\n * Pannellum - An HTML5 based Panorama Viewer\r\n * Copyright (c) 2011-2018 Matthew Petroff\r\n * \r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n * \r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n * \r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\nwindow.pannellum = function (window, document, undefined) {\r\n\r\n  /**\r\n  * Creates a new panorama viewer.\r\n  * @constructor\r\n  * @param {HTMLElement|string} container - The container (div) element for the\r\n  *      viewer, or its ID.\r\n  * @param {Object} initialConfig - Inital configuration for viewer.\r\n  */\r\n  function Viewer(container, initialConfig) {\r\n\r\n    var _this = this;\r\n\r\n    // Declare variables\r\n    var config,\r\n        renderer,\r\n        preview,\r\n        isUserInteracting = false,\r\n        latestInteraction = Date.now(),\r\n        onPointerDownPointerX = 0,\r\n        onPointerDownPointerY = 0,\r\n        onPointerDownPointerDist = -1,\r\n        onPointerDownYaw = 0,\r\n        onPointerDownPitch = 0,\r\n        keysDown = new Array(10),\r\n        fullscreenActive = false,\r\n        loaded,\r\n        error = false,\r\n        isTimedOut = false,\r\n        listenersAdded = false,\r\n        panoImage,\r\n        prevTime,\r\n        speed = { 'yaw': 0, 'pitch': 0, 'hfov': 0 },\r\n        animating = false,\r\n        orientation = false,\r\n        orientationYawOffset = 0,\r\n        autoRotateStart,\r\n        autoRotateSpeed = 0,\r\n        origHfov,\r\n        origPitch,\r\n        animatedMove = {},\r\n        externalEventListeners = {},\r\n        specifiedPhotoSphereExcludes = [],\r\n        update = false,\r\n        // Should we update when still to render dynamic content\r\n    hotspotsCreated = false;\r\n\r\n    var defaultConfig = {\r\n      hfov: 100,\r\n      minHfov: 50,\r\n      maxHfov: 120,\r\n      pitch: 0,\r\n      minPitch: undefined,\r\n      maxPitch: undefined,\r\n      yaw: 0,\r\n      minYaw: -180,\r\n      maxYaw: 180,\r\n      roll: 0,\r\n      haov: 360,\r\n      vaov: 180,\r\n      vOffset: 0,\r\n      autoRotate: false,\r\n      autoRotateInactivityDelay: -1,\r\n      autoRotateStopDelay: undefined,\r\n      type: 'equirectangular',\r\n      northOffset: 0,\r\n      showFullscreenCtrl: true,\r\n      dynamic: false,\r\n      doubleClickZoom: true,\r\n      keyboardZoom: true,\r\n      mouseZoom: true,\r\n      showZoomCtrl: true,\r\n      autoLoad: false,\r\n      showControls: true,\r\n      orientationOnByDefault: false,\r\n      hotSpotDebug: false,\r\n      backgroundColor: [0, 0, 0],\r\n      avoidShowingBackground: false,\r\n      animationTimingFunction: timingFunction,\r\n      draggable: true,\r\n      disableKeyboardCtrl: false,\r\n      crossOrigin: 'anonymous',\r\n      touchPanSpeedCoeffFactor: 1,\r\n      capturedKeyNumbers: [16, 17, 27, 37, 38, 39, 40, 61, 65, 68, 83, 87, 107, 109, 173, 187, 189]\r\n    };\r\n\r\n    // Translatable / configurable strings\r\n    // Some strings contain '%s', which is a placeholder for inserted values\r\n    // When setting strings in external configuration, `\\n` should be used instead of `<br>` to insert line breaks\r\n    defaultConfig.strings = {\r\n      // Labels\r\n      loadButtonLabel: 'Click to<br>Load<br>Panorama',\r\n      loadingLabel: 'Loading...',\r\n      bylineLabel: 'by %s', // One substitution: author\r\n\r\n      // Errors\r\n      noPanoramaError: 'No panorama image was specified.',\r\n      fileAccessError: 'The file %s could not be accessed.', // One substitution: file URL\r\n      malformedURLError: 'There is something wrong with the panorama URL.',\r\n      iOS8WebGLError: \"Due to iOS 8's broken WebGL implementation, only \" + \"progressive encoded JPEGs work for your device (this \" + \"panorama uses standard encoding).\",\r\n      genericWebGLError: 'Your browser does not have the necessary WebGL support to display this panorama.',\r\n      textureSizeError: 'This panorama is too big for your device! It\\'s ' + '%spx wide, but your device only supports images up to ' + '%spx wide. Try another device.' + ' (If you\\'re the author, try scaling down the image.)', // Two substitutions: image width, max image width\r\n      unknownError: 'Unknown error. Check developer console.'\r\n    };\r\n\r\n    // Initialize container\r\n    container = typeof container === 'string' ? document.getElementById(container) : container;\r\n    container.classList.add('pnlm-container');\r\n    container.tabIndex = 0;\r\n\r\n    // Create container for ui\r\n    var uiContainer = document.createElement('div');\r\n    uiContainer.className = 'pnlm-ui';\r\n    container.appendChild(uiContainer);\r\n\r\n    // Create container for renderer\r\n    var renderContainer = document.createElement('div');\r\n    renderContainer.className = 'pnlm-render-container';\r\n    container.appendChild(renderContainer);\r\n    var dragFix = document.createElement('div');\r\n    dragFix.className = 'pnlm-dragfix';\r\n    uiContainer.appendChild(dragFix);\r\n\r\n    // Display about information on right click\r\n    var aboutMsg = document.createElement('span');\r\n    aboutMsg.className = 'pnlm-about-msg';\r\n    aboutMsg.innerHTML = '<a href=\"https://pannellum.org/\" target=\"_blank\">Pannellum</a>';\r\n    uiContainer.appendChild(aboutMsg);\r\n    dragFix.addEventListener('contextmenu', aboutMessage);\r\n\r\n    // Create info display\r\n    var infoDisplay = {};\r\n\r\n    // Hot spot debug indicator\r\n    var hotSpotDebugIndicator = document.createElement('div');\r\n    hotSpotDebugIndicator.className = 'pnlm-sprite pnlm-hot-spot-debug-indicator';\r\n    uiContainer.appendChild(hotSpotDebugIndicator);\r\n\r\n    // Panorama info\r\n    infoDisplay.container = document.createElement('div');\r\n    infoDisplay.container.className = 'pnlm-panorama-info';\r\n    infoDisplay.title = document.createElement('div');\r\n    infoDisplay.title.className = 'pnlm-title-box';\r\n    infoDisplay.container.appendChild(infoDisplay.title);\r\n    infoDisplay.author = document.createElement('div');\r\n    infoDisplay.author.className = 'pnlm-author-box';\r\n    infoDisplay.container.appendChild(infoDisplay.author);\r\n    uiContainer.appendChild(infoDisplay.container);\r\n\r\n    // Load box\r\n    infoDisplay.load = {};\r\n    infoDisplay.load.box = document.createElement('div');\r\n    infoDisplay.load.box.className = 'pnlm-load-box';\r\n    infoDisplay.load.boxp = document.createElement('p');\r\n    infoDisplay.load.box.appendChild(infoDisplay.load.boxp);\r\n    infoDisplay.load.lbox = document.createElement('div');\r\n    infoDisplay.load.lbox.className = 'pnlm-lbox';\r\n    infoDisplay.load.lbox.innerHTML = '<div class=\"pnlm-loading\"></div>';\r\n    infoDisplay.load.box.appendChild(infoDisplay.load.lbox);\r\n    infoDisplay.load.lbar = document.createElement('div');\r\n    infoDisplay.load.lbar.className = 'pnlm-lbar';\r\n    infoDisplay.load.lbarFill = document.createElement('div');\r\n    infoDisplay.load.lbarFill.className = 'pnlm-lbar-fill';\r\n    infoDisplay.load.lbar.appendChild(infoDisplay.load.lbarFill);\r\n    infoDisplay.load.box.appendChild(infoDisplay.load.lbar);\r\n    infoDisplay.load.msg = document.createElement('p');\r\n    infoDisplay.load.msg.className = 'pnlm-lmsg';\r\n    infoDisplay.load.box.appendChild(infoDisplay.load.msg);\r\n    uiContainer.appendChild(infoDisplay.load.box);\r\n\r\n    // Error message\r\n    infoDisplay.errorMsg = document.createElement('div');\r\n    infoDisplay.errorMsg.className = 'pnlm-error-msg pnlm-info-box';\r\n    uiContainer.appendChild(infoDisplay.errorMsg);\r\n\r\n    // Create controls\r\n    var controls = {};\r\n    controls.container = document.createElement('div');\r\n    controls.container.className = 'pnlm-controls-container';\r\n    uiContainer.appendChild(controls.container);\r\n\r\n    // Load button\r\n    controls.load = document.createElement('div');\r\n    controls.load.className = 'pnlm-load-button';\r\n    controls.load.addEventListener('click', function () {\r\n      processOptions();\r\n      load();\r\n    });\r\n    uiContainer.appendChild(controls.load);\r\n\r\n    // Zoom controls\r\n    controls.zoom = document.createElement('div');\r\n    controls.zoom.className = 'pnlm-zoom-controls pnlm-controls';\r\n    controls.zoomIn = document.createElement('div');\r\n    controls.zoomIn.className = 'pnlm-zoom-in pnlm-sprite pnlm-control';\r\n    controls.zoomIn.addEventListener('click', zoomIn);\r\n    controls.zoom.appendChild(controls.zoomIn);\r\n    controls.zoomOut = document.createElement('div');\r\n    controls.zoomOut.className = 'pnlm-zoom-out pnlm-sprite pnlm-control';\r\n    controls.zoomOut.addEventListener('click', zoomOut);\r\n    controls.zoom.appendChild(controls.zoomOut);\r\n    controls.container.appendChild(controls.zoom);\r\n\r\n    // Fullscreen toggle\r\n    controls.fullscreen = document.createElement('div');\r\n    controls.fullscreen.addEventListener('click', toggleFullscreen);\r\n    controls.fullscreen.className = 'pnlm-fullscreen-toggle-button pnlm-sprite pnlm-fullscreen-toggle-button-inactive pnlm-controls pnlm-control';\r\n    if (document.fullscreenEnabled || document.mozFullScreenEnabled || document.webkitFullscreenEnabled || document.msFullscreenEnabled) {\r\n      controls.container.appendChild(controls.fullscreen);\r\n    }\r\n\r\n    // Device orientation toggle\r\n    controls.orientation = document.createElement('div');\r\n    controls.orientation.addEventListener('click', function (e) {\r\n      if (orientation) {\r\n        stopOrientation();\r\n      } else {\r\n        startOrientation();\r\n      }\r\n    });\r\n    controls.orientation.addEventListener('mousedown', function (e) {\r\n      e.stopPropagation();\r\n    });\r\n    controls.orientation.addEventListener('touchstart', function (e) {\r\n      e.stopPropagation();\r\n    });\r\n    controls.orientation.addEventListener('pointerdown', function (e) {\r\n      e.stopPropagation();\r\n    });\r\n    controls.orientation.className = 'pnlm-orientation-button pnlm-orientation-button-inactive pnlm-sprite pnlm-controls pnlm-control';\r\n    var orientationSupport,\r\n        startOrientationIfSupported = false;\r\n    function deviceOrientationTest(e) {\r\n      window.removeEventListener('deviceorientation', deviceOrientationTest);\r\n      if (e && e.alpha !== null && e.beta !== null && e.gamma !== null) {\r\n        controls.container.appendChild(controls.orientation);\r\n        orientationSupport = true;\r\n        if (startOrientationIfSupported) {\r\n          startOrientation();\r\n        }\r\n      } else {\r\n        orientationSupport = false;\r\n      }\r\n    }\r\n    if (window.DeviceOrientationEvent) {\r\n      window.addEventListener('deviceorientation', deviceOrientationTest);\r\n    } else {\r\n      orientationSupport = false;\r\n    }\r\n\r\n    // Compass\r\n    var compass = document.createElement('div');\r\n    compass.className = 'pnlm-compass pnlm-controls pnlm-control';\r\n    uiContainer.appendChild(compass);\r\n\r\n    // Load and process configuration\r\n    if (initialConfig.firstScene) {\r\n      // Activate first scene if specified in URL\r\n      mergeConfig(initialConfig.firstScene);\r\n    } else if (initialConfig.default && initialConfig.default.firstScene) {\r\n      // Activate first scene if specified in file\r\n      mergeConfig(initialConfig.default.firstScene);\r\n    } else {\r\n      mergeConfig(null);\r\n    }\r\n    processOptions(true);\r\n\r\n    /**\r\n    * Initializes viewer.\r\n    * @private\r\n    */\r\n    function init() {\r\n      // Display an error for IE 9 as it doesn't work but also doesn't otherwise\r\n      // show an error (older versions don't work at all)\r\n      // Based on: http://stackoverflow.com/a/10965203\r\n      var div = document.createElement(\"div\");\r\n      div.innerHTML = \"<!--[if lte IE 9]><i></i><![endif]-->\";\r\n      if (div.getElementsByTagName(\"i\").length == 1) {\r\n        anError();\r\n        return;\r\n      }\r\n\r\n      origHfov = config.hfov;\r\n      origPitch = config.pitch;\r\n\r\n      var i, p;\r\n\r\n      if (config.type == 'cubemap') {\r\n        panoImage = [];\r\n        for (i = 0; i < 6; i++) {\r\n          panoImage.push(new Image());\r\n          panoImage[i].crossOrigin = config.crossOrigin;\r\n        }\r\n        infoDisplay.load.lbox.style.display = 'block';\r\n        infoDisplay.load.lbar.style.display = 'none';\r\n      } else if (config.type == 'multires') {\r\n        var c = JSON.parse(JSON.stringify(config.multiRes)); // Deep copy\r\n        // Avoid \"undefined\" in path, check (optional) multiRes.basePath, too\r\n        // Use only multiRes.basePath if it's an absolute URL\r\n        if (config.basePath && config.multiRes.basePath && !/^(?:[a-z]+:)?\\/\\//i.test(config.multiRes.basePath)) {\r\n          c.basePath = config.basePath + config.multiRes.basePath;\r\n        } else if (config.multiRes.basePath) {\r\n          c.basePath = config.multiRes.basePath;\r\n        } else if (config.basePath) {\r\n          c.basePath = config.basePath;\r\n        }\r\n        panoImage = c;\r\n      } else {\r\n        if (config.dynamic === true) {\r\n          panoImage = config.panorama;\r\n        } else {\r\n          if (config.panorama === undefined) {\r\n            anError(config.strings.noPanoramaError);\r\n            return;\r\n          }\r\n          panoImage = new Image();\r\n        }\r\n      }\r\n\r\n      // Configure image loading\r\n      if (config.type == 'cubemap') {\r\n        // Quick loading counter for synchronous loading\r\n        var itemsToLoad = 6;\r\n\r\n        var onLoad = function onLoad() {\r\n          itemsToLoad--;\r\n          if (itemsToLoad === 0) {\r\n            onImageLoad();\r\n          }\r\n        };\r\n\r\n        var onError = function onError(e) {\r\n          var a = document.createElement('a');\r\n          a.href = e.target.src;\r\n          a.textContent = a.href;\r\n          anError(config.strings.fileAccessError.replace('%s', a.outerHTML));\r\n        };\r\n\r\n        for (i = 0; i < panoImage.length; i++) {\r\n          p = config.cubeMap[i];\r\n          if (p == \"null\") {\r\n            // support partial cubemap image with explicitly empty faces\r\n            console.log('Will use background instead of missing cubemap face ' + i);\r\n            onLoad();\r\n          } else {\r\n            if (config.basePath && !absoluteURL(p)) {\r\n              p = config.basePath + p;\r\n            }\r\n            panoImage[i].onload = onLoad;\r\n            panoImage[i].onerror = onError;\r\n            panoImage[i].src = sanitizeURL(p);\r\n          }\r\n        }\r\n      } else if (config.type == 'multires') {\r\n        onImageLoad();\r\n      } else {\r\n        p = '';\r\n        if (config.basePath) {\r\n          p = config.basePath;\r\n        }\r\n\r\n        if (config.dynamic !== true) {\r\n          // Still image\r\n          p = absoluteURL(config.panorama) ? config.panorama : p + config.panorama;\r\n\r\n          panoImage.onload = function () {\r\n            window.URL.revokeObjectURL(this.src); // Clean up\r\n            onImageLoad();\r\n          };\r\n\r\n          var xhr = new XMLHttpRequest();\r\n          xhr.onloadend = function () {\r\n            if (xhr.status != 200) {\r\n              // Display error if image can't be loaded\r\n              var a = document.createElement('a');\r\n              a.href = p;\r\n              a.textContent = a.href;\r\n              anError(config.strings.fileAccessError.replace('%s', a.outerHTML));\r\n            }\r\n            var img = this.response;\r\n            parseGPanoXMP(img);\r\n            infoDisplay.load.msg.innerHTML = '';\r\n          };\r\n          xhr.onprogress = function (e) {\r\n            if (e.lengthComputable) {\r\n              // Display progress\r\n              var percent = e.loaded / e.total * 100;\r\n              infoDisplay.load.lbarFill.style.width = percent + '%';\r\n              var unit, numerator, denominator;\r\n              if (e.total > 1e6) {\r\n                unit = 'MB';\r\n                numerator = (e.loaded / 1e6).toFixed(2);\r\n                denominator = (e.total / 1e6).toFixed(2);\r\n              } else if (e.total > 1e3) {\r\n                unit = 'kB';\r\n                numerator = (e.loaded / 1e3).toFixed(1);\r\n                denominator = (e.total / 1e3).toFixed(1);\r\n              } else {\r\n                unit = 'B';\r\n                numerator = e.loaded;\r\n                denominator = e.total;\r\n              }\r\n              infoDisplay.load.msg.innerHTML = numerator + ' / ' + denominator + ' ' + unit;\r\n            } else {\r\n              // Display loading spinner\r\n              infoDisplay.load.lbox.style.display = 'block';\r\n              infoDisplay.load.lbar.style.display = 'none';\r\n            }\r\n          };\r\n          try {\r\n            xhr.open('GET', p, true);\r\n          } catch (e) {\r\n            // Malformed URL\r\n            anError(config.strings.malformedURLError);\r\n          }\r\n          xhr.responseType = 'blob';\r\n          xhr.setRequestHeader('Accept', 'image/*,*/*;q=0.9');\r\n          xhr.withCredentials = config.crossOrigin === 'use-credentials';\r\n          xhr.send();\r\n        }\r\n      }\r\n\r\n      if (config.draggable) {\r\n        uiContainer.classList.add('pnlm-grab');\r\n      }\r\n      uiContainer.classList.remove('pnlm-grabbing');\r\n    }\r\n\r\n    /**\r\n    * Test if URL is absolute or relative.\r\n    * @private\r\n    * @param {string} url - URL to test\r\n    * @returns {boolean} True if absolute, else false\r\n    */\r\n    function absoluteURL(url) {\r\n      // From http://stackoverflow.com/a/19709846\r\n      return new RegExp('^(?:[a-z]+:)?//', 'i').test(url) || url[0] == '/' || url.slice(0, 5) == 'blob:';\r\n    };\r\n\r\n    /**\r\n    * Create renderer and initialize event listeners once image is loaded.\r\n    * @private\r\n    */\r\n    function onImageLoad() {\r\n      if (!renderer) {\r\n        renderer = new libpannellum.renderer(renderContainer);\r\n      }\r\n\r\n      // Only add event listeners once\r\n      if (!listenersAdded) {\r\n        listenersAdded = true;\r\n        dragFix.addEventListener('mousedown', onDocumentMouseDown, false);\r\n        document.addEventListener('mousemove', onDocumentMouseMove, false);\r\n        document.addEventListener('mouseup', onDocumentMouseUp, false);\r\n        if (config.mouseZoom) {\r\n          uiContainer.addEventListener('mousewheel', onDocumentMouseWheel, false);\r\n          uiContainer.addEventListener('DOMMouseScroll', onDocumentMouseWheel, false);\r\n        }\r\n        if (config.doubleClickZoom) {\r\n          dragFix.addEventListener('dblclick', onDocumentDoubleClick, false);\r\n        }\r\n        uiContainer.addEventListener('mozfullscreenchange', onFullScreenChange, false);\r\n        uiContainer.addEventListener('webkitfullscreenchange', onFullScreenChange, false);\r\n        uiContainer.addEventListener('msfullscreenchange', onFullScreenChange, false);\r\n        uiContainer.addEventListener('fullscreenchange', onFullScreenChange, false);\r\n        window.addEventListener('resize', onDocumentResize, false);\r\n        window.addEventListener('orientationchange', onDocumentResize, false);\r\n        if (!config.disableKeyboardCtrl) {\r\n          container.addEventListener('keydown', onDocumentKeyPress, false);\r\n          container.addEventListener('keyup', onDocumentKeyUp, false);\r\n          container.addEventListener('blur', clearKeys, false);\r\n        }\r\n        document.addEventListener('mouseleave', onDocumentMouseUp, false);\r\n        if (document.documentElement.style.pointerAction === '' && document.documentElement.style.touchAction === '') {\r\n          dragFix.addEventListener('pointerdown', onDocumentPointerDown, false);\r\n          dragFix.addEventListener('pointermove', onDocumentPointerMove, false);\r\n          dragFix.addEventListener('pointerup', onDocumentPointerUp, false);\r\n          dragFix.addEventListener('pointerleave', onDocumentPointerUp, false);\r\n        } else {\r\n          dragFix.addEventListener('touchstart', onDocumentTouchStart, false);\r\n          dragFix.addEventListener('touchmove', onDocumentTouchMove, false);\r\n          dragFix.addEventListener('touchend', onDocumentTouchEnd, false);\r\n        }\r\n\r\n        // Deal with MS pointer events\r\n        if (window.navigator.pointerEnabled) {\r\n          container.style.touchAction = 'none';\r\n        }\r\n      }\r\n\r\n      renderInit();\r\n      setHfov(config.hfov); // possibly adapt hfov after configuration and canvas is complete; prevents empty space on top or bottom by zomming out too much\r\n      setTimeout(function () {\r\n        isTimedOut = true;\r\n      }, 500);\r\n    }\r\n\r\n    /**\r\n    * Parses Google Photo Sphere XMP Metadata.\r\n    * https://developers.google.com/photo-sphere/metadata/\r\n    * @private\r\n    * @param {Image} image - Image to read XMP metadata from.\r\n    */\r\n    function parseGPanoXMP(image) {\r\n      var reader = new FileReader();\r\n      reader.addEventListener('loadend', function () {\r\n        var img = reader.result;\r\n\r\n        // This awful browser specific test exists because iOS 8 does not work\r\n        // with non-progressive encoded JPEGs.\r\n        if (navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)) {\r\n          var flagIndex = img.indexOf('\\xff\\xc2');\r\n          if (flagIndex < 0 || flagIndex > 65536) {\r\n            anError(config.strings.iOS8WebGLError);\r\n          }\r\n        }\r\n\r\n        var start = img.indexOf('<x:xmpmeta');\r\n        if (start > -1 && config.ignoreGPanoXMP !== true) {\r\n          var xmpData = img.substring(start, img.indexOf('</x:xmpmeta>') + 12);\r\n\r\n          // Extract the requested tag from the XMP data\r\n          var getTag = function getTag(tag) {\r\n            var result;\r\n            if (xmpData.indexOf(tag + '=\"') >= 0) {\r\n              result = xmpData.substring(xmpData.indexOf(tag + '=\"') + tag.length + 2);\r\n              result = result.substring(0, result.indexOf('\"'));\r\n            } else if (xmpData.indexOf(tag + '>') >= 0) {\r\n              result = xmpData.substring(xmpData.indexOf(tag + '>') + tag.length + 1);\r\n              result = result.substring(0, result.indexOf('<'));\r\n            }\r\n            if (result !== undefined) {\r\n              return Number(result);\r\n            }\r\n            return null;\r\n          };\r\n\r\n          // Relevant XMP data\r\n          var xmp = {\r\n            fullWidth: getTag('GPano:FullPanoWidthPixels'),\r\n            croppedWidth: getTag('GPano:CroppedAreaImageWidthPixels'),\r\n            fullHeight: getTag('GPano:FullPanoHeightPixels'),\r\n            croppedHeight: getTag('GPano:CroppedAreaImageHeightPixels'),\r\n            topPixels: getTag('GPano:CroppedAreaTopPixels'),\r\n            heading: getTag('GPano:PoseHeadingDegrees'),\r\n            horizonPitch: getTag('GPano:PosePitchDegrees'),\r\n            horizonRoll: getTag('GPano:PoseRollDegrees')\r\n          };\r\n\r\n          if (xmp.fullWidth !== null && xmp.croppedWidth !== null && xmp.fullHeight !== null && xmp.croppedHeight !== null && xmp.topPixels !== null) {\r\n\r\n            // Set up viewer using GPano XMP data\r\n            if (specifiedPhotoSphereExcludes.indexOf('haov') < 0) {\r\n              config.haov = xmp.croppedWidth / xmp.fullWidth * 360;\r\n            }\r\n            if (specifiedPhotoSphereExcludes.indexOf('vaov') < 0) {\r\n              config.vaov = xmp.croppedHeight / xmp.fullHeight * 180;\r\n            }\r\n            if (specifiedPhotoSphereExcludes.indexOf('vOffset') < 0) {\r\n              config.vOffset = ((xmp.topPixels + xmp.croppedHeight / 2) / xmp.fullHeight - 0.5) * -180;\r\n            }\r\n            if (xmp.heading !== null && specifiedPhotoSphereExcludes.indexOf('northOffset') < 0) {\r\n              // TODO: make sure this works correctly for partial panoramas\r\n              config.northOffset = xmp.heading;\r\n              if (config.compass !== false) {\r\n                config.compass = true;\r\n              }\r\n            }\r\n            if (xmp.horizonPitch !== null && xmp.horizonRoll !== null) {\r\n              if (specifiedPhotoSphereExcludes.indexOf('horizonPitch') < 0) {\r\n                config.horizonPitch = xmp.horizonPitch;\r\n              }\r\n              if (specifiedPhotoSphereExcludes.indexOf('horizonRoll') < 0) {\r\n                config.horizonRoll = xmp.horizonRoll;\r\n              }\r\n            }\r\n\r\n            // TODO: add support for initial view settings\r\n          }\r\n        }\r\n\r\n        // Load panorama\r\n        panoImage.src = window.URL.createObjectURL(image);\r\n      });\r\n      if (reader.readAsBinaryString !== undefined) {\r\n        reader.readAsBinaryString(image);\r\n      } else {\r\n        reader.readAsText(image);\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Displays an error message.\r\n    * @private\r\n    * @param {string} errorMsg - Error message to display. If not specified, a\r\n    *      generic WebGL error is displayed.\r\n    */\r\n    function anError(errorMsg) {\r\n      if (errorMsg === undefined) {\r\n        errorMsg = config.strings.genericWebGLError;\r\n      }\r\n      infoDisplay.errorMsg.innerHTML = '<p>' + errorMsg + '</p>';\r\n      controls.load.style.display = 'none';\r\n      infoDisplay.load.box.style.display = 'none';\r\n      infoDisplay.errorMsg.style.display = 'table';\r\n      error = true;\r\n      renderContainer.style.display = 'none';\r\n      fireEvent('error', errorMsg);\r\n    }\r\n\r\n    /**\r\n    * Hides error message display.\r\n    * @private\r\n    */\r\n    function clearError() {\r\n      if (error) {\r\n        infoDisplay.load.box.style.display = 'none';\r\n        infoDisplay.errorMsg.style.display = 'none';\r\n        error = false;\r\n        fireEvent('errorcleared');\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Displays about message.\r\n    * @private\r\n    * @param {MouseEvent} event - Right click location\r\n    */\r\n    function aboutMessage(event) {\r\n      var pos = mousePosition(event);\r\n      aboutMsg.style.left = pos.x + 'px';\r\n      aboutMsg.style.top = pos.y + 'px';\r\n      clearTimeout(aboutMessage.t1);\r\n      clearTimeout(aboutMessage.t2);\r\n      aboutMsg.style.display = 'block';\r\n      aboutMsg.style.opacity = 1;\r\n      aboutMessage.t1 = setTimeout(function () {\r\n        aboutMsg.style.opacity = 0;\r\n      }, 2000);\r\n      aboutMessage.t2 = setTimeout(function () {\r\n        aboutMsg.style.display = 'none';\r\n      }, 2500);\r\n      event.preventDefault();\r\n    }\r\n\r\n    /**\r\n    * Calculate mouse position relative to top left of viewer container.\r\n    * @private\r\n    * @param {MouseEvent} event - Mouse event to use in calculation\r\n    * @returns {Object} Calculated X and Y coordinates\r\n    */\r\n    function mousePosition(event) {\r\n      var bounds = container.getBoundingClientRect();\r\n      var pos = {};\r\n      pos.x = event.clientX - bounds.left;\r\n      pos.y = event.clientY - bounds.top;\r\n      return pos;\r\n    }\r\n\r\n    /**\r\n    * Event handler for mouse clicks. Initializes panning. Prints center and click\r\n    * location coordinates when hot spot debugging is enabled.\r\n    * @private\r\n    * @param {MouseEvent} event - Document mouse down event.\r\n    */\r\n    function onDocumentMouseDown(event) {\r\n      // Override default action\r\n      event.preventDefault();\r\n      // But not all of it\r\n      container.focus();\r\n\r\n      // Only do something if the panorama is loaded\r\n      if (!loaded || !config.draggable) {\r\n        return;\r\n      }\r\n\r\n      // Calculate mouse position relative to top left of viewer container\r\n      var pos = mousePosition(event);\r\n\r\n      // Log pitch / yaw of mouse click when debugging / placing hot spots\r\n      if (config.hotSpotDebug) {\r\n        var coords = mouseEventToCoords(event);\r\n        console.log('Pitch: ' + coords[0] + ', Yaw: ' + coords[1] + ', Center Pitch: ' + config.pitch + ', Center Yaw: ' + config.yaw + ', HFOV: ' + config.hfov);\r\n      }\r\n\r\n      // Turn off auto-rotation if enabled\r\n      stopAnimation();\r\n\r\n      stopOrientation();\r\n      config.roll = 0;\r\n\r\n      speed.hfov = 0;\r\n\r\n      isUserInteracting = true;\r\n      latestInteraction = Date.now();\r\n\r\n      onPointerDownPointerX = pos.x;\r\n      onPointerDownPointerY = pos.y;\r\n\r\n      onPointerDownYaw = config.yaw;\r\n      onPointerDownPitch = config.pitch;\r\n\r\n      uiContainer.classList.add('pnlm-grabbing');\r\n      uiContainer.classList.remove('pnlm-grab');\r\n\r\n      fireEvent('mousedown', event);\r\n      animateInit();\r\n    }\r\n\r\n    /**\r\n    * Event handler for double clicks. Zooms in at clicked location\r\n    * @private\r\n    * @param {MouseEvent} event - Document mouse down event.\r\n    */\r\n    function onDocumentDoubleClick(event) {\r\n      if (config.minHfov === config.hfov) {\r\n        _this.setHfov(origHfov, 1000);\r\n      } else {\r\n        var coords = mouseEventToCoords(event);\r\n        _this.lookAt(coords[0], coords[1], config.minHfov, 1000);\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Calculate panorama pitch and yaw from location of mouse event.\r\n    * @private\r\n    * @param {MouseEvent} event - Document mouse down event.\r\n    * @returns {number[]} [pitch, yaw]\r\n    */\r\n    function mouseEventToCoords(event) {\r\n      var pos = mousePosition(event);\r\n      var canvas = renderer.getCanvas();\r\n      var canvasWidth = canvas.clientWidth,\r\n          canvasHeight = canvas.clientHeight;\r\n      var x = pos.x / canvasWidth * 2 - 1;\r\n      var y = (1 - pos.y / canvasHeight * 2) * canvasHeight / canvasWidth;\r\n      var focal = 1 / Math.tan(config.hfov * Math.PI / 360);\r\n      var s = Math.sin(config.pitch * Math.PI / 180);\r\n      var c = Math.cos(config.pitch * Math.PI / 180);\r\n      var a = focal * c - y * s;\r\n      var root = Math.sqrt(x * x + a * a);\r\n      var pitch = Math.atan((y * c + focal * s) / root) * 180 / Math.PI;\r\n      var yaw = Math.atan2(x / root, a / root) * 180 / Math.PI + config.yaw;\r\n      if (yaw < -180) {\r\n        yaw += 360;\r\n      }\r\n      if (yaw > 180) {\r\n        yaw -= 360;\r\n      }\r\n      return [pitch, yaw];\r\n    }\r\n\r\n    /**\r\n    * Event handler for mouse moves. Pans center of view.\r\n    * @private\r\n    * @param {MouseEvent} event - Document mouse move event.\r\n    */\r\n    function onDocumentMouseMove(event) {\r\n      if (isUserInteracting && loaded) {\r\n        latestInteraction = Date.now();\r\n        var canvas = renderer.getCanvas();\r\n        var canvasWidth = canvas.clientWidth,\r\n            canvasHeight = canvas.clientHeight;\r\n        var pos = mousePosition(event);\r\n        //TODO: This still isn't quite right\r\n        var yaw = (Math.atan(onPointerDownPointerX / canvasWidth * 2 - 1) - Math.atan(pos.x / canvasWidth * 2 - 1)) * 180 / Math.PI * config.hfov / 90 + onPointerDownYaw;\r\n        speed.yaw = (yaw - config.yaw) % 360 * 0.2;\r\n        config.yaw = yaw;\r\n\r\n        var vfov = 2 * Math.atan(Math.tan(config.hfov / 360 * Math.PI) * canvasHeight / canvasWidth) * 180 / Math.PI;\r\n\r\n        var pitch = (Math.atan(pos.y / canvasHeight * 2 - 1) - Math.atan(onPointerDownPointerY / canvasHeight * 2 - 1)) * 180 / Math.PI * vfov / 90 + onPointerDownPitch;\r\n        speed.pitch = (pitch - config.pitch) * 0.2;\r\n        config.pitch = pitch;\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Event handler for mouse up events. Stops panning.\r\n    * @private\r\n    */\r\n    function onDocumentMouseUp(event) {\r\n      if (!isUserInteracting) {\r\n        return;\r\n      }\r\n      isUserInteracting = false;\r\n      if (Date.now() - latestInteraction > 15) {\r\n        // Prevents jump when user rapidly moves mouse, stops, and then\r\n        // releases the mouse button\r\n        speed.pitch = speed.yaw = 0;\r\n      }\r\n      uiContainer.classList.add('pnlm-grab');\r\n      uiContainer.classList.remove('pnlm-grabbing');\r\n      latestInteraction = Date.now();\r\n\r\n      fireEvent('mouseup', event);\r\n    }\r\n\r\n    /**\r\n    * Event handler for touches. Initializes panning if one touch or zooming if\r\n    * two touches.\r\n    * @private\r\n    * @param {TouchEvent} event - Document touch start event.\r\n    */\r\n    function onDocumentTouchStart(event) {\r\n      // Only do something if the panorama is loaded\r\n      if (!loaded || !config.draggable) {\r\n        return;\r\n      }\r\n\r\n      // Turn off auto-rotation if enabled\r\n      stopAnimation();\r\n\r\n      stopOrientation();\r\n      config.roll = 0;\r\n\r\n      speed.hfov = 0;\r\n\r\n      // Calculate touch position relative to top left of viewer container\r\n      var pos0 = mousePosition(event.targetTouches[0]);\r\n\r\n      onPointerDownPointerX = pos0.x;\r\n      onPointerDownPointerY = pos0.y;\r\n\r\n      if (event.targetTouches.length == 2) {\r\n        // Down pointer is the center of the two fingers\r\n        var pos1 = mousePosition(event.targetTouches[1]);\r\n        onPointerDownPointerX += (pos1.x - pos0.x) * 0.5;\r\n        onPointerDownPointerY += (pos1.y - pos0.y) * 0.5;\r\n        onPointerDownPointerDist = Math.sqrt((pos0.x - pos1.x) * (pos0.x - pos1.x) + (pos0.y - pos1.y) * (pos0.y - pos1.y));\r\n      }\r\n      isUserInteracting = true;\r\n      latestInteraction = Date.now();\r\n\r\n      onPointerDownYaw = config.yaw;\r\n      onPointerDownPitch = config.pitch;\r\n\r\n      fireEvent('touchstart', event);\r\n      animateInit();\r\n    }\r\n\r\n    /**\r\n    * Event handler for touch movements. Pans center of view if one touch or\r\n    * adjusts zoom if two touches.\r\n    * @private\r\n    * @param {TouchEvent} event - Document touch move event.\r\n    */\r\n    function onDocumentTouchMove(event) {\r\n      if (!config.draggable) {\r\n        return;\r\n      }\r\n\r\n      // Override default action\r\n      event.preventDefault();\r\n      if (loaded) {\r\n        latestInteraction = Date.now();\r\n      }\r\n      if (isUserInteracting && loaded) {\r\n        var pos0 = mousePosition(event.targetTouches[0]);\r\n        var clientX = pos0.x;\r\n        var clientY = pos0.y;\r\n\r\n        if (event.targetTouches.length == 2 && onPointerDownPointerDist != -1) {\r\n          var pos1 = mousePosition(event.targetTouches[1]);\r\n          clientX += (pos1.x - pos0.x) * 0.5;\r\n          clientY += (pos1.y - pos0.y) * 0.5;\r\n          var clientDist = Math.sqrt((pos0.x - pos1.x) * (pos0.x - pos1.x) + (pos0.y - pos1.y) * (pos0.y - pos1.y));\r\n          setHfov(config.hfov + (onPointerDownPointerDist - clientDist) * 0.1);\r\n          onPointerDownPointerDist = clientDist;\r\n        }\r\n\r\n        // The smaller the config.hfov value (the more zoomed-in the user is), the faster\r\n        // yaw/pitch are perceived to change on one-finger touchmove (panning) events and vice versa.\r\n        // To improve usability at both small and large zoom levels (config.hfov values)\r\n        // we introduce a dynamic pan speed coefficient.\r\n        //\r\n        // Currently this seems to *roughly* keep initial drag/pan start position close to\r\n        // the user's finger while panning regardless of zoom level / config.hfov value.\r\n        var touchmovePanSpeedCoeff = config.hfov / 360 * config.touchPanSpeedCoeffFactor;\r\n\r\n        var yaw = (onPointerDownPointerX - clientX) * touchmovePanSpeedCoeff + onPointerDownYaw;\r\n        speed.yaw = (yaw - config.yaw) % 360 * 0.2;\r\n        config.yaw = yaw;\r\n\r\n        var pitch = (clientY - onPointerDownPointerY) * touchmovePanSpeedCoeff + onPointerDownPitch;\r\n        speed.pitch = (pitch - config.pitch) * 0.2;\r\n        config.pitch = pitch;\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Event handler for end of touches. Stops panning and/or zooming.\r\n    * @private\r\n    */\r\n    function onDocumentTouchEnd() {\r\n      isUserInteracting = false;\r\n      if (Date.now() - latestInteraction > 150) {\r\n        speed.pitch = speed.yaw = 0;\r\n      }\r\n      onPointerDownPointerDist = -1;\r\n      latestInteraction = Date.now();\r\n\r\n      fireEvent('touchend', event);\r\n    }\r\n\r\n    var pointerIDs = [],\r\n        pointerCoordinates = [];\r\n    /**\r\n    * Event handler for touch starts in IE / Edge.\r\n    * @private\r\n    * @param {PointerEvent} event - Document pointer down event.\r\n    */\r\n    function onDocumentPointerDown(event) {\r\n      if (event.pointerType == 'touch') {\r\n        pointerIDs.push(event.pointerId);\r\n        pointerCoordinates.push({ clientX: event.clientX, clientY: event.clientY });\r\n        event.targetTouches = pointerCoordinates;\r\n        onDocumentTouchStart(event);\r\n        event.preventDefault();\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Event handler for touch moves in IE / Edge.\r\n    * @private\r\n    * @param {PointerEvent} event - Document pointer move event.\r\n    */\r\n    function onDocumentPointerMove(event) {\r\n      if (event.pointerType == 'touch') {\r\n        for (var i = 0; i < pointerIDs.length; i++) {\r\n          if (event.pointerId == pointerIDs[i]) {\r\n            pointerCoordinates[i].clientX = event.clientX;\r\n            pointerCoordinates[i].clientY = event.clientY;\r\n            event.targetTouches = pointerCoordinates;\r\n            onDocumentTouchMove(event);\r\n            event.preventDefault();\r\n            return;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Event handler for touch ends in IE / Edge.\r\n    * @private\r\n    * @param {PointerEvent} event - Document pointer up event.\r\n    */\r\n    function onDocumentPointerUp(event) {\r\n      if (event.pointerType == 'touch') {\r\n        var defined = false;\r\n        for (var i = 0; i < pointerIDs.length; i++) {\r\n          if (event.pointerId == pointerIDs[i]) {\r\n            pointerIDs[i] = undefined;\r\n          }\r\n          if (pointerIDs[i]) {\r\n            defined = true;\r\n          }\r\n        }\r\n        if (!defined) {\r\n          pointerIDs = [];\r\n          pointerCoordinates = [];\r\n          onDocumentTouchEnd();\r\n        }\r\n        event.preventDefault();\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Event handler for mouse wheel. Changes zoom.\r\n    * @private\r\n    * @param {WheelEvent} event - Document mouse wheel event.\r\n    */\r\n    function onDocumentMouseWheel(event) {\r\n      // Only do something if the panorama is loaded and mouse wheel zoom is enabled\r\n      if (!loaded || config.mouseZoom == 'fullscreenonly' && !fullscreenActive) {\r\n        return;\r\n      }\r\n\r\n      event.preventDefault();\r\n\r\n      // Turn off auto-rotation if enabled\r\n      stopAnimation();\r\n      latestInteraction = Date.now();\r\n\r\n      if (event.wheelDeltaY) {\r\n        // WebKit\r\n        setHfov(config.hfov - event.wheelDeltaY * 0.05);\r\n        speed.hfov = event.wheelDelta < 0 ? 1 : -1;\r\n      } else if (event.wheelDelta) {\r\n        // Opera / Explorer 9\r\n        setHfov(config.hfov - event.wheelDelta * 0.05);\r\n        speed.hfov = event.wheelDelta < 0 ? 1 : -1;\r\n      } else if (event.detail) {\r\n        // Firefox\r\n        setHfov(config.hfov + event.detail * 1.5);\r\n        speed.hfov = event.detail > 0 ? 1 : -1;\r\n      }\r\n\r\n      animateInit();\r\n    }\r\n\r\n    /**\r\n    * Event handler for key presses. Updates list of currently pressed keys.\r\n    * @private\r\n    * @param {KeyboardEvent} event - Document key press event.\r\n    */\r\n    function onDocumentKeyPress(event) {\r\n      // Turn off auto-rotation if enabled\r\n      stopAnimation();\r\n      latestInteraction = Date.now();\r\n\r\n      stopOrientation();\r\n      config.roll = 0;\r\n\r\n      // Record key pressed\r\n      var keynumber = event.which || event.keycode;\r\n\r\n      // Override default action for keys that are used\r\n      if (config.capturedKeyNumbers.indexOf(keynumber) < 0) {\r\n        return;\r\n      }\r\n      event.preventDefault();\r\n\r\n      // If escape key is pressed\r\n      if (keynumber == 27) {\r\n        // If in fullscreen mode\r\n        if (fullscreenActive) {\r\n          toggleFullscreen();\r\n        }\r\n      } else {\r\n        // Change key\r\n        changeKey(keynumber, true);\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Clears list of currently pressed keys.\r\n    * @private\r\n    */\r\n    function clearKeys() {\r\n      for (var i = 0; i < 10; i++) {\r\n        keysDown[i] = false;\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Event handler for key releases. Updates list of currently pressed keys.\r\n    * @private\r\n    * @param {KeyboardEvent} event - Document key up event.\r\n    */\r\n    function onDocumentKeyUp(event) {\r\n      // Record key pressed\r\n      var keynumber = event.which || event.keycode;\r\n\r\n      // Override default action for keys that are used\r\n      if (config.capturedKeyNumbers.indexOf(keynumber) < 0) {\r\n        return;\r\n      }\r\n      event.preventDefault();\r\n\r\n      // Change key\r\n      changeKey(keynumber, false);\r\n    }\r\n\r\n    /**\r\n    * Updates list of currently pressed keys.\r\n    * @private\r\n    * @param {number} keynumber - Key number.\r\n    * @param {boolean} value - Whether or not key is pressed.\r\n    */\r\n    function changeKey(keynumber, value) {\r\n      var keyChanged = false;\r\n      switch (keynumber) {\r\n        // If minus key is released\r\n        case 109:case 189:case 17:case 173:\r\n          if (keysDown[0] != value) {\r\n            keyChanged = true;\r\n          }\r\n          keysDown[0] = value;break;\r\n\r\n        // If plus key is released\r\n        case 107:case 187:case 16:case 61:\r\n          if (keysDown[1] != value) {\r\n            keyChanged = true;\r\n          }\r\n          keysDown[1] = value;break;\r\n\r\n        // If up arrow is released\r\n        case 38:\r\n          if (keysDown[2] != value) {\r\n            keyChanged = true;\r\n          }\r\n          keysDown[2] = value;break;\r\n\r\n        // If \"w\" is released\r\n        case 87:\r\n          if (keysDown[6] != value) {\r\n            keyChanged = true;\r\n          }\r\n          keysDown[6] = value;break;\r\n\r\n        // If down arrow is released\r\n        case 40:\r\n          if (keysDown[3] != value) {\r\n            keyChanged = true;\r\n          }\r\n          keysDown[3] = value;break;\r\n\r\n        // If \"s\" is released\r\n        case 83:\r\n          if (keysDown[7] != value) {\r\n            keyChanged = true;\r\n          }\r\n          keysDown[7] = value;break;\r\n\r\n        // If left arrow is released\r\n        case 37:\r\n          if (keysDown[4] != value) {\r\n            keyChanged = true;\r\n          }\r\n          keysDown[4] = value;break;\r\n\r\n        // If \"a\" is released\r\n        case 65:\r\n          if (keysDown[8] != value) {\r\n            keyChanged = true;\r\n          }\r\n          keysDown[8] = value;break;\r\n\r\n        // If right arrow is released\r\n        case 39:\r\n          if (keysDown[5] != value) {\r\n            keyChanged = true;\r\n          }\r\n          keysDown[5] = value;break;\r\n\r\n        // If \"d\" is released\r\n        case 68:\r\n          if (keysDown[9] != value) {\r\n            keyChanged = true;\r\n          }\r\n          keysDown[9] = value;\r\n      }\r\n\r\n      if (keyChanged && value) {\r\n        if (typeof performance !== 'undefined' && performance.now()) {\r\n          prevTime = performance.now();\r\n        } else {\r\n          prevTime = Date.now();\r\n        }\r\n        animateInit();\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Pans and/or zooms panorama based on currently pressed keys. Also handles\r\n    * panorama \"inertia\" and auto rotation.\r\n    * @private\r\n    */\r\n    function keyRepeat() {\r\n      // Only do something if the panorama is loaded\r\n      if (!loaded) {\r\n        return;\r\n      }\r\n\r\n      var isKeyDown = false;\r\n\r\n      var prevPitch = config.pitch;\r\n      var prevYaw = config.yaw;\r\n      var prevZoom = config.hfov;\r\n\r\n      var newTime;\r\n      if (typeof performance !== 'undefined' && performance.now()) {\r\n        newTime = performance.now();\r\n      } else {\r\n        newTime = Date.now();\r\n      }\r\n      if (prevTime === undefined) {\r\n        prevTime = newTime;\r\n      }\r\n      var diff = (newTime - prevTime) * config.hfov / 1700;\r\n      diff = Math.min(diff, 1.0);\r\n\r\n      // If minus key is down\r\n      if (keysDown[0] && config.keyboardZoom === true) {\r\n        setHfov(config.hfov + (speed.hfov * 0.8 + 0.5) * diff);\r\n        isKeyDown = true;\r\n      }\r\n\r\n      // If plus key is down\r\n      if (keysDown[1] && config.keyboardZoom === true) {\r\n        setHfov(config.hfov + (speed.hfov * 0.8 - 0.2) * diff);\r\n        isKeyDown = true;\r\n      }\r\n\r\n      // If up arrow or \"w\" is down\r\n      if (keysDown[2] || keysDown[6]) {\r\n        // Pan up\r\n        config.pitch += (speed.pitch * 0.8 + 0.2) * diff;\r\n        isKeyDown = true;\r\n      }\r\n\r\n      // If down arrow or \"s\" is down\r\n      if (keysDown[3] || keysDown[7]) {\r\n        // Pan down\r\n        config.pitch += (speed.pitch * 0.8 - 0.2) * diff;\r\n        isKeyDown = true;\r\n      }\r\n\r\n      // If left arrow or \"a\" is down\r\n      if (keysDown[4] || keysDown[8]) {\r\n        // Pan left\r\n        config.yaw += (speed.yaw * 0.8 - 0.2) * diff;\r\n        isKeyDown = true;\r\n      }\r\n\r\n      // If right arrow or \"d\" is down\r\n      if (keysDown[5] || keysDown[9]) {\r\n        // Pan right\r\n        config.yaw += (speed.yaw * 0.8 + 0.2) * diff;\r\n        isKeyDown = true;\r\n      }\r\n\r\n      if (isKeyDown) {\r\n        latestInteraction = Date.now();\r\n      }\r\n\r\n      // If auto-rotate\r\n      var inactivityInterval = Date.now() - latestInteraction;\r\n      if (config.autoRotate) {\r\n        // Pan\r\n        if (newTime - prevTime > 0.001) {\r\n          var timeDiff = (newTime - prevTime) / 1000;\r\n          var yawDiff = (speed.yaw / timeDiff * diff - config.autoRotate * 0.2) * timeDiff;\r\n          yawDiff = (-config.autoRotate > 0 ? 1 : -1) * Math.min(Math.abs(config.autoRotate * timeDiff), Math.abs(yawDiff));\r\n          config.yaw += yawDiff;\r\n        }\r\n\r\n        // Deal with stopping auto rotation after a set delay\r\n        if (config.autoRotateStopDelay) {\r\n          config.autoRotateStopDelay -= newTime - prevTime;\r\n          if (config.autoRotateStopDelay <= 0) {\r\n            config.autoRotateStopDelay = false;\r\n            autoRotateSpeed = config.autoRotate;\r\n            config.autoRotate = 0;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Animated moves\r\n      if (animatedMove.pitch) {\r\n        animateMove('pitch');\r\n        prevPitch = config.pitch;\r\n      }\r\n      if (animatedMove.yaw) {\r\n        animateMove('yaw');\r\n        prevYaw = config.yaw;\r\n      }\r\n      if (animatedMove.hfov) {\r\n        animateMove('hfov');\r\n        prevZoom = config.hfov;\r\n      }\r\n\r\n      // \"Inertia\"\r\n      if (diff > 0 && !config.autoRotate) {\r\n        // \"Friction\"\r\n        var friction = 0.85;\r\n\r\n        // Yaw\r\n        if (!keysDown[4] && !keysDown[5] && !keysDown[8] && !keysDown[9] && !animatedMove.yaw) {\r\n          config.yaw += speed.yaw * diff * friction;\r\n        }\r\n        // Pitch\r\n        if (!keysDown[2] && !keysDown[3] && !keysDown[6] && !keysDown[7] && !animatedMove.pitch) {\r\n          config.pitch += speed.pitch * diff * friction;\r\n        }\r\n        // Zoom\r\n        if (!keysDown[0] && !keysDown[1] && !animatedMove.hfov) {\r\n          setHfov(config.hfov + speed.hfov * diff * friction);\r\n        }\r\n      }\r\n\r\n      prevTime = newTime;\r\n      if (diff > 0) {\r\n        speed.yaw = speed.yaw * 0.8 + (config.yaw - prevYaw) / diff * 0.2;\r\n        speed.pitch = speed.pitch * 0.8 + (config.pitch - prevPitch) / diff * 0.2;\r\n        speed.hfov = speed.hfov * 0.8 + (config.hfov - prevZoom) / diff * 0.2;\r\n\r\n        // Limit speed\r\n        var maxSpeed = config.autoRotate ? Math.abs(config.autoRotate) : 5;\r\n        speed.yaw = Math.min(maxSpeed, Math.max(speed.yaw, -maxSpeed));\r\n        speed.pitch = Math.min(maxSpeed, Math.max(speed.pitch, -maxSpeed));\r\n        speed.hfov = Math.min(maxSpeed, Math.max(speed.hfov, -maxSpeed));\r\n      }\r\n\r\n      // Stop movement if opposite controls are pressed\r\n      if (keysDown[0] && keysDown[1]) {\r\n        speed.hfov = 0;\r\n      }\r\n      if ((keysDown[2] || keysDown[6]) && (keysDown[3] || keysDown[7])) {\r\n        speed.pitch = 0;\r\n      }\r\n      if ((keysDown[4] || keysDown[8]) && (keysDown[5] || keysDown[9])) {\r\n        speed.yaw = 0;\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Animates moves.\r\n    * @param {string} axis - Axis to animate\r\n    * @private\r\n    */\r\n    function animateMove(axis) {\r\n      var t = animatedMove[axis];\r\n      var normTime = Math.min(1, Math.max((Date.now() - t.startTime) / 1000 / (t.duration / 1000), 0));\r\n      var result = t.startPosition + config.animationTimingFunction(normTime) * (t.endPosition - t.startPosition);\r\n      if (t.endPosition > t.startPosition && result >= t.endPosition || t.endPosition < t.startPosition && result <= t.endPosition || t.endPosition === t.startPosition) {\r\n        result = t.endPosition;\r\n        speed[axis] = 0;\r\n        var callback = animatedMove[axis].callback,\r\n            callbackArgs = animatedMove[axis].callbackArgs;\r\n        delete animatedMove[axis];\r\n        if (typeof callback === 'function') {\r\n          callback(callbackArgs);\r\n        }\r\n      }\r\n      config[axis] = result;\r\n    }\r\n\r\n    /**\r\n    * @param {number} t - Normalized time in animation\r\n    * @return {number} Position in animation\r\n    * @private\r\n    */\r\n    function timingFunction(t) {\r\n      // easeInOutQuad from https://gist.github.com/gre/1650294\r\n      return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\r\n    }\r\n\r\n    /**\r\n    * Event handler for document resizes. Updates viewer size and rerenders view.\r\n    * @private\r\n    */\r\n    function onDocumentResize() {\r\n      // Resize panorama renderer (moved to onFullScreenChange)\r\n      //renderer.resize();\r\n      //animateInit();\r\n\r\n      // Kludge to deal with WebKit regression: https://bugs.webkit.org/show_bug.cgi?id=93525\r\n      onFullScreenChange();\r\n    }\r\n\r\n    /**\r\n    * Initializes animation.\r\n    * @private\r\n    */\r\n    function animateInit() {\r\n      if (animating) {\r\n        return;\r\n      }\r\n      animating = true;\r\n      animate();\r\n    }\r\n\r\n    /**\r\n    * Animates view, using requestAnimationFrame to trigger rendering.\r\n    * @private\r\n    */\r\n    function animate() {\r\n      render();\r\n      if (autoRotateStart) {\r\n        clearTimeout(autoRotateStart);\r\n      }\r\n      if (isUserInteracting || orientation === true) {\r\n        requestAnimationFrame(animate);\r\n      } else if (keysDown[0] || keysDown[1] || keysDown[2] || keysDown[3] || keysDown[4] || keysDown[5] || keysDown[6] || keysDown[7] || keysDown[8] || keysDown[9] || config.autoRotate || animatedMove.pitch || animatedMove.yaw || animatedMove.hfov || Math.abs(speed.yaw) > 0.01 || Math.abs(speed.pitch) > 0.01 || Math.abs(speed.hfov) > 0.01) {\r\n\r\n        keyRepeat();\r\n        if (config.autoRotateInactivityDelay >= 0 && autoRotateSpeed && Date.now() - latestInteraction > config.autoRotateInactivityDelay && !config.autoRotate) {\r\n          config.autoRotate = autoRotateSpeed;\r\n          _this.lookAt(origPitch, undefined, origHfov, 3000);\r\n        }\r\n        requestAnimationFrame(animate);\r\n      } else if (renderer && (renderer.isLoading() || config.dynamic === true && update)) {\r\n        requestAnimationFrame(animate);\r\n      } else {\r\n        animating = false;\r\n        prevTime = undefined;\r\n        var autoRotateStartTime = config.autoRotateInactivityDelay - (Date.now() - latestInteraction);\r\n        if (autoRotateStartTime > 0) {\r\n          autoRotateStart = setTimeout(function () {\r\n            config.autoRotate = autoRotateSpeed;\r\n            _this.lookAt(origPitch, undefined, origHfov, 3000);\r\n            animateInit();\r\n          }, autoRotateStartTime);\r\n        } else if (config.autoRotateInactivityDelay >= 0 && autoRotateSpeed) {\r\n          config.autoRotate = autoRotateSpeed;\r\n          _this.lookAt(origPitch, undefined, origHfov, 3000);\r\n          animateInit();\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Renders panorama view.\r\n    * @private\r\n    */\r\n    function render() {\r\n      var tmpyaw;\r\n\r\n      if (loaded) {\r\n        if (config.yaw > 180) {\r\n          config.yaw -= 360;\r\n        } else if (config.yaw < -180) {\r\n          config.yaw += 360;\r\n        }\r\n\r\n        // Keep a tmp value of yaw for autoRotate comparison later\r\n        tmpyaw = config.yaw;\r\n\r\n        // Optionally avoid showing background (empty space) on left or right by adapting min/max yaw\r\n        var hoffcut = 0,\r\n            voffcut = 0;\r\n        if (config.avoidShowingBackground) {\r\n          var canvas = renderer.getCanvas(),\r\n              hfov2 = config.hfov / 2,\r\n              vfov2 = Math.atan2(Math.tan(hfov2 / 180 * Math.PI), canvas.width / canvas.height) * 180 / Math.PI,\r\n              transposed = config.vaov > config.haov;\r\n          if (transposed) {\r\n            voffcut = vfov2 * (1 - Math.min(Math.cos((config.pitch - hfov2) / 180 * Math.PI), Math.cos((config.pitch + hfov2) / 180 * Math.PI)));\r\n          } else {\r\n            hoffcut = hfov2 * (1 - Math.min(Math.cos((config.pitch - vfov2) / 180 * Math.PI), Math.cos((config.pitch + vfov2) / 180 * Math.PI)));\r\n          }\r\n        }\r\n\r\n        // Ensure the yaw is within min and max allowed\r\n        var yawRange = config.maxYaw - config.minYaw,\r\n            minYaw = -180,\r\n            maxYaw = 180;\r\n        if (yawRange < 360) {\r\n          minYaw = config.minYaw + config.hfov / 2 + hoffcut;\r\n          maxYaw = config.maxYaw - config.hfov / 2 - hoffcut;\r\n          if (yawRange < config.hfov) {\r\n            // Lock yaw to average of min and max yaw when both can be seen at once\r\n            minYaw = maxYaw = (minYaw + maxYaw) / 2;\r\n          }\r\n          config.yaw = Math.max(minYaw, Math.min(maxYaw, config.yaw));\r\n        }\r\n\r\n        // Check if we autoRotate in a limited by min and max yaw\r\n        // If so reverse direction\r\n        if (config.autoRotate !== false && tmpyaw != config.yaw && prevTime !== undefined) {\r\n          // this condition prevents changing the direction initially\r\n          config.autoRotate *= -1;\r\n        }\r\n\r\n        // Ensure the calculated pitch is within min and max allowed\r\n        var canvas = renderer.getCanvas();\r\n        var vfov = 2 * Math.atan(Math.tan(config.hfov / 180 * Math.PI * 0.5) / (canvas.width / canvas.height)) / Math.PI * 180;\r\n        var minPitch = config.minPitch + vfov / 2,\r\n            maxPitch = config.maxPitch - vfov / 2;\r\n        var pitchRange = config.maxPitch - config.minPitch;\r\n        if (pitchRange < vfov) {\r\n          // Lock pitch to average of min and max pitch when both can be seen at once\r\n          minPitch = maxPitch = (minPitch + maxPitch) / 2;\r\n        }\r\n        if (isNaN(minPitch)) {\r\n          minPitch = -90;\r\n        }\r\n        if (isNaN(maxPitch)) {\r\n          maxPitch = 90;\r\n        }\r\n        config.pitch = Math.max(minPitch, Math.min(maxPitch, config.pitch));\r\n\r\n        renderer.render(config.pitch * Math.PI / 180, config.yaw * Math.PI / 180, config.hfov * Math.PI / 180, { roll: config.roll * Math.PI / 180 });\r\n\r\n        renderHotSpots();\r\n\r\n        // Update compass\r\n        if (config.compass) {\r\n          compass.style.transform = 'rotate(' + (-config.yaw - config.northOffset) + 'deg)';\r\n          compass.style.webkitTransform = 'rotate(' + (-config.yaw - config.northOffset) + 'deg)';\r\n        }\r\n\r\n        if (config.onRender) {\r\n          config.onRender();\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Creates a new quaternion.\r\n    * @private\r\n    * @constructor\r\n    * @param {Number} w - W value\r\n    * @param {Number} x - X value\r\n    * @param {Number} y - Y value\r\n    * @param {Number} z - Z value\r\n    */\r\n    function Quaternion(w, x, y, z) {\r\n      this.w = w;\r\n      this.x = x;\r\n      this.y = y;\r\n      this.z = z;\r\n    }\r\n\r\n    /**\r\n    * Multiplies quaternions.\r\n    * @private\r\n    * @param {Quaternion} q - Quaternion to multiply\r\n    * @returns {Quaternion} Result of multiplication\r\n    */\r\n    Quaternion.prototype.multiply = function (q) {\r\n      return new Quaternion(this.w * q.w - this.x * q.x - this.y * q.y - this.z * q.z, this.x * q.w + this.w * q.x + this.y * q.z - this.z * q.y, this.y * q.w + this.w * q.y + this.z * q.x - this.x * q.z, this.z * q.w + this.w * q.z + this.x * q.y - this.y * q.x);\r\n    };\r\n\r\n    /**\r\n    * Converts quaternion to Euler angles.\r\n    * @private\r\n    * @returns {Number[]} [phi angle, theta angle, psi angle]\r\n    */\r\n    Quaternion.prototype.toEulerAngles = function () {\r\n      var phi = Math.atan2(2 * (this.w * this.x + this.y * this.z), 1 - 2 * (this.x * this.x + this.y * this.y)),\r\n          theta = Math.asin(2 * (this.w * this.y - this.z * this.x)),\r\n          psi = Math.atan2(2 * (this.w * this.z + this.x * this.y), 1 - 2 * (this.y * this.y + this.z * this.z));\r\n      return [phi, theta, psi];\r\n    };\r\n\r\n    /**\r\n    * Converts device orientation API Tait-Bryan angles to a quaternion.\r\n    * @private\r\n    * @param {Number} alpha - Alpha angle (in degrees)\r\n    * @param {Number} beta - Beta angle (in degrees)\r\n    * @param {Number} gamma - Gamma angle (in degrees)\r\n    * @returns {Quaternion} Orientation quaternion\r\n    */\r\n    function taitBryanToQuaternion(alpha, beta, gamma) {\r\n      var r = [beta ? beta * Math.PI / 180 / 2 : 0, gamma ? gamma * Math.PI / 180 / 2 : 0, alpha ? alpha * Math.PI / 180 / 2 : 0];\r\n      var c = [Math.cos(r[0]), Math.cos(r[1]), Math.cos(r[2])],\r\n          s = [Math.sin(r[0]), Math.sin(r[1]), Math.sin(r[2])];\r\n\r\n      return new Quaternion(c[0] * c[1] * c[2] - s[0] * s[1] * s[2], s[0] * c[1] * c[2] - c[0] * s[1] * s[2], c[0] * s[1] * c[2] + s[0] * c[1] * s[2], c[0] * c[1] * s[2] + s[0] * s[1] * c[2]);\r\n    }\r\n\r\n    /**\r\n    * Computes current device orientation quaternion from device orientation API\r\n    * Tait-Bryan angles.\r\n    * @private\r\n    * @param {Number} alpha - Alpha angle (in degrees)\r\n    * @param {Number} beta - Beta angle (in degrees)\r\n    * @param {Number} gamma - Gamma angle (in degrees)\r\n    * @returns {Quaternion} Orientation quaternion\r\n    */\r\n    function computeQuaternion(alpha, beta, gamma) {\r\n      // Convert Tait-Bryan angles to quaternion\r\n      var quaternion = taitBryanToQuaternion(alpha, beta, gamma);\r\n      // Apply world transform\r\n      quaternion = quaternion.multiply(new Quaternion(Math.sqrt(0.5), -Math.sqrt(0.5), 0, 0));\r\n      // Apply screen transform\r\n      var angle = window.orientation ? -window.orientation * Math.PI / 180 / 2 : 0;\r\n      return quaternion.multiply(new Quaternion(Math.cos(angle), 0, -Math.sin(angle), 0));\r\n    }\r\n\r\n    /**\r\n    * Event handler for device orientation API. Controls pointing.\r\n    * @private\r\n    * @param {DeviceOrientationEvent} event - Device orientation event.\r\n    */\r\n    function orientationListener(e) {\r\n      var q = computeQuaternion(e.alpha, e.beta, e.gamma).toEulerAngles();\r\n      if (typeof orientation === 'number' && orientation < 10) {\r\n        // This kludge is necessary because iOS sometimes provides a few stale\r\n        // device orientation events when the listener is removed and then\r\n        // readded. Thus, we skip the first 10 events to prevent this from\r\n        // causing problems.\r\n        orientation += 1;\r\n      } else if (orientation === 10) {\r\n        // Record starting yaw to prevent jumping\r\n        orientationYawOffset = q[2] / Math.PI * 180 + config.yaw;\r\n        orientation = true;\r\n        requestAnimationFrame(animate);\r\n      } else {\r\n        config.pitch = q[0] / Math.PI * 180;\r\n        config.roll = -q[1] / Math.PI * 180;\r\n        config.yaw = -q[2] / Math.PI * 180 + orientationYawOffset;\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Initializes renderer.\r\n    * @private\r\n    */\r\n    function renderInit() {\r\n      try {\r\n        var params = {};\r\n        if (config.horizonPitch !== undefined) {\r\n          params.horizonPitch = config.horizonPitch * Math.PI / 180;\r\n        }\r\n        if (config.horizonRoll !== undefined) {\r\n          params.horizonRoll = config.horizonRoll * Math.PI / 180;\r\n        }\r\n        if (config.backgroundColor !== undefined) {\r\n          params.backgroundColor = config.backgroundColor;\r\n        }\r\n        renderer.init(panoImage, config.type, config.dynamic, config.haov * Math.PI / 180, config.vaov * Math.PI / 180, config.vOffset * Math.PI / 180, renderInitCallback, params);\r\n        if (config.dynamic !== true) {\r\n          // Allow image to be garbage collected\r\n          panoImage = undefined;\r\n        }\r\n      } catch (event) {\r\n        // Panorama not loaded\r\n\r\n        // Display error if there is a bad texture\r\n        if (event.type == 'webgl error' || event.type == 'no webgl') {\r\n          anError();\r\n        } else if (event.type == 'webgl size error') {\r\n          anError(config.strings.textureSizeError.replace('%s', event.width).replace('%s', event.maxWidth));\r\n        } else {\r\n          anError(config.strings.unknownError);\r\n          throw event;\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Triggered when render initialization finishes. Handles fading between\r\n    * scenes as well as showing the compass and hotspots and hiding the loading\r\n    * display.\r\n    * @private\r\n    */\r\n    function renderInitCallback() {\r\n      // Fade if specified\r\n      if (config.sceneFadeDuration && renderer.fadeImg !== undefined) {\r\n        renderer.fadeImg.style.opacity = 0;\r\n        // Remove image\r\n        var fadeImg = renderer.fadeImg;\r\n        delete renderer.fadeImg;\r\n        setTimeout(function () {\r\n          renderContainer.removeChild(fadeImg);\r\n          fireEvent('scenechangefadedone');\r\n        }, config.sceneFadeDuration);\r\n      }\r\n\r\n      // Show compass if applicable\r\n      if (config.compass) {\r\n        compass.style.display = 'inline';\r\n      } else {\r\n        compass.style.display = 'none';\r\n      }\r\n\r\n      // Show hotspots\r\n      createHotSpots();\r\n\r\n      // Hide loading display\r\n      infoDisplay.load.box.style.display = 'none';\r\n      if (preview !== undefined) {\r\n        renderContainer.removeChild(preview);\r\n        preview = undefined;\r\n      }\r\n      loaded = true;\r\n\r\n      fireEvent('load');\r\n\r\n      animateInit();\r\n    }\r\n\r\n    /**\r\n    * Creates hot spot element for the current scene.\r\n    * @private\r\n    * @param {Object} hs - The configuration for the hotspot\r\n    */\r\n    function createHotSpot(hs) {\r\n      // Make sure hot spot pitch and yaw are numbers\r\n      hs.pitch = Number(hs.pitch) || 0;\r\n      hs.yaw = Number(hs.yaw) || 0;\r\n\r\n      var div = document.createElement('div');\r\n      div.className = 'pnlm-hotspot-base';\r\n      if (hs.cssClass) {\r\n        div.className += ' ' + hs.cssClass;\r\n      } else {\r\n        div.className += ' pnlm-hotspot pnlm-sprite pnlm-' + escapeHTML(hs.type);\r\n      }\r\n\r\n      var span = document.createElement('span');\r\n      if (hs.text) {\r\n        span.innerHTML = escapeHTML(hs.text);\r\n      }\r\n\r\n      var a;\r\n      if (hs.video) {\r\n        var video = document.createElement('video'),\r\n            p = hs.video;\r\n        if (config.basePath && !absoluteURL(p)) {\r\n          p = config.basePath + p;\r\n        }\r\n        video.src = sanitizeURL(p);\r\n        video.controls = true;\r\n        video.style.width = hs.width + 'px';\r\n        renderContainer.appendChild(div);\r\n        span.appendChild(video);\r\n      } else if (hs.image) {\r\n        var p = hs.image;\r\n        if (config.basePath && !absoluteURL(p)) {\r\n          p = config.basePath + p;\r\n        }\r\n        a = document.createElement('a');\r\n        a.href = sanitizeURL(hs.URL ? hs.URL : p);\r\n        a.target = '_blank';\r\n        span.appendChild(a);\r\n        var image = document.createElement('img');\r\n        image.src = sanitizeURL(p);\r\n        image.style.width = hs.width + 'px';\r\n        image.style.paddingTop = '5px';\r\n        renderContainer.appendChild(div);\r\n        a.appendChild(image);\r\n        span.style.maxWidth = 'initial';\r\n      } else if (hs.URL) {\r\n        a = document.createElement('a');\r\n        a.href = sanitizeURL(hs.URL);\r\n        a.target = '_blank';\r\n        renderContainer.appendChild(a);\r\n        div.className += ' pnlm-pointer';\r\n        span.className += ' pnlm-pointer';\r\n        a.appendChild(div);\r\n      } else {\r\n        if (hs.sceneId) {\r\n          div.onclick = div.ontouchend = function () {\r\n            if (!div.clicked) {\r\n              div.clicked = true;\r\n              loadScene(hs.sceneId, hs.targetPitch, hs.targetYaw, hs.targetHfov);\r\n            }\r\n            return false;\r\n          };\r\n          div.className += ' pnlm-pointer';\r\n          span.className += ' pnlm-pointer';\r\n        }\r\n        renderContainer.appendChild(div);\r\n      }\r\n\r\n      if (hs.createTooltipFunc) {\r\n        hs.createTooltipFunc(div, hs.createTooltipArgs);\r\n      } else if (hs.text || hs.video || hs.image) {\r\n        div.classList.add('pnlm-tooltip');\r\n        div.appendChild(span);\r\n        span.style.width = span.scrollWidth - 20 + 'px';\r\n        span.style.marginLeft = -(span.scrollWidth - div.offsetWidth) / 2 + 'px';\r\n        span.style.marginTop = -span.scrollHeight - 12 + 'px';\r\n      }\r\n      if (hs.clickHandlerFunc) {\r\n        div.addEventListener('click', function (e) {\r\n          hs.clickHandlerFunc(e, hs.clickHandlerArgs);\r\n        }, 'false');\r\n        div.className += ' pnlm-pointer';\r\n        span.className += ' pnlm-pointer';\r\n      }\r\n      hs.div = div;\r\n    };\r\n\r\n    /**\r\n    * Creates hot spot elements for the current scene.\r\n    * @private\r\n    */\r\n    function createHotSpots() {\r\n      if (hotspotsCreated) {\r\n        return;\r\n      }\r\n\r\n      if (!config.hotSpots) {\r\n        config.hotSpots = [];\r\n      } else {\r\n        // Sort by pitch so tooltip is never obscured by another hot spot\r\n        config.hotSpots = config.hotSpots.sort(function (a, b) {\r\n          return a.pitch < b.pitch;\r\n        });\r\n        config.hotSpots.forEach(createHotSpot);\r\n      }\r\n      hotspotsCreated = true;\r\n      renderHotSpots();\r\n    }\r\n\r\n    /**\r\n    * Destroys currently created hot spot elements.\r\n    * @private\r\n    */\r\n    function destroyHotSpots() {\r\n      var hs = config.hotSpots;\r\n      hotspotsCreated = false;\r\n      delete config.hotSpots;\r\n      if (hs) {\r\n        for (var i = 0; i < hs.length; i++) {\r\n          var current = hs[i].div;\r\n          while (current.parentNode != renderContainer) {\r\n            current = current.parentNode;\r\n          }\r\n          renderContainer.removeChild(current);\r\n          delete hs[i].div;\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Renders hot spot, updating its position and visibility.\r\n    * @private\r\n    */\r\n    function renderHotSpot(hs) {\r\n      var hsPitchSin = Math.sin(hs.pitch * Math.PI / 180),\r\n          hsPitchCos = Math.cos(hs.pitch * Math.PI / 180),\r\n          configPitchSin = Math.sin(config.pitch * Math.PI / 180),\r\n          configPitchCos = Math.cos(config.pitch * Math.PI / 180),\r\n          yawCos = Math.cos((-hs.yaw + config.yaw) * Math.PI / 180);\r\n      var z = hsPitchSin * configPitchSin + hsPitchCos * yawCos * configPitchCos;\r\n      if (hs.yaw <= 90 && hs.yaw > -90 && z <= 0 || (hs.yaw > 90 || hs.yaw <= -90) && z <= 0) {\r\n        hs.div.style.visibility = 'hidden';\r\n      } else {\r\n        var yawSin = Math.sin((-hs.yaw + config.yaw) * Math.PI / 180),\r\n            hfovTan = Math.tan(config.hfov * Math.PI / 360);\r\n        hs.div.style.visibility = 'visible';\r\n        // Subpixel rendering doesn't work in Firefox\r\n        // https://bugzilla.mozilla.org/show_bug.cgi?id=739176\r\n        var canvas = renderer.getCanvas(),\r\n            canvasWidth = canvas.clientWidth,\r\n            canvasHeight = canvas.clientHeight;\r\n        var coord = [-canvasWidth / hfovTan * yawSin * hsPitchCos / z / 2, -canvasWidth / hfovTan * (hsPitchSin * configPitchCos - hsPitchCos * yawCos * configPitchSin) / z / 2];\r\n        // Apply roll\r\n        var rollSin = Math.sin(config.roll * Math.PI / 180),\r\n            rollCos = Math.cos(config.roll * Math.PI / 180);\r\n        coord = [coord[0] * rollCos - coord[1] * rollSin, coord[0] * rollSin + coord[1] * rollCos];\r\n        // Apply transform\r\n        coord[0] += (canvasWidth - hs.div.offsetWidth) / 2;\r\n        coord[1] += (canvasHeight - hs.div.offsetHeight) / 2;\r\n        var transform = 'translate(' + coord[0] + 'px, ' + coord[1] + 'px) translateZ(9999px) rotate(' + config.roll + 'deg)';\r\n        hs.div.style.webkitTransform = transform;\r\n        hs.div.style.MozTransform = transform;\r\n        hs.div.style.transform = transform;\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Renders hot spots, updating their positions and visibility.\r\n    * @private\r\n    */\r\n    function renderHotSpots() {\r\n      config.hotSpots.forEach(renderHotSpot);\r\n    }\r\n\r\n    /**\r\n    * Merges a scene configuration into the current configuration.\r\n    * @private\r\n    * @param {string} sceneId - Identifier of scene configuration to merge in.\r\n    */\r\n    function mergeConfig(sceneId) {\r\n      config = {};\r\n      var k, s;\r\n      var photoSphereExcludes = ['haov', 'vaov', 'vOffset', 'northOffset', 'horizonPitch', 'horizonRoll'];\r\n      specifiedPhotoSphereExcludes = [];\r\n\r\n      // Merge default config\r\n      for (k in defaultConfig) {\r\n        if (defaultConfig.hasOwnProperty(k)) {\r\n          config[k] = defaultConfig[k];\r\n        }\r\n      }\r\n\r\n      // Merge default scene config\r\n      for (k in initialConfig.default) {\r\n        if (initialConfig.default.hasOwnProperty(k)) {\r\n          if (k == 'strings') {\r\n            for (s in initialConfig.default.strings) {\r\n              if (initialConfig.default.strings.hasOwnProperty(s)) {\r\n                config.strings[s] = escapeHTML(initialConfig.default.strings[s]);\r\n              }\r\n            }\r\n          } else {\r\n            config[k] = initialConfig.default[k];\r\n            if (photoSphereExcludes.indexOf(k) >= 0) {\r\n              specifiedPhotoSphereExcludes.push(k);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Merge current scene config\r\n      if (sceneId !== null && sceneId !== '' && initialConfig.scenes && initialConfig.scenes[sceneId]) {\r\n        var scene = initialConfig.scenes[sceneId];\r\n        for (k in scene) {\r\n          if (scene.hasOwnProperty(k)) {\r\n            if (k == 'strings') {\r\n              for (s in scene.strings) {\r\n                if (scene.strings.hasOwnProperty(s)) {\r\n                  config.strings[s] = escapeHTML(scene.strings[s]);\r\n                }\r\n              }\r\n            } else {\r\n              config[k] = scene[k];\r\n              if (photoSphereExcludes.indexOf(k) >= 0) {\r\n                specifiedPhotoSphereExcludes.push(k);\r\n              }\r\n            }\r\n          }\r\n        }\r\n        config.scene = sceneId;\r\n      }\r\n\r\n      // Merge initial config\r\n      for (k in initialConfig) {\r\n        if (initialConfig.hasOwnProperty(k)) {\r\n          if (k == 'strings') {\r\n            for (s in initialConfig.strings) {\r\n              if (initialConfig.strings.hasOwnProperty(s)) {\r\n                config.strings[s] = escapeHTML(initialConfig.strings[s]);\r\n              }\r\n            }\r\n          } else {\r\n            config[k] = initialConfig[k];\r\n            if (photoSphereExcludes.indexOf(k) >= 0) {\r\n              specifiedPhotoSphereExcludes.push(k);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Processes configuration options.\r\n    * @param {boolean} [isPreview] - Whether or not the preview is being displayed\r\n    * @private\r\n    */\r\n    function processOptions(isPreview) {\r\n      isPreview = isPreview ? isPreview : false;\r\n\r\n      // Process preview first so it always loads before the browser hits its\r\n      // maximum number of connections to a server as can happen with cubic\r\n      // panoramas\r\n      if (isPreview && 'preview' in config) {\r\n        var p = config.preview;\r\n        if (config.basePath && !absoluteURL(p)) {\r\n          p = config.basePath + p;\r\n        }\r\n        preview = document.createElement('div');\r\n        preview.className = 'pnlm-preview-img';\r\n        preview.style.backgroundImage = \"url('\" + sanitizeURLForCss(p) + \"')\";\r\n        renderContainer.appendChild(preview);\r\n      }\r\n\r\n      // Handle different preview values\r\n      var title = config.title,\r\n          author = config.author;\r\n      if (isPreview) {\r\n        if ('previewTitle' in config) {\r\n          config.title = config.previewTitle;\r\n        }\r\n        if ('previewAuthor' in config) {\r\n          config.author = config.previewAuthor;\r\n        }\r\n      }\r\n\r\n      // Reset title / author display\r\n      if (!config.hasOwnProperty('title')) {\r\n        infoDisplay.title.innerHTML = '';\r\n      }\r\n      if (!config.hasOwnProperty('author')) {\r\n        infoDisplay.author.innerHTML = '';\r\n      }\r\n      if (!config.hasOwnProperty('title') && !config.hasOwnProperty('author')) {\r\n        infoDisplay.container.style.display = 'none';\r\n      }\r\n\r\n      // Fill in load button label and loading box text\r\n      controls.load.innerHTML = '<p>' + config.strings.loadButtonLabel + '</p>';\r\n      infoDisplay.load.boxp.innerHTML = config.strings.loadingLabel;\r\n\r\n      // Process other options\r\n      for (var key in config) {\r\n        if (config.hasOwnProperty(key)) {\r\n          switch (key) {\r\n            case 'title':\r\n              infoDisplay.title.innerHTML = escapeHTML(config[key]);\r\n              infoDisplay.container.style.display = 'inline';\r\n              break;\r\n\r\n            case 'author':\r\n              infoDisplay.author.innerHTML = config.strings.bylineLabel.replace('%s', escapeHTML(config[key]));\r\n              infoDisplay.container.style.display = 'inline';\r\n              break;\r\n\r\n            case 'fallback':\r\n              var link = document.createElement('a');\r\n              link.href = sanitizeURL(config[key]);\r\n              link.target = '_blank';\r\n              link.textContent = 'Click here to view this panorama in an alternative viewer.';\r\n              var message = document.createElement('p');\r\n              message.textContent = 'Your browser does not support WebGL.';\r\n              message.appendChild(document.createElement('br'));\r\n              message.appendChild(link);\r\n              infoDisplay.errorMsg.innerHTML = ''; // Removes all children nodes\r\n              infoDisplay.errorMsg.appendChild(message);\r\n              break;\r\n\r\n            case 'hfov':\r\n              setHfov(Number(config[key]));\r\n              break;\r\n\r\n            case 'autoLoad':\r\n              if (config[key] === true && renderer === undefined) {\r\n                // Show loading box\r\n                infoDisplay.load.box.style.display = 'inline';\r\n                // Hide load button\r\n                controls.load.style.display = 'none';\r\n                // Initialize\r\n                init();\r\n              }\r\n              break;\r\n\r\n            case 'showZoomCtrl':\r\n              if (config[key] && config.showControls != false) {\r\n                // Show zoom controls\r\n                controls.zoom.style.display = 'block';\r\n              } else {\r\n                // Hide zoom controls\r\n                controls.zoom.style.display = 'none';\r\n              }\r\n              break;\r\n\r\n            case 'showFullscreenCtrl':\r\n              if (config[key] && config.showControls != false && ('fullscreen' in document || 'mozFullScreen' in document || 'webkitIsFullScreen' in document || 'msFullscreenElement' in document)) {\r\n\r\n                // Show fullscreen control\r\n                controls.fullscreen.style.display = 'block';\r\n              } else {\r\n                // Hide fullscreen control\r\n                controls.fullscreen.style.display = 'none';\r\n              }\r\n              break;\r\n\r\n            case 'hotSpotDebug':\r\n              if (config[key]) {\r\n                hotSpotDebugIndicator.style.display = 'block';\r\n              } else {\r\n                hotSpotDebugIndicator.style.display = 'none';\r\n              }\r\n              break;\r\n\r\n            case 'showControls':\r\n              if (!config[key]) {\r\n                controls.orientation.style.display = 'none';\r\n                controls.zoom.style.display = 'none';\r\n                controls.fullscreen.style.display = 'none';\r\n              }\r\n              break;\r\n\r\n            case 'orientationOnByDefault':\r\n              if (config[key]) {\r\n                if (orientationSupport === undefined) {\r\n                  startOrientationIfSupported = true;\r\n                } else if (orientationSupport === true) {\r\n                  startOrientation();\r\n                }\r\n              }\r\n              break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (isPreview) {\r\n        // Restore original values if changed for preview\r\n        if (title) {\r\n          config.title = title;\r\n        } else {\r\n          delete config.title;\r\n        }\r\n        if (author) {\r\n          config.author = author;\r\n        } else {\r\n          delete config.author;\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Toggles fullscreen mode.\r\n    * @private\r\n    */\r\n    function toggleFullscreen() {\r\n      if (loaded && !error) {\r\n        if (!fullscreenActive) {\r\n          try {\r\n            if (container.requestFullscreen) {\r\n              container.requestFullscreen();\r\n            } else if (container.mozRequestFullScreen) {\r\n              container.mozRequestFullScreen();\r\n            } else if (container.msRequestFullscreen) {\r\n              container.msRequestFullscreen();\r\n            } else {\r\n              container.webkitRequestFullScreen();\r\n            }\r\n          } catch (event) {\r\n            // Fullscreen doesn't work\r\n          }\r\n        } else {\r\n          if (document.exitFullscreen) {\r\n            document.exitFullscreen();\r\n          } else if (document.mozCancelFullScreen) {\r\n            document.mozCancelFullScreen();\r\n          } else if (document.webkitCancelFullScreen) {\r\n            document.webkitCancelFullScreen();\r\n          } else if (document.msExitFullscreen) {\r\n            document.msExitFullscreen();\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Event handler for fullscreen changes.\r\n    * @private\r\n    */\r\n    function onFullScreenChange() {\r\n      var isFullScreen = window.innerWidth == screen.width && window.innerHeight == screen.height;\r\n      if (document.fullscreen || document.mozFullScreen || document.webkitIsFullScreen || document.msFullscreenElement || isFullScreen) {\r\n        controls.fullscreen.classList.add('pnlm-fullscreen-toggle-button-active');\r\n        fullscreenActive = true;\r\n      } else {\r\n        controls.fullscreen.classList.remove('pnlm-fullscreen-toggle-button-active');\r\n        fullscreenActive = false;\r\n      }\r\n\r\n      // Resize renderer (deal with browser quirks and fixes #155)\r\n      renderer.resize();\r\n      setHfov(config.hfov);\r\n      animateInit();\r\n    }\r\n\r\n    /**\r\n    * Increases panorama zoom. For use with zoom button.\r\n    * @private\r\n    */\r\n    function zoomIn() {\r\n      if (loaded) {\r\n        setHfov(config.hfov - 5);\r\n        animateInit();\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Decreases panorama zoom. For use with zoom button.\r\n    * @private\r\n    */\r\n    function zoomOut() {\r\n      if (loaded) {\r\n        setHfov(config.hfov + 5);\r\n        animateInit();\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Clamps horzontal field of view to viewer's limits.\r\n    * @private\r\n    * @param {number} hfov - Input horizontal field of view (in degrees)\r\n    * @return {number} - Clamped horizontal field of view (in degrees)\r\n    */\r\n    function constrainHfov(hfov) {\r\n      // Keep field of view within bounds\r\n      var minHfov = config.minHfov;\r\n      if (config.type == 'multires' && renderer) {\r\n        minHfov = Math.min(minHfov, renderer.getCanvas().width / (config.multiRes.cubeResolution / 90 * 0.9));\r\n      }\r\n      if (minHfov > config.maxHfov) {\r\n        // Don't change view if bounds don't make sense\r\n        console.log('HFOV bounds do not make sense (minHfov > maxHfov).');\r\n        return config.hfov;\r\n      }\r\n      var newHfov = config.hfov;\r\n      if (hfov < minHfov) {\r\n        newHfov = minHfov;\r\n      } else if (hfov > config.maxHfov) {\r\n        newHfov = config.maxHfov;\r\n      } else {\r\n        newHfov = hfov;\r\n      }\r\n      // Optionally avoid showing background (empty space) on top or bottom by adapting newHfov\r\n      if (config.avoidShowingBackground && renderer) {\r\n        var canvas = renderer.getCanvas();\r\n        newHfov = Math.min(newHfov, Math.atan(Math.tan((config.maxPitch - config.minPitch) / 360 * Math.PI) / canvas.height * canvas.width) * 360 / Math.PI);\r\n      }\r\n      return newHfov;\r\n    }\r\n\r\n    /**\r\n    * Sets viewer's horizontal field of view.\r\n    * @private\r\n    * @param {number} hfov - Desired horizontal field of view in degrees.\r\n    */\r\n    function setHfov(hfov) {\r\n      config.hfov = constrainHfov(hfov);\r\n    }\r\n\r\n    /**\r\n    * Stops auto rotation and animated moves.\r\n    * @private\r\n    */\r\n    function stopAnimation() {\r\n      animatedMove = {};\r\n      autoRotateSpeed = config.autoRotate ? config.autoRotate : autoRotateSpeed;\r\n      config.autoRotate = false;\r\n    }\r\n\r\n    /**\r\n    * Loads panorama.\r\n    * @private\r\n    */\r\n    function load() {\r\n      // Since WebGL error handling is very general, first we clear any error box\r\n      // since it is a new scene and the error from previous maybe because of lacking\r\n      // memory etc and not because of a lack of WebGL support etc\r\n      clearError();\r\n      loaded = false;\r\n\r\n      controls.load.style.display = 'none';\r\n      infoDisplay.load.box.style.display = 'inline';\r\n      init();\r\n    }\r\n\r\n    /**\r\n    * Loads scene.\r\n    * @private\r\n    * @param {string} sceneId - Identifier of scene configuration to merge in.\r\n    * @param {number} targetPitch - Pitch viewer should be centered on once scene loads.\r\n    * @param {number} targetYaw - Yaw viewer should be centered on once scene loads.\r\n    * @param {number} targetHfov - HFOV viewer should use once scene loads.\r\n    * @param {boolean} [fadeDone] - If `true`, fade setup is skipped.\r\n    */\r\n    function loadScene(sceneId, targetPitch, targetYaw, targetHfov, fadeDone) {\r\n      loaded = false;\r\n      animatedMove = {};\r\n\r\n      // Set up fade if specified\r\n      var fadeImg, workingPitch, workingYaw, workingHfov;\r\n      if (config.sceneFadeDuration && !fadeDone) {\r\n        var data = renderer.render(config.pitch * Math.PI / 180, config.yaw * Math.PI / 180, config.hfov * Math.PI / 180, { returnImage: true });\r\n        if (data !== undefined) {\r\n          fadeImg = new Image();\r\n          fadeImg.className = 'pnlm-fade-img';\r\n          fadeImg.style.transition = 'opacity ' + config.sceneFadeDuration / 1000 + 's';\r\n          fadeImg.style.width = '100%';\r\n          fadeImg.style.height = '100%';\r\n          fadeImg.onload = function () {\r\n            loadScene(sceneId, targetPitch, targetYaw, targetHfov, true);\r\n          };\r\n          fadeImg.src = data;\r\n          renderContainer.appendChild(fadeImg);\r\n          renderer.fadeImg = fadeImg;\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Set new pointing\r\n      if (targetPitch === 'same') {\r\n        workingPitch = config.pitch;\r\n      } else {\r\n        workingPitch = targetPitch;\r\n      }\r\n      if (targetYaw === 'same') {\r\n        workingYaw = config.yaw;\r\n      } else if (targetYaw === 'sameAzimuth') {\r\n        workingYaw = config.yaw + (config.northOffset || 0) - (initialConfig.scenes[sceneId].northOffset || 0);\r\n      } else {\r\n        workingYaw = targetYaw;\r\n      }\r\n      if (targetHfov === 'same') {\r\n        workingHfov = config.hfov;\r\n      } else {\r\n        workingHfov = targetHfov;\r\n      }\r\n\r\n      // Destroy hot spots from previous scene\r\n      destroyHotSpots();\r\n\r\n      // Create the new config for the scene\r\n      mergeConfig(sceneId);\r\n\r\n      // Stop motion\r\n      speed.yaw = speed.pitch = speed.hfov = 0;\r\n\r\n      // Reload scene\r\n      processOptions();\r\n      if (workingPitch !== undefined) {\r\n        config.pitch = workingPitch;\r\n      }\r\n      if (workingYaw !== undefined) {\r\n        config.yaw = workingYaw;\r\n      }\r\n      if (workingHfov !== undefined) {\r\n        config.hfov = workingHfov;\r\n      }\r\n      fireEvent('scenechange', sceneId);\r\n      load();\r\n    }\r\n\r\n    /**\r\n    * Stop using device orientation.\r\n    * @private\r\n    */\r\n    function stopOrientation() {\r\n      window.removeEventListener('deviceorientation', orientationListener);\r\n      controls.orientation.classList.remove('pnlm-orientation-button-active');\r\n      orientation = false;\r\n    }\r\n\r\n    /**\r\n    * Start using device orientation.\r\n    * @private\r\n    */\r\n    function startOrientation() {\r\n      orientation = 1;\r\n      window.addEventListener('deviceorientation', orientationListener);\r\n      controls.orientation.classList.add('pnlm-orientation-button-active');\r\n    }\r\n\r\n    /**\r\n    * Escapes HTML string (to mitigate possible DOM XSS attacks).\r\n    * @private\r\n    * @param {string} s - String to escape\r\n    * @returns {string} Escaped string\r\n    */\r\n    function escapeHTML(s) {\r\n      if (!initialConfig.escapeHTML) {\r\n        return String(s).split('\\n').join('<br>');\r\n      }\r\n      return String(s).split(/&/g).join('&amp;').split('\"').join('&quot;').split(\"'\").join('&#39;').split('<').join('&lt;').split('>').join('&gt;').split('/').join('&#x2f;').split('\\n').join('<br>'); // Allow line breaks\r\n    }\r\n\r\n    /**\r\n    * Removes possibility of XSS attacks with URLs.\r\n    * The URL cannot be of protocol 'javascript'.\r\n    * @private\r\n    * @param {string} url - URL to sanitize\r\n    * @returns {string} Sanitized URL\r\n    */\r\n    function sanitizeURL(url) {\r\n      if (url.trim().toLowerCase().indexOf('javascript:') === 0) {\r\n        return 'about:blank';\r\n      }\r\n      return url;\r\n    }\r\n\r\n    /**\r\n    * Removes possibility of XSS atacks with URLs for CSS.\r\n    * The URL will be sanitized with `sanitizeURL()` and single quotes\r\n    * and double quotes escaped.\r\n    * @private\r\n    * @param {string} url - URL to sanitize\r\n    * @returns {string} Sanitized URL\r\n    */\r\n    function sanitizeURLForCss(url) {\r\n      return sanitizeURL(url).replace(/\"/g, '%22').replace(/'/g, '%27');\r\n    }\r\n\r\n    /**\r\n    * Checks whether or not a panorama is loaded.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {boolean} `true` if a panorama is loaded, else `false`\r\n    */\r\n    this.isLoaded = function () {\r\n      return Boolean(loaded);\r\n    };\r\n\r\n    /**\r\n    * Returns the pitch of the center of the view.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number} Pitch in degrees\r\n    */\r\n    this.getPitch = function () {\r\n      return config.pitch;\r\n    };\r\n\r\n    /**\r\n    * Sets the pitch of the center of the view.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} pitch - Pitch in degrees\r\n    * @param {boolean|number} [animated=1000] - Animation duration in milliseconds or false for no animation\r\n    * @param {function} [callback] - Function to call when animation finishes\r\n    * @param {object} [callbackArgs] - Arguments to pass to callback function\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.setPitch = function (pitch, animated, callback, callbackArgs) {\r\n      animated = animated == undefined ? 1000 : Number(animated);\r\n      if (animated) {\r\n        animatedMove.pitch = {\r\n          'startTime': Date.now(),\r\n          'startPosition': config.pitch,\r\n          'endPosition': pitch,\r\n          'duration': animated,\r\n          'callback': callback,\r\n          'callbackArgs': callbackArgs\r\n        };\r\n      } else {\r\n        config.pitch = pitch;\r\n      }\r\n      animateInit();\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Returns the minimum and maximum allowed pitches (in degrees).\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number[]} [minimum pitch, maximum pitch]\r\n    */\r\n    this.getPitchBounds = function () {\r\n      return [config.minPitch, config.maxPitch];\r\n    };\r\n\r\n    /**\r\n    * Set the minimum and maximum allowed pitches (in degrees).\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number[]} bounds - [minimum pitch, maximum pitch]\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.setPitchBounds = function (bounds) {\r\n      config.minPitch = Math.max(-90, Math.min(bounds[0], 90));\r\n      config.maxPitch = Math.max(-90, Math.min(bounds[1], 90));\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Returns the yaw of the center of the view.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number} Yaw in degrees\r\n    */\r\n    this.getYaw = function () {\r\n      return config.yaw;\r\n    };\r\n\r\n    /**\r\n    * Sets the yaw of the center of the view.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} yaw - Yaw in degrees [-180, 180]\r\n    * @param {boolean|number} [animated=1000] - Animation duration in milliseconds or false for no animation\r\n    * @param {function} [callback] - Function to call when animation finishes\r\n    * @param {object} [callbackArgs] - Arguments to pass to callback function\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.setYaw = function (yaw, animated, callback, callbackArgs) {\r\n      animated = animated == undefined ? 1000 : Number(animated);\r\n      yaw = (yaw + 180) % 360 - 180; // Keep in bounds\r\n      if (animated) {\r\n        // Animate in shortest direction\r\n        if (config.yaw - yaw > 180) {\r\n          yaw += 360;\r\n        } else if (yaw - config.yaw > 180) {\r\n          yaw -= 360;\r\n        }\r\n\r\n        animatedMove.yaw = {\r\n          'startTime': Date.now(),\r\n          'startPosition': config.yaw,\r\n          'endPosition': yaw,\r\n          'duration': animated,\r\n          'callback': callback,\r\n          'callbackArgs': callbackArgs\r\n        };\r\n      } else {\r\n        config.yaw = yaw;\r\n      }\r\n      animateInit();\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Returns the minimum and maximum allowed pitches (in degrees).\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number[]} [yaw pitch, maximum yaw]\r\n    */\r\n    this.getYawBounds = function () {\r\n      return [config.minYaw, config.maxYaw];\r\n    };\r\n\r\n    /**\r\n    * Set the minimum and maximum allowed yaws (in degrees [-180, 180]).\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number[]} bounds - [minimum yaw, maximum yaw]\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.setYawBounds = function (bounds) {\r\n      config.minYaw = Math.max(-180, Math.min(bounds[0], 180));\r\n      config.maxYaw = Math.max(-180, Math.min(bounds[1], 180));\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Returns the horizontal field of view.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number} Horizontal field of view in degrees\r\n    */\r\n    this.getHfov = function () {\r\n      return config.hfov;\r\n    };\r\n\r\n    /**\r\n    * Sets the horizontal field of view.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} hfov - Horizontal field of view in degrees\r\n    * @param {boolean|number} [animated=1000] - Animation duration in milliseconds or false for no animation\r\n    * @param {function} [callback] - Function to call when animation finishes\r\n    * @param {object} [callbackArgs] - Arguments to pass to callback function\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.setHfov = function (hfov, animated, callback, callbackArgs) {\r\n      animated = animated == undefined ? 1000 : Number(animated);\r\n      if (animated) {\r\n        animatedMove.hfov = {\r\n          'startTime': Date.now(),\r\n          'startPosition': config.hfov,\r\n          'endPosition': constrainHfov(hfov),\r\n          'duration': animated,\r\n          'callback': callback,\r\n          'callbackArgs': callbackArgs\r\n        };\r\n      } else {\r\n        setHfov(hfov);\r\n      }\r\n      animateInit();\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Returns the minimum and maximum allowed horizontal fields of view\r\n    * (in degrees).\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number[]} [minimum hfov, maximum hfov]\r\n    */\r\n    this.getHfovBounds = function () {\r\n      return [config.minHfov, config.maxHfov];\r\n    };\r\n\r\n    /**\r\n    * Set the minimum and maximum allowed horizontal fields of view (in degrees).\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number[]} bounds - [minimum hfov, maximum hfov]\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.setHfovBounds = function (bounds) {\r\n      config.minHfov = Math.max(0, bounds[0]);\r\n      config.maxHfov = Math.max(0, bounds[1]);\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Set a new view. Any parameters not specified remain the same.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} [pitch] - Target pitch\r\n    * @param {number} [yaw] - Target yaw\r\n    * @param {number} [hfov] - Target hfov\r\n    * @param {boolean|number} [animated=1000] - Animation duration in milliseconds or false for no animation\r\n    * @param {function} [callback] - Function to call when animation finishes\r\n    * @param {object} [callbackArgs] - Arguments to pass to callback function\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.lookAt = function (pitch, yaw, hfov, animated, callback, callbackArgs) {\r\n      animated = animated == undefined ? 1000 : Number(animated);\r\n      if (pitch !== undefined) {\r\n        this.setPitch(pitch, animated, callback, callbackArgs);\r\n        callback = undefined;\r\n      }\r\n      if (yaw !== undefined) {\r\n        this.setYaw(yaw, animated, callback, callbackArgs);\r\n        callback = undefined;\r\n      }\r\n      if (hfov !== undefined) {\r\n        this.setHfov(hfov, animated, callback, callbackArgs);\r\n      }\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Returns the panorama's north offset.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number} North offset in degrees\r\n    */\r\n    this.getNorthOffset = function () {\r\n      return config.northOffset;\r\n    };\r\n\r\n    /**\r\n    * Sets the panorama's north offset.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} heading - North offset in degrees\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.setNorthOffset = function (heading) {\r\n      config.northOffset = Math.min(360, Math.max(0, heading));\r\n      animateInit();\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Returns the panorama's horizon roll.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number} Horizon roll in degrees\r\n    */\r\n    this.getHorizonRoll = function () {\r\n      return config.horizonRoll;\r\n    };\r\n\r\n    /**\r\n    * Sets the panorama's horizon roll.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} roll - Horizon roll in degrees [-90, 90]\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.setHorizonRoll = function (roll) {\r\n      config.horizonRoll = Math.min(90, Math.max(-90, roll));\r\n      renderer.setPose(config.horizonPitch * Math.PI / 180, config.horizonRoll * Math.PI / 180);\r\n      animateInit();\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Returns the panorama's horizon pitch.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {number} Horizon pitch in degrees\r\n    */\r\n    this.getHorizonPitch = function () {\r\n      return config.horizonPitch;\r\n    };\r\n\r\n    /**\r\n    * Sets the panorama's horizon pitch.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} pitch - Horizon pitch in degrees [-90, 90]\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.setHorizonPitch = function (pitch) {\r\n      config.horizonPitch = Math.min(90, Math.max(-90, pitch));\r\n      renderer.setPose(config.horizonPitch * Math.PI / 180, config.horizonRoll * Math.PI / 180);\r\n      animateInit();\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Start auto rotation.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {number} [speed] - Auto rotation speed / direction. If not specified, previous value is used.\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.startAutoRotate = function (speed) {\r\n      speed = speed || autoRotateSpeed || 1;\r\n      config.autoRotate = speed;\r\n      _this.lookAt(origPitch, undefined, origHfov, 3000);\r\n      animateInit();\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Stop auto rotation.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.stopAutoRotate = function () {\r\n      autoRotateSpeed = config.autoRotate ? config.autoRotate : autoRotateSpeed;\r\n      config.autoRotate = false;\r\n      config.autoRotateInactivityDelay = -1;\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Returns the panorama renderer.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {Renderer}\r\n    */\r\n    this.getRenderer = function () {\r\n      return renderer;\r\n    };\r\n\r\n    /**\r\n    * Sets update flag for dynamic content.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {boolean} bool - Whether or not viewer should update even when still\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.setUpdate = function (bool) {\r\n      update = bool === true;\r\n      if (renderer === undefined) {\r\n        onImageLoad();\r\n      } else {\r\n        animateInit();\r\n      }\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Calculate panorama pitch and yaw from location of mouse event.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {MouseEvent} event - Document mouse down event.\r\n    * @returns {number[]} [pitch, yaw]\r\n    */\r\n    this.mouseEventToCoords = function (event) {\r\n      return mouseEventToCoords(event);\r\n    };\r\n\r\n    /**\r\n    * Change scene being viewed.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {string} sceneId - Identifier of scene to switch to.\r\n    * @param {number} [pitch] - Pitch to use with new scene\r\n    * @param {number} [yaw] - Yaw to use with new scene\r\n    * @param {number} [hfov] - HFOV to use with new scene\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.loadScene = function (sceneId, pitch, yaw, hfov) {\r\n      if (loaded !== false) {\r\n        loadScene(sceneId, pitch, yaw, hfov);\r\n      }\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Get ID of current scene.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {string} ID of current scene\r\n    */\r\n    this.getScene = function () {\r\n      return config.scene;\r\n    };\r\n\r\n    /**\r\n    * Add a new scene.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {string} sceneId - The ID of the new scene\r\n    * @param {string} config - The configuration of the new scene\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.addScene = function (sceneId, config) {\r\n      initialConfig.scenes[sceneId] = config;\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Remove a scene.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {string} sceneId - The ID of the scene\r\n    * @returns {boolean} False if the scene is the current scene or if the scene doesn't exists, else true\r\n    */\r\n    this.removeScene = function (sceneId) {\r\n      if (config.scene === sceneId || !initialConfig.scenes.hasOwnProperty(sceneId)) {\r\n        return false;\r\n      }\r\n      delete initialConfig.scenes[sceneId];\r\n      return true;\r\n    };\r\n\r\n    /**\r\n    * Toggle fullscreen.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.toggleFullscreen = function () {\r\n      toggleFullscreen();\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Get configuration of current scene.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {Object} Configuration of current scene\r\n    */\r\n    this.getConfig = function () {\r\n      return config;\r\n    };\r\n\r\n    /**\r\n    * Get viewer's container element.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {HTMLElement} Container `div` element\r\n    */\r\n    this.getContainer = function () {\r\n      return container;\r\n    };\r\n\r\n    /**\r\n    * Add a new hot spot.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {Object} hs - The configuration for the hot spot\r\n    * @param {string} [sceneId] - Adds hot spot to specified scene if provided, else to current scene\r\n    * @returns {Viewer} `this`\r\n    * @throws Throws an error if the scene ID is provided but invalid\r\n    */\r\n    this.addHotSpot = function (hs, sceneId) {\r\n      if (sceneId === undefined && config.scene === undefined) {\r\n        // Not a tour\r\n        config.hotSpots.push(hs);\r\n      } else {\r\n        // Tour\r\n        var id = sceneId !== undefined ? sceneId : config.scene;\r\n        if (initialConfig.scenes.hasOwnProperty(id)) {\r\n          if (!initialConfig.scenes[id].hasOwnProperty('hotSpots')) {\r\n            initialConfig.scenes[id].hotSpots = []; // Create hot spots array if needed\r\n            if (id == config.scene) {\r\n              config.hotSpots = initialConfig.scenes[id].hotSpots;\r\n            } // Link to current config\r\n          }\r\n          initialConfig.scenes[id].hotSpots.push(hs); // Add hot spot to config\r\n        } else {\r\n          throw 'Invalid scene ID!';\r\n        }\r\n      }\r\n      if (sceneId === undefined || config.scene == sceneId) {\r\n        // Add to current scene\r\n        createHotSpot(hs);\r\n        if (loaded) {\r\n          renderHotSpot(hs);\r\n        }\r\n      }\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Remove a hot spot.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {string} hotSpotId - The ID of the hot spot\r\n    * @param {string} [sceneId] - Removes hot spot from specified scene if provided, else from current scene\r\n    * @returns {boolean} True if deletion is successful, else false\r\n    */\r\n    this.removeHotSpot = function (hotSpotId, sceneId) {\r\n      if (sceneId === undefined || config.scene == sceneId) {\r\n        if (!config.hotSpots) {\r\n          return false;\r\n        }\r\n        for (var i = 0; i < config.hotSpots.length; i++) {\r\n          if (config.hotSpots[i].hasOwnProperty('id') && config.hotSpots[i].id === hotSpotId) {\r\n            // Delete hot spot DOM elements\r\n            var current = config.hotSpots[i].div;\r\n            while (current.parentNode != renderContainer) {\r\n              current = current.parentNode;\r\n            }\r\n            renderContainer.removeChild(current);\r\n            delete config.hotSpots[i].div;\r\n            // Remove hot spot from configuration\r\n            config.hotSpots.splice(i, 1);\r\n            return true;\r\n          }\r\n        }\r\n      } else {\r\n        if (initialConfig.scenes.hasOwnProperty(sceneId)) {\r\n          if (!initialConfig.scenes[sceneId].hasOwnProperty('hotSpots')) {\r\n            return false;\r\n          }\r\n          for (var i = 0; i < initialConfig.scenes[sceneId].hotSpots.length; i++) {\r\n            if (initialConfig.scenes[sceneId].hotSpots[i].hasOwnProperty('id') && initialConfig.scenes[sceneId].hotSpots[i].id === hotSpotId) {\r\n              // Remove hot spot from configuration\r\n              initialConfig.scenes[sceneId].hotSpots.splice(i, 1);\r\n              return true;\r\n            }\r\n          }\r\n        } else {\r\n          return false;\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n    * This method should be called if the viewer's container is resized.\r\n    * @memberof Viewer\r\n    * @instance\r\n    */\r\n    this.resize = function () {\r\n      if (renderer) {\r\n        onDocumentResize();\r\n      }\r\n    };\r\n\r\n    /**\r\n    * Check if a panorama is loaded.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {boolean} True if a panorama is loaded, else false\r\n    */\r\n    this.isLoaded = function () {\r\n      return loaded;\r\n    };\r\n\r\n    /**\r\n    * Check if device orientation control is supported.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {boolean} True if supported, else false\r\n    */\r\n    this.isOrientationSupported = function () {\r\n      return orientationSupport || false;\r\n    };\r\n\r\n    /**\r\n    * Stop using device orientation.\r\n    * @memberof Viewer\r\n    * @instance\r\n    */\r\n    this.stopOrientation = function () {\r\n      stopOrientation();\r\n    };\r\n\r\n    /**\r\n    * Start using device orientation (does nothing if not supported).\r\n    * @memberof Viewer\r\n    * @instance\r\n    */\r\n    this.startOrientation = function () {\r\n      if (orientationSupport) {\r\n        startOrientation();\r\n      }\r\n    };\r\n\r\n    /**\r\n    * Check if device orientation control is currently activated.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @returns {boolean} True if active, else false\r\n    */\r\n    this.isOrientationActive = function () {\r\n      return Boolean(orientation);\r\n    };\r\n\r\n    /**\r\n    * Subscribe listener to specified event.\r\n    * @memberof Viewer\r\n    * @instance\r\n    * @param {string} type - Type of event to subscribe to.\r\n    * @param {Function} listener - Listener function to subscribe to event.\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.on = function (type, listener) {\r\n      externalEventListeners[type] = externalEventListeners[type] || [];\r\n      externalEventListeners[type].push(listener);\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Remove an event listener (or listeners).\r\n    * @memberof Viewer\r\n    * @param {string} [type] - Type of event to remove listeners from. If not specified, all listeners are removed.\r\n    * @param {Function} [listener] - Listener function to remove. If not specified, all listeners of specified type are removed.\r\n    * @returns {Viewer} `this`\r\n    */\r\n    this.off = function (type, listener) {\r\n      if (!type) {\r\n        // Remove all listeners if type isn't specified\r\n        externalEventListeners = {};\r\n        return this;\r\n      }\r\n      if (listener) {\r\n        var i = externalEventListeners[type].indexOf(listener);\r\n        if (i >= 0) {\r\n          // Remove listener if found\r\n          externalEventListeners[type].splice(i, 1);\r\n        }\r\n        if (externalEventListeners[type].length == 0) {\r\n          // Remove category if empty\r\n          delete externalEventListeners[type];\r\n        }\r\n      } else {\r\n        // Remove category of listeners if listener isn't specified\r\n        delete externalEventListeners[type];\r\n      }\r\n      return this;\r\n    };\r\n\r\n    /**\r\n    * Fire listeners attached to specified event.\r\n    * @private\r\n    * @param {string} [type] - Type of event to fire listeners for.\r\n    */\r\n    function fireEvent(type) {\r\n      if (type in externalEventListeners) {\r\n        // Reverse iteration is useful, if event listener is removed inside its definition\r\n        for (var i = externalEventListeners[type].length; i > 0; i--) {\r\n          externalEventListeners[type][externalEventListeners[type].length - i].apply(null, [].slice.call(arguments, 1));\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Destructor.\r\n    * @instance\r\n    * @memberof Viewer\r\n    */\r\n    this.destroy = function () {\r\n      if (renderer) {\r\n        renderer.destroy();\r\n      };\r\n      if (listenersAdded) {\r\n        dragFix.removeEventListener('mousedown', onDocumentMouseDown, false);\r\n        dragFix.removeEventListener('dblclick', onDocumentDoubleClick, false);\r\n        document.removeEventListener('mousemove', onDocumentMouseMove, false);\r\n        document.removeEventListener('mouseup', onDocumentMouseUp, false);\r\n        container.removeEventListener('mousewheel', onDocumentMouseWheel, false);\r\n        container.removeEventListener('DOMMouseScroll', onDocumentMouseWheel, false);\r\n        container.removeEventListener('mozfullscreenchange', onFullScreenChange, false);\r\n        container.removeEventListener('webkitfullscreenchange', onFullScreenChange, false);\r\n        container.removeEventListener('msfullscreenchange', onFullScreenChange, false);\r\n        container.removeEventListener('fullscreenchange', onFullScreenChange, false);\r\n        window.removeEventListener('resize', onDocumentResize, false);\r\n        window.removeEventListener('orientationchange', onDocumentResize, false);\r\n        container.removeEventListener('keydown', onDocumentKeyPress, false);\r\n        container.removeEventListener('keyup', onDocumentKeyUp, false);\r\n        container.removeEventListener('blur', clearKeys, false);\r\n        document.removeEventListener('mouseleave', onDocumentMouseUp, false);\r\n        dragFix.removeEventListener('touchstart', onDocumentTouchStart, false);\r\n        dragFix.removeEventListener('touchmove', onDocumentTouchMove, false);\r\n        dragFix.removeEventListener('touchend', onDocumentTouchEnd, false);\r\n        dragFix.removeEventListener('pointerdown', onDocumentPointerDown, false);\r\n        dragFix.removeEventListener('pointermove', onDocumentPointerMove, false);\r\n        dragFix.removeEventListener('pointerup', onDocumentPointerUp, false);\r\n        dragFix.removeEventListener('pointerleave', onDocumentPointerUp, false);\r\n      }\r\n      container.innerHTML = '';\r\n      container.classList.remove('pnlm-container');\r\n      uiContainer.classList.remove('pnlm-grab');\r\n      uiContainer.classList.remove('pnlm-grabbing');\r\n    };\r\n  }\r\n\r\n  return {\r\n    viewer: function viewer(container, config) {\r\n      return new Viewer(container, config);\r\n    }\r\n  };\r\n}(window, document);"]},"metadata":{},"sourceType":"script"}